\section{First-order completeness}\label{sec:first_order_completeness}

\paragraph{Henkin theories}

\begin{definition}\label{def:fol_henkin_theory}\mcite[def. 3.1.7]{Hinman2005Logic}
  We say that the \hyperref[def:fol_theory]{first-order theory} \( \Gamma \) is \term[ru=экзистенциально полная (теория) (\cite[140]{ШеньВерещагин2017ЯзыкиИИсчисления})]{Henkin complete} is, whenever \( \qexists x \varphi \) belongs to \( \Gamma \), there exists a \hyperref[def:fol_closed_term]{closed term} \( \tau \) such that \( \varphi[x \mapsto \tau] \) belongs to \( \Gamma \). We call \( \tau \) the \term{Henkin witness} of \( \varphi \).
\end{definition}

\begin{definition}\label{def:fol_henkin_extension}\mcite[def. 3.1.6]{VanDalen2004LogicAndStructure}
  Consider some \hyperref[def:fol_theory]{first-order theory} \( \Gamma \) over the signature \( \Sigma \).

  Consider the \hyperref[def:fol_signature_extension]{extension} \( \Sigma^* \) of \( \Sigma \) where, for every existential formula \( \qexists x \varphi \) in \( \Gamma \), we add a new constant \( c_{x,\varphi} \).

  We define the \term{Henkin extension} \( \Gamma^* \) as the consequence closure of
  \begin{equation}\label{eq:def:fol_henkin_extension}
    \Gamma \cup \set[\big]{ (\qexists x \varphi) \synimplies \varphi[x \mapsto c_{x,\varphi}] \given* \qexists x \varphi \T{belongs to} \Gamma }.
  \end{equation}
\end{definition}

\begin{theorem}[Theorem on constants]\label{thm:theorem_on_constants}\mcite[33]{Shoenfield1967MathematicalLogic}
  Over some \hyperref[def:fol_signature]{signature} \( \Sigma \), fix some set \( \Gamma \) of \hyperref[def:closed_fol_formula]{closed formulas} and a formula \( \varphi \) with free variables \( x_1, \ldots, x_n \).

  Consider the \hyperref[def:fol_signature_extension]{extension} \( \Sigma^+ \) of \( \Sigma \) with some constants \( c_1, \ldots, c_n \).

  Then
  \begin{equation*}
    \Gamma \vdash_\Sigma \qforall {x_1} \ldots \qforall {x_n} \varphi \T{if and only if} \Gamma \vdash_{\Sigma^+} \varphi[x_1 \mapsto c_1, \ldots, x_n \mapsto c_n].
  \end{equation*}
\end{theorem}
\begin{comments}
  \item The name of this theorem is based on \cite{Shoenfield1967MathematicalLogic}. It is useful for proving properties of \hyperref[def:fol_henkin_extension]{Henkin extensions}.
\end{comments}
\begin{proof}
  \SufficiencySubProof Let \( P \) be a proof tree over \( \Sigma \), deriving \( \qforall {x_1} \ldots \qforall {x_n} \varphi \) from \( \Gamma \). Let \( P' \) be the following extension:
  \begin{equation*}
    \begin{prooftree}
      \hypo{}
      \ellipsis {\( P \)} { \qforall {x_1} \qforall {x_2} \ldots \qforall {x_n} \varphi }
      \infer1[\ref{inf:def:fol_natural_deduction/forall/elim}]{ \qforall {x_2} \ldots \qforall {x_n} \varphi[x_1 \mapsto c_1] }
      \infer1[\ref{inf:def:fol_natural_deduction/forall/elim}]{ }
      \ellipsis {} {}
      \infer1[\ref{inf:def:fol_natural_deduction/forall/elim}]{ \varphi[x_1 \mapsto c_1] \ldots [x_n \mapsto c_n] }
    \end{prooftree}
  \end{equation*}

  Since \( c_k \) has no free variables, \cref{thm:alg:fol_formula_substitution/composition} implies that
  \begin{equation*}
    \varphi[x_1 \mapsto c_1, \ldots, x_n \mapsto c_n] = \varphi[x_1 \mapsto c_1] \ldots [x_n \mapsto c_n].
  \end{equation*}

  Therefore, \( P' \) derives \( \varphi[x_1 \mapsto c_1, \ldots, x_n \mapsto c_n] \) from \( \Gamma \) over \( \Sigma^+ \).

  \NecessitySubProof Let \( P \) be a proof tree over \( \Sigma^+ \), deriving \( \varphi[x_1 \mapsto c_1, \ldots, x_n \mapsto c_n] \) from \( \Gamma \).

  Let \( y_1, \ldots, y_n \) be distinct variables not present in \( P \), and let \( P' \) be the tree obtained from \( P \) by replacing \( c_k \) with \( y_k \). All rule applications remain, so \( P' \) is a well-formed proof tree over \( \Sigma \).

  Since \( y_1, \ldots, y_n \) are not present in \( \Gamma \), they can be used as eigenvariables; Thus, \( P' \) derives \( \varphi[x_1 \mapsto y_1, \ldots, x_n \mapsto y_n] \) from \( \Gamma \) over \( \Sigma \).

  \Cref{thm:alg:fol_formula_substitution/composition} implies that
  \begin{equation*}
    \varphi[x_1 \mapsto y_1, \ldots, x_n \mapsto y_n] = \varphi[x_1 \mapsto y_1] \ldots [x_n \mapsto y_n],
  \end{equation*}
  thus we can build the following tree:
  \begin{equation*}
    \begin{prooftree}
      \hypo{}
      \ellipsis {\( P' \)} { \varphi[x_1 \mapsto y_1] \ldots [x_{n-1} \mapsto y_{n-1}][x_n \mapsto y_n] }
      \infer1[\ref{inf:def:fol_natural_deduction/forall/intro}]{ \qforall {x_n} \varphi[x_1 \mapsto y_1] \ldots [x_{n-1} \mapsto y_{n-1}] }
      \infer1[\ref{inf:def:fol_natural_deduction/forall/intro}]{ }
      \ellipsis {} {}
      \infer1[\ref{inf:def:fol_natural_deduction/forall/intro}]{ \qforall {x_1} \ldots \qforall {x_n} \varphi }
    \end{prooftree}
  \end{equation*}
\end{proof}

\begin{proposition}\label{thm:def:fol_henkin_extension}
  \hyperref[def:fol_henkin_extension]{Henkin extensions} of syntactic theories have the following basic properties:
  \begin{thmenum}
    \thmitem{thm:def:fol_henkin_extension/conservative}\mcite[lemma 3.1.7]{VanDalen2004LogicAndStructure} Every Henkin extension is \hyperref[def:fol_theory/conservative]{conservative}.
  \end{thmenum}
\end{proposition}
\begin{proof}
  \SubProofOf{thm:def:fol_henkin_extension/conservative} Let \( \Gamma \) be a theory over \( \Sigma \). Let \( \Gamma^* \) be the Henkin extension of \( \Gamma \) with signature \( \Sigma^+ \). Denote by \( \Delta \) the set of additional axioms from \( \Gamma^* \), so that \( \Gamma^* = \op*{Th}(\Gamma \cup \Delta) \).

  Fix a formula \( \varphi \) over \( \Sigma \) that belongs to \( \Gamma^* \). Since \( \Gamma^* \) is a consequence closure of \( \Gamma \cup \Delta \), there exists a \hyperref[def:fol_natural_deduction_proof_tree]{proof tree} \( P \) for \( \varphi \) whose open assumptions are from \( \Gamma \cup \Delta \).

  Let \( \Delta_0 \) be the subset of formulas of \( \Delta \) that are open assumptions in \( P \). We will recursively build a sequence \( \ldots \subseteq \Delta_2 \subseteq \Delta_1 \subseteq \Delta_0 \) that eventually stabilizes at the empty set, and a corresponding sequence \( P_1, P_2, \ldots \) of proof trees, where \( P_k \) derives \( \varphi \) from \( \Gamma \cup \Delta_k \) and does not contain new constants except those from \( \Delta_k \).

  We start with \( \Delta_0 \) and \( P_0 \coloneqq P \). At step \( k + 1 \), suppose we have already constructed \( \Delta_k \) and \( P_k \). If \( \Delta_k \) is empty, we are done with the proof. Otherwise, fix an axiom \( (\qexists x \psi) \synimplies \psi[x \mapsto c_{x,\psi}] \) from \( \Delta_k \) and define \( \Delta_{k+1} \) by removing it from \( \Delta_k \).

  \Fullref{thm:fol_natural_deduction_deduction_theorem} gives us a proof tree \( P_k' \) deriving
  \begin{equation*}
    ((\qexists x \psi) \synimplies \psi[x \mapsto c_{x,\psi}]) \synimplies \varphi
  \end{equation*}
  from \( \Gamma \cup \Delta_{k+1} \), and \fullref{thm:theorem_on_constants} gives us a tree \( P_k^\dprime \) not containing \( c_{x,\psi} \) and deriving
  \begin{equation*}
    \qforall y \parens[\big]{ ((\qexists x \psi) \synimplies \psi[x \mapsto y]) \synimplies \varphi }
  \end{equation*}
  from \( \Gamma \cup \Delta_{k+1} \).

  Let \( P_{k+1} \) be the following tree:
  \begin{equation*}
    \begin{prooftree}
      \hypo{ [\qexists x \psi]^u }

      \hypo{}
      \ellipsis {\( P_k^\dprime \)} { \qforall y \parens[\big]{ ((\qexists x \psi) \synimplies \psi[x \mapsto y]) \synimplies \varphi } }
      \infer1[\ref{inf:def:fol_natural_deduction/forall/elim}]{ ((\qexists x \psi) \synimplies \psi[x \mapsto y]) \synimplies \varphi }

      \hypo{ [\psi[x \mapsto y]]^v }
      \infer1[\ref{inf:def:propositional_natural_deduction/imp/intro}]{ \qexists x \psi \synimplies \psi[x \mapsto y] }
      \infer2[\ref{inf:def:propositional_natural_deduction/imp/elim}]{ \varphi }
      \infer[left label={\( v \)}]2[\ref{inf:def:fol_natural_deduction/exists/elim}]{ \varphi }
    \end{prooftree}
  \end{equation*}

  Here \( \qexists x \psi \) is by assumption in \( \Gamma \), so \( P_{k+1} \) derives \( \varphi \) from \( \Gamma \cup \Delta_{k+1} \), as desired.
\end{proof}

\begin{theorem}[First-order completeness]\label{thm:fol_completeness}\mcite[thm. 3.1.3]{VanDalen2004LogicAndStructure}
  The \hyperref[def:fol_natural_deduction]{classical first-order natural deduction system} is \hyperref[def:general_logic/completeness]{complete} with respect to \hyperref[def:fol_semantics]{first-order semantics}.
\end{theorem}
