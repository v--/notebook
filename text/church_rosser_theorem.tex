\section{Church-Rosser theorem}\label{sec:church_rosser_theorem}

\paragraph{Parallel reductions}

\begin{definition}\label{def:parallel_reduction}
  Between single-step and multi-step reductions, there are \term{parallel reductions}, which allow reducing different subterms simultaneously.

  \begin{thmenum}
    \thmitem{def:parallel_reduction/base} We reuse \ref{inf:def:lambda_term_reduction/abs} and \ref{inf:def:lambda_term_reduction/alpha}:
    \begin{paracol}{2}
      \begin{leftcolumn}
        \ParacolAlignmentHack
        \begin{equation*}\taglabel[\ensuremath{ \logic{ParAbs}_{\Anon} }]{inf:def:parallel_reduction/abs}
          \begin{prooftree}
            \hypo{ A \pred B }
            \infer1[\ref{inf:def:lambda_term_reduction/abs}]{ \qabs x A \ppred \qabs x B }
          \end{prooftree}
        \end{equation*}
      \end{leftcolumn}

      \begin{rightcolumn}
        \ParacolAlignmentHack
        \begin{equation*}\taglabel[\ensuremath{ \logic{ParAlpha}_{\Anon} }]{inf:def:parallel_reduction/alpha}
          \begin{prooftree}
            \hypo{ A \aequiv B }
            \hypo{ B \ppred C }
            \hypo{ C \aequiv D }
            \infer3[\ref{inf:def:parallel_reduction/alpha}]{ A \ppred D }.
          \end{prooftree}
        \end{equation*}
      \end{rightcolumn}
    \end{paracol}

    We combine \ref{inf:def:lambda_term_reduction/app_left} and \ref{inf:def:lambda_term_reduction/app_right} into
    \begin{equation*}\taglabel[\ensuremath{ \logic{ParApp}_{\Anon} }]{inf:def:parallel_reduction/app}
      \begin{prooftree}
        \hypo{ A \ppred C }
        \hypo{ B \ppred D }
        \infer2[\ref{inf:def:parallel_reduction/app}]{ AB \ppred CD }
      \end{prooftree}
    \end{equation*}

    \thmitem{def:parallel_reduction/atom} \ref{inf:def:parallel_reduction/app} introduces a subtlety.

    If \( A \pred C \) and \( B = D \), the single-step rule \ref{inf:def:lambda_term_reduction/app_left} implies that \( AB \pred CD \). The corresponding parallel rule \ref{inf:def:parallel_reduction/abs}, however, requires both \( A \ppred C \) and \( B \ppred D \) in order to conclude \( AB \ppred CD \).

    To mitigate this issue, it is sufficient to ensure that parallel reduction is reflexive. To achieve this, we introduce the following rule based on \ref{inf:def:lambda_term_alpha_equivalence/atom}:
    \begin{equation*}\taglabel[\ensuremath{ \logic{ParAtom}_{\Anon} }]{inf:def:parallel_reduction/atom}
      \begin{prooftree}
        \hypo{ M \in \op*{Atom} }
        \infer1[\ref{inf:def:parallel_reduction/atom}]{ M \ppred M }
      \end{prooftree}
    \end{equation*}

    As we will see in \fullref{thm:def:parallel_reduction/alpha_reflexive}, this will help ensure that parallel reduction is \hyperref[def:alpha_reflexive]{\( \alpha \)-reflexive}.
  \end{thmenum}

  \thmitem{def:parallel_reduction/beta_eta} Additionally, we replace \ref{inf:def:beta_eta_reduction/beta} and \ref{inf:def:beta_eta_reduction/eta} with
  \begin{paracol}{2}
    \begin{leftcolumn}
      \ParacolAlignmentHack
      \begin{equation*}\taglabel[\ensuremath{ \logic{ParRed}_\beta }]{inf:def:parallel_reduction/beta}
        \begin{prooftree}
          \hypo{ A \pbred C }
          \hypo{ B \pbred D }
          \infer2[\ref{inf:def:parallel_reduction/beta}]{ (\qabs x A) B \pbred C[x \mapsto D] }.
        \end{prooftree}
      \end{equation*}
    \end{leftcolumn}

    \begin{rightcolumn}
      \ParacolAlignmentHack
      \begin{equation*}\taglabel[\ensuremath{ \logic{ParRed}_\eta }]{inf:def:parallel_reduction/eta}
        \begin{prooftree}
          \hypo{ x \not\in \op*{Free}(A) }
          \hypo{ A \pered B }
          \infer2[\ref{inf:def:parallel_reduction/eta}]{ \qabs x A x \pered B }.
        \end{prooftree}
      \end{equation*}
    \end{rightcolumn}
  \end{paracol}

  \thmitem{def:parallel_reduction/delta} We do not need to adapt \hyperref[def:delta_reduction]{\( \delta \)-reduction} rules, but for completeness we will restate the rule for the constant \( C \) as follows:
  \begin{equation*}\taglabel[\ensuremath{ \logic{ParRed}_{\delta_C} }]{inf:def:parallel_reduction/delta}
    \begin{prooftree}
      \infer0[\ref{inf:def:delta_reduction}]{ \underbrace{C}_{\T{\term{\( \delta \)-redex}}} \dred \underbrace{\op*{\delta}(C)}_{\T{\term{\( \delta \)-contractum}}} }.
    \end{prooftree}
  \end{equation*}
\end{definition}
\begin{comments}
  \item This definition is based on \cite[\S 3.2.3]{Barendregt1984LambdaCalculus}, where only parallel \( \beta \)-reduction is considered.
  \item Of course, we also consider equivalences and multi-step reductions based on the above single-step reductions.
\end{comments}

\begin{example}\label{ex:def:parallel_reduction}
  We list examples of \hyperref[def:parallel_reduction]{parallel reduction}:
  \begin{thmenum}
    \thmitem{ex:def:parallel_reduction/two}\mcite[\S 3.4.2]{Mimram2020ProgramEqualsProof} Consider the term
    \begin{equation*}
      M = (\qabs \synx \qabs \syny I \synx \syny)(I I),
    \end{equation*}
    where \( \ref{eq:ex:def:lambda_term/combinator/i} = \qabs \synx \synx \).

    We saw in \fullref{ex:def:beta_eta_reduction/i} that \( I A \bred A \) for any term \( A \), thus \( I I \bred I \) and \( I \synx \bred \synx \) are two possible \( \beta \)-reductions in \( M \).

    With single-step \( \beta \)-reduction, \ref{inf:def:lambda_term_reduction/app_left} and \ref{inf:def:lambda_term_reduction/app_right} allow us to only perform a reduction in the first or second component of \( M \), thus the two reductions discussed above have to be performed sequentially.

    With parallel \( \beta \)-reduction, however, \ref{inf:def:parallel_reduction/app} allows us to perform both single-step reductions in parallel, thus
    \begin{equation*}
      M \pbred (\qabs \synx \qabs \syny \synx \syny) I.
    \end{equation*}

    Furthermore, the entire term \( M \) is a \( \beta \)-redex, and \ref{inf:def:parallel_reduction/beta} allows us to perform all three single-step reductions in one parallelized step:
    \begin{equation*}
      M \pbred \qabs \syny I \syny.
    \end{equation*}

    The obtained term is again a \( \beta \)-redex, however no rule for parallel reduction allows us to reduce it during the first step. This is desired because it does not correspond to a \( \beta \)-redex in \( M \). So, a reduction of \( \qabs \syny I \syny \) to \( \qabs \syny \syny \) must be performed in a second step.
  \end{thmenum}
\end{example}

\begin{proposition}\label{thm:def:parallel_reduction}
  Let \enquote{\( {\Anon} \)} be a combination of \enquote{\( \beta \)}, \enquote{\( \eta \)} and \enquote{\( \delta \)}. Then the \hyperref[def:parallel_reduction]{parallel reduction relation} \( {\ppred} \) has the following basic properties:
  \begin{thmenum}
    \thmitem{thm:def:parallel_reduction/alpha_reflexive} It is \hyperref[def:alpha_reflexive]{\( \alpha \)-reflexive}.
    \thmitem{thm:def:parallel_reduction/extends_single_step} It extends single-step reduction: if \( M \pred N \), then \( M \ppred N \).
    \thmitem{thm:def:parallel_reduction/extends_to_multi_step} It extends to multi-step reduction: if \( M \ppred N \), then \( M \pred* N \).
    \thmitem{thm:def:parallel_reduction/multi} The multi-step extensions of \( {\pred} \) and \( {\ppred} \) coincide.
    \thmitem{thm:def:parallel_reduction/free} A generalization of \fullref{thm:lambda_term_reduction_free_variables} holds: if \( M \ppred N \), then \( \op*{Free}(M) \supseteq \op*{Free}(N) \).
  \end{thmenum}
\end{proposition}
\begin{proof}
  \SubProofOf{thm:def:parallel_reduction/alpha_reflexive} We will use \fullref{thm:induction_on_recursively_defined_relations} on \( M \aequiv N \) to show that \( M \ppred N \):
  \begin{itemize}
    \item If \( M \aequiv N \) due to \ref{inf:def:lambda_term_alpha_equivalence/atom}, then \( M \) and \( N \) are equal atomic \( \muplambda \)-terms. The rule \ref{inf:def:parallel_reduction/atom} specifically crafted for this purpose implies that \( M \ppred M \).

    \item If \( M \aequiv N \) due to \ref{inf:def:lambda_term_alpha_equivalence/app}, then \( M = AB \) and \( N = CD \), where \( A \aequiv C \) and \( B \aequiv D \). The inductive hypothesis implies that \( A \ppred C \) and \( B \ppred D \). We then use \ref{inf:def:parallel_reduction/app} to conclude that \( M = AB \ppred CD = N \).

    \item If \( M \aequiv N \) due to \ref{inf:thm:alpha_equivalence_simplified/lift}, then \( M = \qabs x A \) and \( N = \qabs x B \), where \( A \aequiv B \). The inductive hypothesis implies that \( A \ppred B \), and \ref{inf:def:parallel_reduction/abs} implies that \( M \ppred N \).

    \item Finally, if \( M \aequiv N \) due to \ref{inf:thm:alpha_equivalence_simplified/ren}, then \( M = \qabs a A \), \( N = \qabs b B \), \( a \) is not free in \( B \) and \( A \aequiv B[b \mapsto a] \).

    The inductive hypothesis implies that \( A \ppred B[b \mapsto a] \) and \ref{inf:def:parallel_reduction/abs} implies that
    \begin{equation*}
      \qabs a A \ppred \qabs a B[b \mapsto a].
    \end{equation*}

    Furthermore, since \( a \) is not free in \( B \), \fullref{thm:alpha_conversion} implies that \( \qabs b B \aequiv \qabs a B[b \mapsto a] \). We can thus use \ref{inf:def:lambda_term_reduction/alpha} to conclude that
    \begin{equation*}
      M = \qabs a A \ppred \qabs b B = N.
    \end{equation*}
  \end{itemize}

  \SubProofOf{thm:def:parallel_reduction/extends_single_step} This is straightforward considering that we have mitigated the subtlety discussed in \fullref{def:parallel_reduction/atom}.

  \SubProofOf{thm:def:parallel_reduction/extends_to_multi_step} We will use \fullref{thm:induction_on_recursively_defined_relations} on \( M \ppred N \) to show that \( M \pred* N \):
  \begin{itemize}
    \item If \( M \ppred N \) due to \ref{inf:def:parallel_reduction/atom}, then \( M \) and \( N \) are equal atomic \( \muplambda \)-terms, hence \( M \pred* N \) due to the latter being reflexive.

    \item If \( M \ppred N \) due to \ref{inf:def:parallel_reduction/app}, then \( M = AB \) and \( N = CD \), where \( A \ppred C \) and \( B \ppred D \) and the inductive hypothesis holds for the latter two.

    The inductive hypothesis on \( A \ppred C \) implies that \( A \pred* C \), i.e. there exists some reduction sequence
    \begin{equation*}
      A = C_0 \pred C_1 \pred \cdots \pred C_n = C.
    \end{equation*}

    We can show that \( AB \pred C_i B \) by induction on \( i \):
    \begin{itemize}
      \item If \( i = 0 \), then \( AB = C_i B \), and \( AB \pred C_i B \) follows from the reflexivity shown in \fullref{thm:def:parallel_reduction/alpha_reflexive}.

      \item If \( AB \pred* C_i B \), then \ref{inf:def:lambda_term_reduction/app_left} implies that \( AB \pred* C_{i+1} B \).
    \end{itemize}

    Therefore, \( AB \pred* CB \). Similarly, we can use induction on the numbers of steps in \( B \pred* D \) to conclude via \ref{inf:def:lambda_term_reduction/app_right} that
    \begin{equation*}
      M = AB \pred* CB \pred* CD = N.
    \end{equation*}

    \item If \( M \ppred N \) due to \ref{inf:def:parallel_reduction/abs}, then \( M = \qabs x A \) and \( N = \qabs x B \), where \( A \ppred B \) and the inductive hypothesis holds for the latter.

    Using the corresponding single-step rule \ref{inf:def:lambda_term_reduction/abs}, by induction on the number of steps in \( A \pred* B \) we can show that
    \begin{equation*}
      M = \qabs x A \pred* \qabs x B = N.
    \end{equation*}

    \item If \( M \ppred N \) due to \ref{inf:def:parallel_reduction/alpha}, then \( M \aequiv M' \) and \( N' \aequiv N \), where \( M' \ppred N' \) and the inductive hypothesis holds for the latter.

    Then \( M' \pred* N' \), and we again proceed by induction on the number of single-step reductions.

    \item If \( M \ppred N \) due to \ref{inf:def:parallel_reduction/beta}, then \( M = (\qabs x A)B \) and \( N = C[x \mapsto D] \), where \( A \ppred C \) and \( B \ppred D \) and the inductive hypothesis holds for the latter two.

    We can show by induction on the number of steps in \( A \pred* C \) that
    \begin{equation*}
      (\qabs x A)B \pred* (\qabs x C)B
    \end{equation*}
    and similarly that
    \begin{equation*}
      (\qabs x C)B \pred* (\qabs x C)D.
    \end{equation*}

    Then
    \begin{equation*}
      M = (\qabs x A) B \pred* (\qabs x C)D
    \end{equation*}
    and we can apply \ref{inf:def:beta_eta_reduction/beta} to conclude that
    \begin{equation*}
      M \pred* (\qabs x C)D \pred C[x \mapsto D] = N.
    \end{equation*}

    \item If \( M \ppred N \) due to \ref{inf:def:parallel_reduction/eta}, then \( M = \qabs x A x \), where \( x \) is not free in \( A \), \( A \ppred N \), and the inductive hypothesis holds for the latter.

    Via induction on the number of steps in \( A \pred* N \) we conclude that
    \begin{equation*}
      M = \qabs x A x \pred* \qabs x N x.
    \end{equation*}

    By \fullref{thm:lambda_term_reduction_free_variables}, every free variable in \( N \) is also free in \( A \), thus \( x \) cannot be free in \( N \). Then we can apply \ref{inf:def:beta_eta_reduction/eta} to obtain \( M \pred* N \).

    \item If \( M \ppred N \) due to \ref{inf:def:delta_reduction}, the same application of \ref{inf:def:delta_reduction} allows concluding that \( M \pred N \).
  \end{itemize}

  \SubProofOf{thm:def:parallel_reduction/multi} Follows from \fullref{thm:def:parallel_reduction/extends_to_multi_step}.

  \SubProofOf{thm:def:parallel_reduction/free} Follows from \fullref{thm:lambda_term_reduction_free_variables} and \fullref{thm:def:parallel_reduction/extends_single_step}.
\end{proof}

\begin{proposition}\label{thm:substitution_on_parallel_reduction}
  Let \enquote{\( {\Anon} \)} be a combination of \enquote{\( \beta \)}, \enquote{\( \eta \)} and \enquote{\( \delta \)}.

  Fix \( \muplambda \)-terms \( M \) and \( N \) such that \( M \ppred N \). Fix also substitutions \( \Bbbs \) and \( \Bbbt \) such that, for every variable \( u \), we have \( \Bbbs(u) \ppred \Bbbt(u) \).

  Then \( M[\Bbbs] \ppred N[\Bbbt] \).
\end{proposition}
\begin{proof}
  Similar to \fullref{thm:substitution_on_single_step_reduction}, with minor differences.
\end{proof}

\begin{lemma}\label{thm:parallel_reduction_deconstruction}
  Let \enquote{\( {\Anon} \)} be a combination of \enquote{\( \beta \)}, \enquote{\( \eta \)} and \enquote{\( \delta \)}.

  If \( M \ppred N \), depending on the structure of \( M \), we have the following possibilities:
  \begin{thmenum}
    \thmitem{thm:parallel_reduction_deconstruction/const} If \( M \) is a constant, we have two possibilities:
    \begin{thmenum}
      \thmitem{thm:parallel_reduction_deconstruction/const/noop} \( M = N \).

      \thmitem{thm:parallel_reduction_deconstruction/const/delta} If \( \delta \)-reduction is allowed, it is possible that \( N \aequiv \op*{\delta}(M) \), where \( \op*{\delta}(M) \) is the \( \delta \)-contractum  of \( M \).
    \end{thmenum}

    \thmitem{thm:parallel_reduction_deconstruction/var} If \( M \) is a variable, then \( M = N \).

    \thmitem{thm:parallel_reduction_deconstruction/app} If \( M = AB \), we have two possibilities:
    \begin{thmenum}
      \thmitem{thm:parallel_reduction_deconstruction/app/direct} \( N = CD \), where \( C \) and \( D \) are some \( \muplambda \)-terms such that \( A \ppred C \) and \( B \ppred D \).

      \thmitem{thm:parallel_reduction_deconstruction/app/beta} If \( \beta \)-reduction is allowed, it is possible that \( A = \qabs x E \) for some variable \( x \) and \( \muplambda \)-term \( E \) and \( N \aequiv F[x \mapsto G] \) for some \( \muplambda \)-terms \( F \) and \( G \) such that \( B \ppred G \) and \( E \ppred F \).
    \end{thmenum}

    \thmitem{thm:parallel_reduction_deconstruction/abs} If \( M = \qabs x A \), we again have two possibilities:
    \begin{thmenum}
      \thmitem{thm:parallel_reduction_deconstruction/abs/lift} \( N \aequiv \qabs x B \), where \( B \) is some \( \muplambda \)-term such that \( A \ppred B \).

      \thmitem{thm:parallel_reduction_deconstruction/abs/eta} If \( \eta \)-reduction is allowed, it is possible that \( A \aequiv Nx \) and \( x \not\in \op*{Free}(N) \).
    \end{thmenum}
  \end{thmenum}
\end{lemma}
\begin{comments}
  \item The main purpose of this lemma is to simplify handling \ref{inf:def:lambda_term_reduction/alpha} in the proof of \fullref{thm:church_rosser_theorem}.

  \item An analogous statement for single-step reductions is \fullref{thm:single_step_reduction_deconstruction}.
\end{comments}
\begin{proof}
  \SubProofOf{thm:parallel_reduction_deconstruction/const} Suppose that \( M \) is a constant.

  There are three rules allowing to conclude that \( M \ppred N \):
  \begin{itemize}
    \item \ref{inf:def:parallel_reduction/atom} is applicable if \( M \) and \( N \) are equal atomic \( \muplambda \)-terms, in which case \fullref{thm:parallel_reduction_deconstruction/const/noop} holds.

    \item \ref{inf:def:parallel_reduction/delta} is applicable if \( N \) is the \( \delta \)-contractum of \( M \). In this case \fullref{thm:parallel_reduction_deconstruction/const/delta} holds.

    \item \ref{inf:def:parallel_reduction/alpha} is applicable if \( M \aequiv M' \) and \( N \aequiv N' \), and \( M' \ppred N' \), where the inductive hypothesis holds for the latter. Since \( M' \) is constant, \( M = M' \), and \fullref{thm:parallel_reduction_deconstruction/const} gives us the following possibilities for \( M \ppred N' \):

    \begin{itemize}
      \item If \( M = N' \), then \( N' \) is also a constant and hence \( N' = N \) and \( M = N \). This leads to \fullref{thm:parallel_reduction_deconstruction/const/noop} for \( M \ppred N \).

      \item If \( N' \aequiv \op*{\delta}(M) \), by transitivity of \( \alpha \)-equivalence, we also have \( N \aequiv \op*{\delta}(M) \). This leads to \fullref{thm:parallel_reduction_deconstruction/const/delta} for \( M \ppred N \).
    \end{itemize}
  \end{itemize}

  \SubProofOf{thm:parallel_reduction_deconstruction/var} If \( M \) is a variable, the only rules applicable to \( M \ppred N \) are \ref{inf:def:parallel_reduction/atom} and \ref{inf:def:parallel_reduction/alpha}, and both imply that \( M = N \).

  \SubProofOf{thm:parallel_reduction_deconstruction/app} Let \( M = AB \). We will use \fullref{thm:induction_on_recursively_defined_relations} on \( AB \ppred N \):
  \begin{itemize}
    \item If \( AB \ppred N \) due to \ref{inf:def:parallel_reduction/app}, then \fullref{thm:parallel_reduction_deconstruction/app/direct} holds.

    \item If \( AB \ppred N \) due to \ref{inf:def:parallel_reduction/beta}, then \fullref{thm:parallel_reduction_deconstruction/app/beta} holds.

    \item If \( AB \ppred N \) due to \ref{inf:def:parallel_reduction/delta}, then \fullref{thm:parallel_reduction_deconstruction/const/delta} holds.

    \item If \( AB \ppred N \) due to \ref{inf:def:parallel_reduction/alpha}, then \( AB \aequiv A' B' \) and \( N \aequiv N' \), where \( A' B' \ppred N' \) and the inductive hypothesis holds for the latter.

    \Fullref{thm:parallel_reduction_deconstruction/app} lists the following possibilities:
    \begin{itemize}
      \item The possibility \fullref{thm:parallel_reduction_deconstruction/app/direct} for \( A' B' \ppred N' \) implies that \( N' \) is an application, say \( N' = C' D' \), such that \( A' \ppred C' \) and \( B' \ppred D' \). Furthermore, due to \ref{inf:def:lambda_term_alpha_equivalence/app}, we conclude that \( N \) is also an application, say \( N = CD \), where \( C \aequiv C' \) and \( D \aequiv D' \).

      Then \ref{inf:def:lambda_term_reduction/alpha} implies that \( A \ppred C \) and \( B \ppred D \), which is the desired result since it leads to \fullref{thm:parallel_reduction_deconstruction/app/direct}.

      \item The possibility \fullref{thm:parallel_reduction_deconstruction/app/beta} for \( A' B' \ppred N' \) implies that \( A' = \qabs y E' \) and \( N' \aequiv F'[y \mapsto G'] \), where \( B' \ppred G' \) and \( E' \ppred F' \).

      \begin{itemize}
        \item If \( A \aequiv A' \) due to \ref{inf:thm:alpha_equivalence_simplified/lift}, then \( A = \qabs y E \), where \( E \aequiv E' \). Via \ref{inf:def:lambda_term_reduction/alpha} we conclude that \( E \ppred F' \).

        Then \fullref{thm:parallel_reduction_deconstruction/app/beta} holds with \( x \coloneqq y \), \( G \coloneqq G' \) and \( F \coloneqq F' \).

        \item If \( A \aequiv A' \) due to \ref{inf:thm:alpha_equivalence_simplified/ren}, then \( A = \qabs x E \), where \( x \) is not free in \( E' \), and \( E \aequiv E'[y \mapsto x] \).

        Let \( F \coloneqq F'[y \mapsto x] \). Since \( E' \ppred F' \), we have \( E'[y \mapsto x] \ppred F \) due to \fullref{thm:substitution_on_parallel_reduction} and \( E \ppred F \) due to \ref{inf:def:lambda_term_reduction/alpha}.

        By \fullref{thm:def:parallel_reduction/free}, \( x \) is not free in \( F' \) since otherwise it would be free in \( E' \). Let \( G \coloneqq G' \). Then
        \begin{equation*}
          N
          \aequiv
          N'
          \aequiv
          F'[y \mapsto G']
          \reloset {\eqref{eq:thm:substitution_chain_contraction/precomposition}} \aequiv
          \underbrace{F'[y \mapsto x]}_F [x \mapsto \underbrace{G'}_G],
        \end{equation*}
        thus \fullref{thm:parallel_reduction_deconstruction/app/beta} holds.
      \end{itemize}
    \end{itemize}
  \end{itemize}

  \SubProofOf{thm:parallel_reduction_deconstruction/abs} Let \( M = \qabs x A \). We will use \fullref{thm:induction_on_recursively_defined_relations} on \( (\qabs x A) \ppred N \):
  \begin{itemize}
    \item If \( (\qabs x A) \ppred N \) due to \ref{inf:def:lambda_term_reduction/abs}, then \fullref{thm:parallel_reduction_deconstruction/abs/lift} holds.

    \item If \( (\qabs x A) \ppred N \) due to \ref{inf:def:beta_eta_reduction/eta}, then \fullref{thm:parallel_reduction_deconstruction/abs/eta} holds.

    \item If \( (\qabs x A) \ppred N \) due to \ref{inf:def:lambda_term_reduction/alpha}, then \( \qabs x A = M \aequiv M' \) and \( N \aequiv N' \), where \( M' \ppred N' \) and the inductive hypothesis holds for the latter.

    Furthermore, \ref{inf:def:lambda_term_alpha_equivalence/abs} implies that \( M' = \qabs y A' \), where \( A[x \mapsto n] \aequiv A'[y \mapsto n] \) for every \( n \) not free in \( M \). In particular, \( A \aequiv A'[y \mapsto x] \).

    \Fullref{thm:parallel_reduction_deconstruction/abs} lists the following possibilities for \( (\qabs y A') \ppred N' \):
    \begin{itemize}
      \item In the case \fullref{thm:parallel_reduction_deconstruction/abs/lift}, we have \( N' \aequiv \qabs y B' \), where \( A' \ppred B' \).

      Let \( B \coloneqq B'[y \mapsto x] \). Then \fullref{thm:substitution_on_parallel_reduction} implies that \( A'[y \mapsto x] \ppred B \) and \ref{inf:def:lambda_term_reduction/alpha} implies that \( A \ppred B \).

      Furthermore, we have
      \begin{equation*}
        N
        \aequiv
        N'
        \aequiv
        \qabs y B'
        \reloset {\eqref{eq:thm:alpha_conversion}} \aequiv
        \qabs x B.
      \end{equation*}

      We conclude that \fullref{thm:parallel_reduction_deconstruction/abs/lift} holds.

      \item In the case \fullref{thm:parallel_reduction_deconstruction/abs/eta}, we have \( A' \aequiv N'y \) and \( y \not\in \op*{Free}(N') \). Then
      \begin{equation*}
        A
        \aequiv
        A'[y \mapsto x]
        \reloset {\ref{thm:substitution_on_alpha_equivalent_terms}} \aequiv
        N'[y \mapsto x] \thinspace x
        \reloset {\ref{thm:lambda_substitution_noop}} =
        N' x
        \aequiv
        N x.
      \end{equation*}

      It remains to show that \( x \) is not free in \( N \). Suppose that it is. \Fullref{thm:def:parallel_reduction/free} implies that it is free in \( M' \) also, and \fullref{thm:def:lambda_term_alpha_equivalence/free} implies that it is free in \( M \), which is a contradiction.

      Therefore, \( x \) is not free in \( N \), and \fullref{thm:parallel_reduction_deconstruction/abs/eta} follows.
    \end{itemize}
  \end{itemize}
\end{proof}

\paragraph{Confluence}

\begin{definition}\label{def:reduction_confluence}\mcite[14]{TroelstraSchwichtenberg2000BasicProofTheory}
  We say that a \hyperref[def:lambda_term_reduction]{reduction relation} \( {\pred} \) is \term{confluent} if, whenever \( M \pred N \) and \( M \pred K \), there exists a \( \muplambda \)-term \( L \) such that \( N \pred L \) and \( K \pred L \). We call this term a  \term{confluence point} of \( N \) and \( K \).

  A \term{weak confluence point} is instead a \( \muplambda \)-term \( L \) such that \( M \pred* N \) and \( K \pred* L \). We define weak confluence analogously.

  \begin{figure}[!ht]
    \hfill
    \includegraphics[page=1]{output/def__reduction_confluence}
    \hfill
    \includegraphics[page=2]{output/def__reduction_confluence}
    \hfill
    \hfill
    \caption{\hyperref[def:reduction_confluence]{Confluence} and \hyperref[def:reduction_confluence]{weak confluence} as \hyperref[def:hasse_diagram]{Hasse diagrams}.}\label{fig:def:relation_confluence}
  \end{figure}
\end{definition}
\begin{comments}
  \item Every confluence point of \( N \) and \( K \) is an upper bound. The concept of confluence does not make sense, however, unless \( N \) and \( K \) already have a lower bound. If they do, then any upper bound is a confluence point.

  \item The terminology regarding confluence is inconsistent across the literature. A major distinction is that the authors we will list consider binary relations on plain sets. A proper definition requires the binary relations to satisfy certain coherence conditions resembling those of \( \muplambda \)-term reductions, so we prefer working with reductions directly.

  We mostly follow \incite[14]{TroelstraSchwichtenberg2000BasicProofTheory}, who use the phrase \enquote{(weak) Church-Rosser property} synonymously with \enquote{(weak) confluence}.
  \begin{itemize}
    \item \incite[ch. 3]{Barendregt1984LambdaCalculus} uses the phrase \enquote{(weak) diamond property} for what we call \enquote{confluence} applied to general binary relations, while defining a relation to have the (weak) \enquote{Church-Rosser property} if its reflexive and transitive closure has the (weak) diamond property.

    \item \incite[3.4.1]{Mimram2020ProgramEqualsProof} uses \enquote{confluence} for what Barendregt calls the \enquote{Church-Rosser property}.
  \end{itemize}

  The term \enquote{confluence point} is used in a more informal context by \incite[630]{AhoEtAl2006Compilers}.
\end{comments}

\begin{proposition}\label{thm:def:reduction_confluence}
  \hyperref[def:reduction_confluence]{Confluence} has the following basic properties:
  \begin{thmenum}
    \thmitem{thm:def:reduction_confluence/normal_implies_weak} If a \hyperref[def:lambda_term_reduction/single]{single-step reduction relation} is confluent, it is also weakly confluent.

    \thmitem{thm:def:reduction_confluence/multi_implies_weak} If a \hyperref[def:lambda_term_reduction/single]{multi-step reduction relation} is confluent, the corresponding single-step relation is weakly confluent.

    \thmitem{thm:def:reduction_confluence/weak_implies_multi} If a single-step reduction relation is weakly confluent, the corresponding multi-step relation is confluent.
  \end{thmenum}
\end{proposition}
\begin{proof}
  \SubProofOf{thm:def:reduction_confluence/normal_implies_weak} Trivial.
  \SubProofOf{thm:def:reduction_confluence/multi_implies_weak} Trivial.
  \SubProofOf{thm:def:reduction_confluence/weak_implies_multi} Suppose \( {\pred} \) is weakly confluent and let \( M \pred* N \) and \( M \pred* K \).

  If \( M \pred* N \) because \( M \aequiv N \), then \ref{inf:def:lambda_term_reduction/alpha} implies that \( N \pred* K \) and thus \( K \) is a weak confluence point of \( N \) and \( K \). Analogously, if \( M \pred* K \) because \( M \aequiv K \), then \( N \) is a confluence point.

  Otherwise, there exist reduction sequences
  \begin{equation*}
    M = N_0 \pred N_1 \pred \cdots \pred N_n = N
  \end{equation*}
  and
  \begin{equation*}
    M = K_0 \pred K_1 \pred \cdots \pred K_k = K.
  \end{equation*}

  We will use induction on \( i = 0, \ldots, \min\set{ n, k } \) to show that there exists a weak confluence point \( L_i \) such that \( N_i \pred* L_i \) and \( K_i \pred* L_i \).

  \begin{itemize}
    \item In the base case \( i = 0 \), \( M = N_i = K_i \), thus we can take \( L_i \) to be \( M \) itself.

    \item Suppose that the inductive hypothesis holds for \( i < \min\set{ n, k } \) and let \( L_i \) be the weak confluence point of \( N_i \) and \( K_i \).

    We thus have \( N_i \pred N_{i+1} \) and \( N_i \pred* L_i \). Since \( {\pred} \) is weakly confluent, there exist weak confluence points \( A \) of \( N_{i+1} \) and \( L_i \) and \( B \) of \( K_{i+1} \) and \( L_i \).

    Finally, let \( L_{i+1} \) be a weak confluence point of \( A \) and \( B \). Then \( N_{i+1} \pred* A \pred* L_{i+1} \) and \( K_{i+1} \pred* B \pred* L_{i+1} \).

    \begin{figure}[!ht]
      \centering
      \includegraphics[page=1]{output/thm__def__reduction_confluence}
      \caption{An illustration of the inductive step in our proof of \fullref{thm:def:reduction_confluence/weak_implies_multi}}\label{fig:thm:confluence_of_reflexive_transitive_closure}
    \end{figure}
  \end{itemize}

  We now have the following possibilities:
  \begin{itemize}
    \item If \( n = k \), let \( L \coloneqq L_n = L_k \).
    \item If \( n > k \), for \( i > k \) let \( L_{i+1} \) be a weak confluence point of \( N_{i+1} \) and \( L_i \), and let \( L \coloneqq L_n \).
    \item If \( n < k \), for \( i > n \) let \( L_{i+1} \) be a weak confluence point of \( K_{i+1} \) and \( L_i \), and let \( L \coloneqq L_k \).
  \end{itemize}

  In all cases, \( N \pred* L \) and \( K \pred* L \).
\end{proof}

\paragraph{Church-Rosser theorem}

\begin{theorem}[Church-Rosser theorem]\label{thm:church_rosser_theorem}
  Let \enquote{\( {\Anon} \)} be a combination of \enquote{\( \beta \)}, \enquote{\( \eta \)} and \enquote{\( \delta \)}.

  \begin{thmenum}
    \thmitem{thm:church_rosser_theorem/parallel} \hyperref[def:parallel_reduction]{Parallel \( \Anon \)-reduction} is \hyperref[def:reduction_confluence]{confluent}.

    \thmitem{thm:church_rosser_theorem/multi_step} \hyperref[def:lambda_term_reduction/multi]{Multi-step \( \Anon \)-reduction} is \hyperref[def:reduction_confluence]{confluent}.

    \thmitem{thm:church_rosser_theorem/single_step} \hyperref[def:lambda_term_reduction/single]{Single-step \( \Anon \)-reduction} is only \hyperref[def:reduction_confluence]{weakly confluent}.
  \end{thmenum}
\end{theorem}
\begin{comments}
  \item A variant of this theorem holds for (simply) \hyperref[def:typability]{typable} terms --- see \fullref{thm:simply_typed_church_rosser_theorem}.
\end{comments}
\begin{proof}
  \SubProofOf{thm:church_rosser_theorem/parallel} Suppose that \( M \ppred N \) and \( M \ppred K \). We will use \fullref{thm:induction_on_recursively_defined_relations} on \( M \ppred N \) simultaneously on all \( K \) to show the existence of the desired confluence point \( L \) such that \( N \ppred L \) and \( N \ppred L \):
  \begin{itemize}
    \item If \( M \ppred N \) due to \ref{inf:def:parallel_reduction/atom}, then \( M \) and \( N \) are identical atomic terms.

    \begin{itemize}
      \item If \( M \) is a constant, \fullref{thm:parallel_reduction_deconstruction/const} for \( M \ppred K \) gives us two possibilities:
      \begin{itemize}
        \item If \( M = K \), let \( L \coloneqq K \). Then \( M = N = K = L \). The rule \ref{inf:def:parallel_reduction/atom} allows us to conclude that \( N \pred L \) and \( K \ppred L \).

        \item If \( K \aequiv \op*{\delta}(M) \), let \( L \coloneqq \op*{\delta}(M) \). Then \( N = M \) \( \delta \)-reduces to \( L \), so \( N \ppred L \) due to \ref{def:parallel_reduction/delta}.

       Since \( K \aequiv L \), we have \( K \ppred L \) since, by \fullref{thm:def:parallel_reduction/alpha_reflexive}, \( {\ppred} \) is \( \alpha \)-reflexive.
      \end{itemize}

      \item If \( M \) is a variable, \fullref{thm:parallel_reduction_deconstruction/var} implies that \( M = K \). Again let \( L \coloneqq K \), so that \( M = N = K = L \).

      We can again use \ref{inf:def:parallel_reduction/atom} to conclude that \( N \ppred L \) and \( K \ppred L \).
    \end{itemize}

    \item If \( M \ppred N \) due to \ref{inf:def:parallel_reduction/alpha}, then \( M \aequiv B \ppred C \aequiv N \) for some \( \muplambda \)-terms \( B \) and \( C \), where the inductive hypothesis holds for \( B \ppred C \).

    Since \( M \ppred K \), we have \( B \ppred K \) due to \ref{inf:def:parallel_reduction/alpha}, and the inductive hypothesis on \( B \ppred C \) implies that there exists some \( \muplambda \)-term \( L \) such that \( K \ppred L \) and \( C \ppred L \).

    Since \( C \aequiv N \) We can use \ref{inf:def:lambda_term_reduction/alpha} again to conclude that \( N \ppred L \).

    \item If \( M \ppred N \) due to \ref{inf:def:parallel_reduction/app}, we have \( M = AB \) and \( N = CD \) for some \( \muplambda \)-terms \( A \), \( B \), \( C \) and \( D \), where \( A \ppred C \) and \( B \ppred D \) and the inductive hypothesis holds for the latter two.

    \Fullref{thm:parallel_reduction_deconstruction/app} lists the following possibilities for \( M = AB \ppred K \):
    \begin{itemize}
      \item In the case \fullref{thm:parallel_reduction_deconstruction/app/direct} for \( AB \ppred K \), we have \( K = EF \) for some \( \muplambda \)-terms \( E \) and \( F \), where \( A \ppred E \) and \( B \ppred F \).

      The inductive hypotheses on \( A \ppred C \) implies the existence of a confluence point \( G \) of \( C \) and \( E \), and similarly the hypothesis on \( B \ppred D \) implies the existence of a confluence point \( H \) of \( D \) and \( F \).

      Let \( L \coloneqq GH \). Then \ref{inf:def:parallel_reduction/app} allows us to conclude that \( N \ppred L \) and \( K \ppred L \).

      This is illustrated in the diagram
      \begin{equation*}
        \includegraphics[page=1]{output/thm__church_rosser_theorem}
      \end{equation*}

      \item In the case \fullref{thm:parallel_reduction_deconstruction/app/beta} for \( AB \ppred K \), which requires the \( \beta \)-reduction rule \ref{inf:def:parallel_reduction/eta}, we have \( A = \qabs x E \) and \( K \aequiv F[x \mapsto G] \), where \( B \ppred G \) and \( E \ppred F \).

      To summarize:
      \begin{align*}
        M &= (\qabs x E) B,           &&\qabs x E \ppred C,            \\
        N &= C D,                     &&B \ppred D \T{and} B \ppred G, \\
        K &\aequiv F[x \mapsto G],    &&E \ppred F.
      \end{align*}

      Since \( E \ppred F \), \ref{inf:def:lambda_term_reduction/abs} implies that \( A = \qabs x E \ppred \qabs x F \). Then, by the inductive hypothesis on \( A \ppred C \), there exists a confluence point \( P \) of \( C \) and \( \qabs x F \). Furthermore, by the inductive hypothesis on \( B \ppred D \), there exists a confluence point \( R \) of \( D \) and \( G \).

      This leads to the following diagrams:
      \begin{equation*}
        \includegraphics[page=2]{output/thm__church_rosser_theorem}
        \quad\quad
        \includegraphics[page=3]{output/thm__church_rosser_theorem}
      \end{equation*}

      \Fullref{thm:parallel_reduction_deconstruction/abs} lists the following possibilities for \( \qabs x F \ppred P \):
      \begin{itemize}
        \item In the case \fullref{thm:parallel_reduction_deconstruction/abs/lift} for \( (\qabs x F) \ppred P \), we have \( P \aequiv \qabs x Q \) for some \( \muplambda \)-term \( Q \) such that \( P \ppred Q \). The rule \ref{inf:def:parallel_reduction/alpha} implies that \( (\qabs x F) \ppred (\qabs x Q) \), and \ref{inf:def:parallel_reduction/abs} allows inferring that \( F \ppred Q \).

        This leads to the following diagram:
        \begin{equation*}
          \includegraphics[page=4]{output/thm__church_rosser_theorem}
        \end{equation*}

        Since \( G \ppred R \), by \fullref{thm:substitution_on_parallel_reduction},
        \begin{equation*}
          F[x \mapsto G] \ppred Q[x \mapsto R].
        \end{equation*}

        Since \( K \aequiv F[x \mapsto G] \), using \ref{inf:def:parallel_reduction/alpha}, we conclude that \( K \ppred Q[x \mapsto R] \).

        Let \( L \coloneqq Q[x \mapsto R] \). Since \( C \ppred P \) and \( P \aequiv \qabs x Q \), using \ref{inf:def:parallel_reduction/alpha}, we conclude that \( C \ppred \qabs x Q \).

        We also have \( D \ppred R \). Applying \ref{inf:def:parallel_reduction/beta} yields
        \begin{equation*}
          N = CD \ppred Q[x \mapsto R] = L,
        \end{equation*}
        so \( L \) is the desired confluence point of \( N \) and \( K \).

        \item In the case \fullref{thm:parallel_reduction_deconstruction/abs/eta} for \( (\qabs x F) \ppred P \), which requires the \( \eta \)-reduction rule \ref{inf:def:parallel_reduction/eta}, \( x \) is not free in \( P \) and \( F \aequiv Px \).

        This leads to the following diagram:
        \begin{equation*}
          \includegraphics[page=5]{output/thm__church_rosser_theorem}
        \end{equation*}

        Let \( L \coloneqq PR \). Applying \ref{inf:def:parallel_reduction/app} yields
        \begin{equation*}
          N = CD \ppred PR = L.
        \end{equation*}

        The other case is a bit more complicated. By \( \alpha \)-reflexivity of parallel reduction, \( F \aequiv Px \) implies \( F \ppred Px \), hence we can use \fullref{thm:substitution_on_parallel_reduction} as follows:
        \begin{equation*}
          F[x \mapsto G] \ppred (Px)[x \mapsto R] = P[x \mapsto R] \thinspace R.
        \end{equation*}

        Since \( x \) is not free in \( P \), \fullref{thm:lambda_substitution_noop} implies that \( P[x \mapsto R] = P \), and thus
        \begin{equation*}
          F[x \mapsto G] \ppred PR = L.
        \end{equation*}

        Since \( K \aequiv F[x \mapsto G] \), the desired reduction \( K \ppred L \) follows by an application of \ref{inf:def:parallel_reduction/alpha}.
      \end{itemize}
    \end{itemize}

    \item If \( M \ppred N \) due to \ref{inf:def:lambda_term_reduction/abs}, then \( M = \qabs x A \) and \( N = \qabs x B \) for some variable \( x \) and some \( \muplambda \)-terms \( A \) and \( B \), where \( A \ppred B \) and the inductive hypothesis holds for the latter.

    \Fullref{thm:parallel_reduction_deconstruction/abs} lists the following possibilities for \( M \ppred K \):
    \begin{itemize}
      \item In the case \fullref{thm:parallel_reduction_deconstruction/abs/lift} for \( M \ppred K \), we have \( K \aequiv \qabs x C \) for some \( \muplambda \)-term \( C \) such that \( A \ppred C \).

      By the inductive hypothesis on \( A \ppred B \), there exists a confluence point \( D \) of \( B \) and \( C \).

      Let \( L \coloneqq \qabs x D \). Then \ref{inf:def:parallel_reduction/abs} implies that \( N \ppred L \) and \( K \ppred L \).

      \item In the case \fullref{thm:parallel_reduction_deconstruction/abs/eta} for \( M \ppred K \), which requires the \( \eta \)-reduction rule \ref{inf:def:parallel_reduction/eta}, \( x \) is not free in \( K \) and \( A \aequiv Kx \).

      Applying \ref{inf:def:lambda_term_reduction/alpha}, we obtain \( Kx \ppred B \). \Fullref{thm:parallel_reduction_deconstruction/app} lists two possibilities for \( Kx \ppred B \), however \fullref{thm:parallel_reduction_deconstruction/app/beta} is not possible because it requires \( Kx \) to be an abstraction. Then \fullref{thm:parallel_reduction_deconstruction/app/direct} holds, and \( B = Lx \) for some \( \muplambda \)-term \( L \) that satisfies \( K \ppred L \).

      To summarize:
      \begin{align*}
        M &= \qabs x A \aequiv \qabs x Kx, &&x \not\in \op*{Free}(K), \\
        N &= \qabs x B = \qabs x Lx,       &&K \pred L.
      \end{align*}

      Clearly \( N \) can be \( \eta \)-reduced to \( L \). Then \( L \) is a confluence point of \( N \) and \( K \), as can be seen in the following diagram:
      \begin{equation*}
        \includegraphics[page=6]{output/thm__church_rosser_theorem}
      \end{equation*}
    \end{itemize}

    \item If \( M \ppred N \) due to \ref{inf:def:parallel_reduction/beta}, then \( M = (\qabs x A)B \) and \( N = C[x \mapsto D] \) for some variable \( x \) and some \( \muplambda \)-terms \( A \), \( B \), \( C \) and \( D \), where \( A \ppred C \) and \( B \ppred D \) and the inductive hypothesis holds for the latter two.

    \Fullref{thm:parallel_reduction_deconstruction/app} lists the following possibilities for \( M \ppred K \):
    \begin{itemize}
      \item In the case \fullref{thm:parallel_reduction_deconstruction/app/direct} for \( M \ppred K \), we have \( K = EF \) for some \( \muplambda \)-terms \( E \) and \( F \), where \( \qabs x A \ppred E \) and \( B \ppred F \). To summarize:
      \begin{align*}
        M &= (\qabs x A) B,           &&A \ppred C \T{and} \qabs x A \ppred E, \\
        N &= C[x \mapsto D],          &&B \ppred D \T{and} B \ppred F, \\
        K &= E F.                     &&
      \end{align*}

      By the inductive hypothesis on \( B \ppred D \), there exists a confluence point \( Q \) of \( D \) and \( F \).

      This leads to the following confluence diagrams (the first of which is incomplete):
      \begin{equation*}
        \includegraphics[page=7]{output/thm__church_rosser_theorem}
        \quad\quad
        \includegraphics[page=8]{output/thm__church_rosser_theorem}
      \end{equation*}

      The possible definitions of \( L \) depend on \( E \). \Fullref{thm:parallel_reduction_deconstruction/abs} lists the following possibilities for \( \qabs x A \ppred E \):
      \begin{itemize}
        \item In the case \fullref{thm:parallel_reduction_deconstruction/abs/lift} for \( \qabs x A \ppred E \), we have \( E \aequiv \qabs x H \) for some \( \muplambda \)-term \( H \) such that \( A \ppred H \).

        By the inductive hypothesis on \( A \ppred C \), there exists a confluence point \( P \) of \( C \) and \( H \). Applying \ref{inf:def:beta_eta_reduction/beta} yields
        \begin{equation*}
          K = EF = (\qabs x H)F \pred P[x \mapsto Q].
        \end{equation*}

        Let \( L \coloneqq P[x \mapsto Q] \). By \fullref{thm:substitution_on_parallel_reduction}, we have
        \begin{equation*}
          N = C[x \mapsto D] \pred P[x \mapsto Q] = L.
        \end{equation*}

        Then \( L \) is the desired confluence point for \( N \) and \( K \), as can be seen from the following diagram:
        \begin{equation*}
          \includegraphics[page=9]{output/thm__church_rosser_theorem}
        \end{equation*}

        \item In the case \fullref{thm:parallel_reduction_deconstruction/abs/eta} for \( \qabs x A \ppred E \), which requires the \( \eta \)-reduction rule \ref{inf:def:parallel_reduction/eta}, \( x \) is not free in \( E \) and \( A \aequiv Ex \), i.e.
        \begin{equation*}
          M = (\qabs x A) B \aequiv (\qabs x E x) B.
        \end{equation*}

        Here \( N \) is a parallel \( \beta \)-reduction of \( M \), while \( K \) is a parallel \( \eta \)-reduction of \( M \). We have the following incomplete confluence diagram:
        \begin{equation*}
          \includegraphics[page=10]{output/thm__church_rosser_theorem}
        \end{equation*}

        Since \( Ex \aequiv A \) and \( A \ppred C \), \ref{inf:def:parallel_reduction/alpha} implies that \( Ex \ppred C \). \Fullref{thm:parallel_reduction_deconstruction/app} lists the following possibilities:
        \begin{itemize}
          \item In the case \fullref{thm:parallel_reduction_deconstruction/app/direct} for \( Ex \ppred C \), we have \( C = RS \) for some \( \muplambda \)-terms \( R \) and \( S \) such that \( E \ppred R \) and \( x \ppred C \).

          The latter is only possible if \( C = x \), so \( C = Rx \). Thus,
          \begin{equation*}
            N = C[x \mapsto D] = (Rx)[x \mapsto D] = R[x \mapsto D] D.
          \end{equation*}

          Since \( x \) is not free in \( E \), by \fullref{thm:def:parallel_reduction/free}, it is also not free in \( R \). Thus, \( N = RD \).

          This suggests defining \( L \coloneqq RQ \) since \( Q \) is a confluence point of \( D \) and \( F \). We obtain the following diagram:
          \begin{equation*}
            \includegraphics[page=11]{output/thm__church_rosser_theorem}
          \end{equation*}

          \item In the case \fullref{thm:parallel_reduction_deconstruction/app/beta} for \( Ex \ppred C \), we have \( E = \qabs y R \) for some variable \( y \) and \( \muplambda \)-term \( R \) and \( C \aequiv S[y \mapsto T] \) for some \( \muplambda \)-terms \( S \) and \( T \), where \( x \ppred T \) and \( R \ppred S \) and the inductive hypothesis holds for the latter two.

          We have
          \begin{align*}
            M &= (\qabs x A) B \aequiv (\qabs x E x) B = (\qabs x (\qabs y R) x) B, &&R \ppred S, \\
            N &= C[x \mapsto D],                                                    &&D \ppred Q \T{and} F \ppred Q, \\
            K &= EF \aequiv (\qabs y R) F.                                          &&
          \end{align*}

          It is not immediate how to apply \( R \ppred S \) to \( N \), so we will express \( N \) via \( S \).

          First, note that, by \fullref{thm:parallel_reduction_deconstruction/var}, \( x \ppred T \) is only possible if \( T = x \), so \( C \aequiv S[y \mapsto x] \). \Fullref{thm:substitution_on_alpha_equivalent_terms} implies that
          \begin{equation*}
            N = C[x \mapsto D] \aequiv S[y \mapsto x][x \mapsto D].
          \end{equation*}

          Since \( x \) is not free in \( E = \qabs y R \), it is not free in \( R \), and, by \fullref{thm:def:lambda_term_alpha_equivalence/free}, also not free in \( S \). Then \fullref{thm:substitution_chain_contraction/precomposition} implies that
          \begin{equation*}
            S[y \mapsto x][x \mapsto D] \aequiv S[y \mapsto D].
          \end{equation*}

          Thus,
          \begin{equation*}
            N \aequiv S[y \mapsto D].
          \end{equation*}

          Let \( L \coloneqq S[y \mapsto Q] \). By applying \fullref{thm:substitution_on_parallel_reduction} to \( C \ppred C \), we obtain
          \begin{equation*}
            N \aequiv S[y \mapsto D] \ppred S[y \mapsto Q] = L.
          \end{equation*}

          By applying \ref{inf:def:parallel_reduction/beta} to \( K \), we obtain
          \begin{equation*}
            K \aequiv (\qabs y R) F \ppred S[y \mapsto Q] = L.
          \end{equation*}

          This confirms that \( L \) is the desired confluence point of \( N \) and \( K \). This is also shown in the following diagram:
          \begin{equation*}
            \includegraphics[page=12]{output/thm__church_rosser_theorem}
          \end{equation*}
        \end{itemize}
      \end{itemize}

      \item In the case \fullref{thm:parallel_reduction_deconstruction/app/beta} for \( M \ppred K \), we have \( K \aequiv E[x \mapsto F] \), where \( A \ppred E \) and \( B \ppred F \).

      This case is simpler because both \( M \ppred N \) and \( M \ppred K \) are obtained by parallel \( \beta \)-reduction.

      By the inductive hypothesis on \( A \ppred C \), there exists a confluence point \( P \) for \( C \) and \( E \). By the inductive hypothesis on \( B \ppred D \), there exists a confluence point \( Q \) of \( D \) and \( F \).

      Then \fullref{thm:substitution_on_parallel_reduction} allows us to conclude that \( L \coloneqq P[x \mapsto Q] \) is the desired confluence point for \( N \) and \( K \), as can be seen from the following diagram:
      \begin{equation*}
        \includegraphics[page=13]{output/thm__church_rosser_theorem}
      \end{equation*}
    \end{itemize}

    \item If \( M \ppred N \) due to \ref{inf:def:parallel_reduction/eta}, then \( M = \qabs x A x \) for some \( \muplambda \)-term \( A \) and some variable \( x \) not free in \( A \), where we have \( A \ppred N \), and the inductive hypothesis holds for the latter.

    \Fullref{thm:parallel_reduction_deconstruction/abs} lists the following possibilities for \( M \ppred K \):
    \begin{itemize}
      \item In the case \fullref{thm:parallel_reduction_deconstruction/abs/lift} for \( M \ppred K \), we have \( K \aequiv \qabs x B \) for some \( \muplambda \)-term \( B \) such that \( Ax \ppred B \).

      To summarize:
      \begin{align*}
        M &= \qabs x A x,     &&A \ppred N, \\
        K &\aequiv \qabs x B, &&Ax \ppred B.
      \end{align*}

      \Fullref{thm:parallel_reduction_deconstruction/app} lists the following possibilities for \( Ax \ppred B \):
      \begin{itemize}
        \item In the case \fullref{thm:parallel_reduction_deconstruction/app/direct} for \( Ax \ppred B \), we have \( B = Cx \) for some \( \muplambda \)-term \( C \) such that \( A \ppred C \).

        By the inductive hypothesis on \( A \ppred N \), there exists a confluence point \( L \) of \( N \) and \( C \).

        Since \( x \) is not free in \( A \) and \( A \ppred C \), by \fullref{thm:def:parallel_reduction/free}, \( x \) is also not free in \( C \). Then, since \( C \ppred L \), \ref{inf:def:parallel_reduction/eta} on \( K \aequiv \qabs x C x \) yields \( L \).

        Therefore, \( L \) is the desired confluence point of \( N \) and \( K \). This is illustrated in the following diagram:
        \begin{equation*}
          \includegraphics[page=14]{output/thm__church_rosser_theorem}
        \end{equation*}

        \item In the case \fullref{thm:parallel_reduction_deconstruction/app/beta} for \( Ax \ppred B \), which requires the \( \beta \)-reduction rule \ref{inf:def:parallel_reduction/beta}, we have \( A = \qabs y E \) for some variable \( y \) and some \( \muplambda \)-term \( E \) and also \( B \aequiv F[y \mapsto G] \) for some \( \muplambda \)-terms \( F \) and \( G \) such that \( x \ppred G \) and \( E \ppred F \).

        \Fullref{thm:parallel_reduction_deconstruction/var} implies that \( G = x \), hence \( B \aequiv F[y \mapsto x] \) and, due to \ref{inf:thm:alpha_equivalence_simplified/lift}, \( \qabs x B \aequiv F[y \mapsto x] \). But \( K \aequiv \qabs x B \), hence
        \begin{equation*}
          K \aequiv \qabs x F[y \mapsto x].
        \end{equation*}

        On the other hand, since \( x \) is not free in \( A = \qabs y E \), it is also not free in \( E \), and \fullref{thm:alpha_conversion} implies that
        \begin{equation*}
          A = \qabs y E \aequiv \qabs x E[y \mapsto x].
        \end{equation*}

        Finally, since \( E \ppred F \), \fullref{thm:substitution_on_parallel_reduction}, implies that \( E[y \mapsto x] \ppred F[y \mapsto x] \). Applying \ref{inf:def:parallel_reduction/abs} yields
        \begin{equation*}
          \underbrace{\qabs x E[y \mapsto x]}_{\aequiv A} \ppred \underbrace{\qabs x F[y \mapsto x]}_{\aequiv K}.
        \end{equation*}

        The rule \ref{inf:def:parallel_reduction/alpha} allows us to conclude that \( A \ppred K \).

        The inductive hypothesis on \( A \pred N \) implies that there exists a confluence point \( L \) of \( N \) and \( K \). This is illustrated in the following diagram:
        \begin{equation*}
          \includegraphics[page=15]{output/thm__church_rosser_theorem}
        \end{equation*}
      \end{itemize}

      \item In the case \fullref{thm:parallel_reduction_deconstruction/abs/eta} for \( M = (\qabs x A x) \ppred K \), we have \( A \aequiv K \) and \( x \) is not free in \( K \).

      Since parallel reduction is \( \alpha \)-reflexive, we have \( A \ppred K \).

      By the inductive hypothesis on \( A \ppred N \), there exists a confluence point \( L \) of \( N \) and \( K \).
    \end{itemize}
  \end{itemize}

  \SubProofOf{thm:church_rosser_theorem/multi_step} The parallel reduction \( {\ppred} \) is confluent as a consequence of \fullref{thm:church_rosser_theorem/parallel}. \Fullref{thm:def:parallel_reduction/extends_to_multi_step} implies that the corresponding multi-step reduction coincides with the ordinary multi-step reduction \( {\pred*} \), hence \fullref{thm:def:reduction_confluence/weak_implies_multi} implies that \( {\pred*} \) is confluent.

  \SubProofOf{thm:church_rosser_theorem/single_step} Follows from \fullref{thm:church_rosser_theorem/multi_step} and \fullref{thm:def:reduction_confluence/multi_implies_weak}.
\end{proof}
