\section{Prime numbers}\label{sec:prime_numbers}

\paragraph{Prime numbers}

\begin{definition}\label{def:prime_number}\mcite[2]{Apostol1976AnalyticNumberTheory}
  A \term[ru=простое (число) (\cite[256]{Хинчин1951ЭлементыТеорииЧисел})]{prime number} is an integer greater than \( 1 \) whose only proper \hi{positive} \hyperref[def:divisibility]{divisor} is \( 1 \). Non-prime integers greater than \( 1 \) are called \term[ru=составное (число) (\cite[256]{Хинчин1951ЭлементыТеорииЧисел})]{composite numbers}.
\end{definition}
\begin{comments}
  \item The integers less than \( 2 \) are neither prime nor composite.
\end{comments}

\begin{remark}\label{rem:prime_numbers_and_prime_elements}
  The definition of a prime number given in \cref{def:prime_number} is standard and dates back to at least Euclid. In Richard Fitzpatrick's English translation \cite[194]{Euclid2008Elements} of Euclid's \enquote{Elements}, definition 11 of book 7 is stated as follows:
  \begin{displayquote}
    A prime number is one measured by a unit alone.
  \end{displayquote}

  \begin{thmenum}
    \thmitem{rem:prime_numbers_and_prime_elements/irreducible} First, let us inspect \cref{def:domain_divisibility/irreducible/direct} for the integral domain \( \BbbZ \):
    \begin{displayquote}
      We say that \( n \) is an \hi{irreducible element} of \( \BbbZ \) if \( n \) is nonzero and non-invertible and, whenever \( n = ab \), either \( a \) or \( b \) or both are invertible.
    \end{displayquote}

    \Cref{thm:integer_multiplicative_invertibility} implies that the only invertible elements of \( \BbbZ \) are \( 1 \) and \( -1 \). So, the above can be simplified:
    \begin{displayquote}
      We say that \( n \) is an \hi{irreducible element} of \( \BbbZ \) if \( \abs{n} > 1 \) and, whenever \( n = ab \) we have \( \abs{a} = 1 \) or \( \abs{b} = 1 \) (or both).
    \end{displayquote}

    When \( n \), \( a \) and \( b \) are all positive integers, we obtain a restatement of the definition of prime number.

    \thmitem{rem:prime_numbers_and_prime_elements/prime} Now, let us turn to \cref{def:domain_divisibility/prime/direct}
    \begin{displayquote}
      We say that \( n \) is a \hi{prime element} of \( \BbbZ \) if \( n \) is nonzero and non-invertible and, whenever \( n \) divides \( ab \), it divides \( a \) or \( b \) (or possibly both).
    \end{displayquote}

    We can again simplify the first condition on \( n \) to \( \abs{n} > 1 \), but the divisibility condition is less obvious.

    \Cref{thm:euclids_lemma} demonstrates that every prime \hi{number} is also a prime \hi{element} of \( \BbbZ \). Thus, a prime element \( p \) of \( \BbbZ \) is a prime number if and only if \( p \) is positive.
  \end{thmenum}
\end{remark}
\begin{comments}
  \item Coprime integers are, fortunately, defined in \cref{def:coprime_numbers} analogously to how coprime elements are defined in \cref{def:coprime_elements}.
\end{comments}

\begin{lemma}[Euclid's lemma]\label{thm:euclids_lemma}
  If \( p \) is a \hyperref[def:prime_number]{prime number}, then \( p \mid nm \) implies \( p \mid n \) or \( p \mid m \) (or both).
\end{lemma}
\begin{comments}
  \item The lemma is an adaptation of proposition 30 from book 7 of Euclid's \enquote{Elements}, stated in \cite[218]{Euclid2008Elements} as follows:
  \begin{displayquote}
    If two numbers make some (number by) multiplying one another, and some prime number measures the number (so) created from them, then it will also measure one of the original (numbers).
  \end{displayquote}
\end{comments}
\begin{proof}
  Since \( \BbbZ \) is a GCD domain, the lemma follows from \cref{thm:def:gcd_domain/irreducible_is_prime}.
\end{proof}

\begin{theorem}[Euclid's prime infinitude theorem]\label{thm:euclids_prime_infinitude_theorem}\mcite[62]{Кострикин2000АлгебраЧасть1}
  There exist infinitely many \hyperref[def:prime_number]{prime number}.
\end{theorem}
\begin{comments}
  \item The theorem is an adaptation of proposition 20 from book 9 of Euclid's \enquote{Elements}, stated in \cite[271]{Euclid2008Elements} as follows:
  \begin{displayquote}
    The (set of all) prime numbers is more numerous than any assigned multitude of prime numbers.
  \end{displayquote}

  The gist of the proof is also due to Euclid.
\end{comments}
\begin{proof}
  Suppose that \( p_1, \ldots, p_n \) is an enumeration of all prime numbers and consider the number
  \begin{equation*}
    m \coloneqq p_1 \cdots p_n + 1.
  \end{equation*}

  \begin{itemize}
    \item If \( m \) is prime, then there exists a prime not in the list \( p_1, \ldots, p_n \), contradicting our assumption.

    \item If \( m \) is not prime, then one of the primes, say \( p_k \), divides \( m \). Let \( q \) be their quotient. Thus,
    \begin{equation*}
      1 = p - (p - 1) = p_k \parens[\Big]{ q - \prod_{i \neq k}^n p_i }.
    \end{equation*}

    It follows that \( p_k \) is invertible in \( \BbbZ \), which contradicts \cref{thm:integer_multiplicative_invertibility}.
  \end{itemize}

  Obtaining a contradiction in both cases, we conclude that there is no finite list of prime numbers.
\end{proof}

\paragraph{Valuations}

\incite*[255]{Aluffi2009Algebra} remarks that \enquote{Entire libraries have been written on the subject of valuations}, yet as we shall see, there is no consensus on a precise definition. We provide \cref{def:exponential_valuation} and otherwise try to avoid the term as much as possible.

\begin{definition}\label{def:exponential_valuation}
  An \term[ru=нормирование (\cite[437]{Винберг2014КурсАлгебры}), en=exponential valuation (\cite[def. 9.4']{Jacobson1989BasicAlgebraII})]{exponential valuation} on a given \hyperref[def:integral_domain]{integral domain} \( D \) is a function \( v: D \setminus \set{ 0_D } \to \BbbZ_{>0} \) that satisfies the following properties:
  \begin{thmenum}
    \thmitem{def:exponential_valuation/homomorphism} \( v(x \cdot y) = v(x) + v(y) \).
    \thmitem{def:exponential_valuation/min} \( v(x + y) \geq \min\set{ v(x), v(y) } \).
  \end{thmenum}
\end{definition}
\begin{comments}
  \item Our definition is based the following:
  \begin{itemize}
    \item \tcite{#2, where #1}[def. 9.4']{Jacobson1989BasicAlgebraII} defines an \enquote{exponential valuation} on fields with values in an abelian group having an additional value adjoined, \( \infty \), such that \( v(x) = \infty \) if and only if \( x = 0 \).

    \item \tcite{#2, where #1}{Винберг2014КурсАлгебры} defines an \enquote{нормирование} (\enquote{norming}) on integral domains as surjective functions with positive integer values.
  \end{itemize}
\end{comments}

\begin{definition}\label{def:non_archimedean_absolute_value}\mcite[561]{Jacobson1989BasicAlgebraII}
  If an \hyperref[def:absolute_value]{absolute value} function \( \norm{\anon}: \BbbK \to \BbbR \) satisfies
  \begin{equation}\label{eq:def:non_archimedean_absolute_value}
    \norm{x + y} \leq \max\set{ \norm{x}, \norm{y} }.
  \end{equation}
  we say that it is \term{non-Archimedean}.
\end{definition}
\begin{comments}
  \item \incite[465]{Lang2002Algebra} calls such functions \enquote{valuations}, while \cite[def. 9.4']{Jacobson1989BasicAlgebraII} generalizes them to Abelian groups and calls them \enquote{additive valuations}.
\end{comments}

\begin{proposition}\label{thm:exponential_and_additive_valuations}
  Fix a \hyperref[def:field]{field} \( \BbbK \) and two functions, \( \norm{\anon}: \BbbK \to \BbbR \) and \( v: \BbbK \setminus \set{ 0 } \to \BbbR \). Suppose that there exists a constant \( 0 < c < 1 \) such that, for nonzero \( x \) in \( \BbbK \), we have
  \begin{equation}\label{eq:thm:exponential_and_additive_valuations}
    \norm{x} = c^{v(x)}
  \end{equation}

  Then \( \norm{\anon} \) is a \hyperref[def:non_archimedean_absolute_value]{non-Archimedean} \hyperref[def:absolute_value]{absolute value} if and only if \( v \) is an \hyperref[def:exponential_valuation]{exponential valuation}.
\end{proposition}
\begin{proof}
  Follows from our definition of the \hyperref[def:logarithm]{natural logarithm} as a (selection of the) inverse of the \hyperref[def:exponential_function]{exponential function}.
\end{proof}

\begin{definition}\label{def:padic_valuation}\mcite[437]{Винберг2014КурсАлгебры}
  For every \hyperref[def:domain_divisibility/prime]{prime element} \( p \) in an \hyperref[def:integral_domain]{integral domain} \( D \), we define the \( p \)-adic \hyperref[def:exponential_valuation]{exponential valuation} on \( D \) as
  \begin{equation}\label{eq:def:padic_valuation}
    v_p(x) \coloneqq \max\set{ k = 0, 1, 2, \ldots \given p^k \T{divides} x }.
  \end{equation}
\end{definition}
\begin{comments}
  \item As with all exponential valuations, we define \( v_p \) only for nonzero elements of \( D \).
\end{comments}
\begin{defproof}
  We must verify that \( v_p \) really is an exponential valuation.

  \SubProofOf{def:exponential_valuation/homomorphism} If \( p^k \) divides \( x \) and \( p^m \) divides \( y \), then \( p^k p^m \) divides \( xy \), thus
  \begin{equation*}
    v_p(x \cdot y)
    =
    p^k p^m
    \reloset {\eqref{eq:thm:semigroup_exponentiation_properties/distributive}} =
    p^{k + m}
    =
    v_p(x) + v_p(y).
  \end{equation*}

  \SubProofOf{def:exponential_valuation/min} Furthermore, if \( p^k \) divides \( x \) and \( p^m \) divides \( y \), then \( p^{\min\set{ k, m }} \) divides \( x + y \), although it is possible that a larger power of \( p \) divides \( x + y \) (e.g. \( 2^3 \mid (3 + 5) \)). Then
  \begin{equation*}
    v_p(x + y)
    \geq
    \min\set{ k, m }
    =
    \min\set{ v_p(x), v_p(y) }.
  \end{equation*}
\end{defproof}

\begin{theorem}[Fundamental theorem of arithmetic]\label{thm:fundamental_theorem_of_arithmetic}
  We can use the \hyperref[def:padic_valuation]{\( p \)-adic valuations} to decompose a positive integer \( n \) into a product of prime powers as
  \begin{equation}\label{eq:thm:fundamental_theorem_of_arithmetic}
    n = \prod_{\mathclap{p \T*{is prime}}} p^{v_p(n)},
  \end{equation}
  where only finitely many valuations differ from \( 0 \) (and only their multiplicands differ from \( 1 \)).

  Furthermore, every \hyperref[def:irreducible_factorization]{irreducible factorization} of \( n \) into \hi{positive numbers} is a \hyperref[def:multiset_permutation]{multiset permutation} of the prime number multiplicands above, where \( p \) occurs \( v_p(n) \) times.
\end{theorem}
\begin{comments}
  \item The factorization can thus be regarded as a unique \hyperref[def:multiset]{multiset} of prime numbers.

  \item As discussed in \cref{rem:integer_domain_chain}, \( \BbbZ \) is a factorial domain, so existence and uniqueness of factorizations up to an equivalence is automatic. Using prime numbers, however, allows stating a more powerful uniqueness result.
\end{comments}
\begin{proof}
  Let \( u p_1 \cdots p_r \) be an irreducible factorization of \( n \).

  \Cref{thm:def:irreducible_factorization/uniqueness} implies that all irreducible factorizations of \( n \) are \hyperref[def:irreducible_factorization/equivalent]{equivalent}. Then we can assume, without loss of generality, that we are working with a factorization \( u p_1 \cdots p_r \) for which \( u = 1 \) and \( p_1, \ldots, p_r \) are positive, i.e. are prime numbers.

  Clearly two such factorizations differ only by the ordering of \( p_1, \ldots, p_r \). Since \( v_p(n) \) is simply the number of occurrences of \( p \) among \( p_1, \ldots, p_r \), \eqref{eq:thm:fundamental_theorem_of_arithmetic} provides a systematic way of writing the factorization.
\end{proof}

\begin{corollary}\label{thm:integer_divisibility_via_primes}
  For positive integers \( n \) and \( m \), \( n \) divides \( m \) if and only if for every \hyperref[def:padic_valuation]{\( p \)-adic valuation} we have \( v_p(n) \leq v_p(m) \).
\end{corollary}
\begin{proof}
  \SufficiencySubProof Suppose that \( n \) divides \( m \). Suppose that, for some prime number \( p \), we have \( v_p(n) > v_p(m) \). Then \( p^{v_p(n)} \) divides \( n \) but not \( m \), which contradicts the transitivity of divisibility shown in \cref{thm:semiring_divisibility_order}.

  Then \( v_p(n) \leq v_p(m) \) for every prime number \( p \).

  \NecessitySubProof Suppose that \( v_p(n) \leq v_p(m) \) for every prime number \( p \).

  \Fullref{thm:fundamental_theorem_of_arithmetic} implies that there exist finitely many primes for which either \( v_p(n) \) or \( v_p(m) \) is nonzero. Let \( p_1, \ldots, p_r \) be an enumeration of these primes. Then, by induction on \( r \), we can show that
  \begin{equation*}
    n = p_1^{v_{p_1}(n)} \cdots p_r^{v_{p_r}(n)}
  \end{equation*}
  divides
  \begin{equation*}
    m = p_1^{v_{p_1}(m)} \cdots p_r^{v_{p_r}(m)}.
  \end{equation*}
\end{proof}

\begin{corollary}\label{thm:integer_gcd_lcm_via_primes}
  For positive integers \( n \) and \( m \), we have
  \begin{equation*}
    \gcd(n, m) = \prod_{\mathclap{p \T{is prime}}} p^{\min\set{ v_p(n), v_p(m) }}
  \end{equation*}
  and
  \begin{equation*}
    \lcm(n, m) = \prod_{\mathclap{p \T{is prime}}} p^{\max\set{ v_p(n), v_p(m) }}.
  \end{equation*}
\end{corollary}
\begin{proof}
  Follows from \cref{thm:integer_divisibility_via_primes}.
\end{proof}

\paragraph{Prime counting}

\begin{definition}\label{def:int_sqrt}\mimprovised
  Based on \cite{PythonDocs:3.13:math}, we will introduce an \term{integer square root} \hyperref[def:arithmetic_function]{arithmetic function}
  \begin{equation*}
    \op{isqrt}(n) \coloneqq \min\set{ k = 1, 2, \ldots \given k^2 \leq n }.
  \end{equation*}

\end{definition}
\begin{comments}
  \item It is precisely the \hyperref[def:real_floor_ceiling]{floor} of the \hyperref[def:principal_nonnegative_nth_root]{principal square root} \( \sqrt n \). If \( \op{isqrt}(n) \) coincides with \( \sqrt n \), then \( n \) is a \hyperref[def:semigroup_power]{perfect square}.
\end{comments}

\begin{proposition}\label{thm:int_sqrt_leq}
  If for some positive integers we have \( n = ab \), we have the following possibilities:
  \begin{thmenum}
    \thmitem{thm:int_sqrt_leq/equal} \( a = \op{isqrt}(n) = b \).
    \thmitem{thm:int_sqrt_leq/a_leq} \( a \leq \op{isqrt}(n) < b \).
    \thmitem{thm:int_sqrt_leq/b_leq} \( a > \op{isqrt}(n) \geq b \).
  \end{thmenum}
\end{proposition}
\begin{proof}
  We have the following options in general for \( n = ab \):
  \begin{itemize}
    \item If \( a = b \), then \( n \) is a perfect square, hence \cref{thm:int_sqrt_leq/equal} holds.
    \item If \( a < b \), then we must investigate how they are related to \( \op{isqrt}(n) \).

    If we suppose that \( b \leq \op{isqrt}(n) \), then \( ab < b^2 \leq \op{isqrt}(n)^2 \leq n \), which is a contradiction.

    Similarly, if we suppose that \( a > \op{isqrt}(n) \), then \( b > a \geq \op{isqrt}(n) + 1 \), hence
    \begin{equation*}
      (\op{isqrt}(n) + 1)^2 < ab = n,
    \end{equation*}
    which contradicts the maximality of \( \op{isqrt}(n) \).

    Then it remains for \cref{thm:int_sqrt_leq/a_leq} to hold.

    \item If \( a > b \), we can argue by \hyperref[thm:order_duality]{duality} to conclude that \cref{thm:int_sqrt_leq/b_leq} holds.
  \end{itemize}
\end{proof}

\begin{proposition}\label{thm:prime_number_sqrt}
  An integer \( n > 1 \) is \hyperref[def:prime_number]{prime} if and only if no integer \( k \) with \( 1 < k \leq \op{isqrt}(n) \) divides \( n \).
\end{proposition}
\begin{comments}
  \item A consequence of this is that a brute-force primality check, in which we check whether \( k \) divides \( n \) for all \( k < n \), the condition on \( k \) can be simplified to \( k \leq \op{isqrt}(n) \).
\end{comments}
\begin{proof}
  \SufficiencySubProof Suppose that \( n \) is prime. Since \( n > 1 \), we have \( \op{isqrt}(n) < n \), and thus \( 1 < k \leq \op{isqrt}(n) \) implies \( k < n \). Then, since \( n \) is prime, no such \( k \) can divide \( n \) since its only positive divisors are \( 1 \) and \( n \) itself.

  \NecessitySubProof Suppose that, for some \( n > 1 \), from \( 1 < k \leq \op{isqrt}(n) \) it follows that \( k \) does not divide \( n \).

  Let \( n = ab \). \Cref{thm:int_sqrt_leq} implies that either \( a \leq \op{isqrt}(n) \), in which case \( a = 1 \) and \( b = n \), or \( b \leq \op{isqrt}(n) \), in which case \( b = 1 \) and \( a = n \).

  Therefore, we conclude that \( n \) is prime.
\end{proof}

\begin{corollary}\label{thm:prime_number_sqrt_prime}
  An integer \( n > 1 \) is \hyperref[def:prime_number]{prime} if and only if no \hi{prime} \( p \) with \( p \leq \op{isqrt}(n) \) divides \( n \).
\end{corollary}
\begin{proof}
  Follows from \cref{thm:prime_number_sqrt} by noticing that \( k \) divides \( n \) whenever the prime factors of \( p \) do.
\end{proof}

\begin{algorithm}[Sieve of Eratosthenes]\label{alg:sieve_of_eratosthenes}\mcite[exerc. 4.5.4.8]{Knuth1997ArtVol2}
  We can explicitly construct the sequence
  \begin{equation*}
    s_{n,k} \coloneqq \begin{cases}
      1, &k \leq n \T{and} k \T{is prime}, \\
      0, &\T{otherwise}.
    \end{cases}
  \end{equation*}

  Via recursion on \( m \leq \op{isqrt}(n) \), we will build the auxiliary sequences \( \seq{ s_{n,k,m} }_{k=1}^\infty \) such that \( s_{n,k,m} = 0 \) if and only if \( k \leq n \) and \( k \) is a multiple of some prime \( p \leq m \). \Cref{thm:prime_number_sqrt_prime} implies that for \( m = \op{isqrt}(n) \) we obtain the desired sequence \( \seq{ s_{n,k} }_{k=1}^\infty \).

  \begin{thmenum}
    \thmitem{alg:sieve_of_eratosthenes/one} We start with the sequence in which only \( 1 \) is marked as non-prime:
    \begin{equation*}
      s_{n,k,1} \coloneqq \begin{cases}
        0, &k = 1, \\
        1, &\T{otherwise.}
      \end{cases}
    \end{equation*}

    \thmitem{alg:sieve_of_eratosthenes/composite} If \( m > 1 \) and \( s_{n,m,m-1} = 0 \), then \( m \) itself is a multiple of some prime \( p \leq m - 1 \) and is thus composite.

    In this case we assign \( s_{n,k,m} = s_{n,k,m-1} \) for every \( k \).

    Note that \( p \leq m \) can only be a prime if \( p \leq m - 1 \). Thus, by the inductive hypothesis, \( p \leq m \) divides \( k \leq n \) if and only if \( s_{n,k,m} = s_{n,k,m-1} = 0 \). This shows correctness.

    \thmitem{alg:sieve_of_eratosthenes/prime} Otherwise, if \( m > 1 \) and \( s_{n,m,m-1} = 1 \), then \( m \) is not a multiple of any prime \( p \leq m - 1 \). Since \( m - 1 \geq \op{isqrt}(m) \), \cref{thm:prime_number_sqrt_prime} implies that \( m \) is itself prime.

    We thus proceed to nullify all multiples of \( m \) up to \( n \):
    \begin{equation*}
      s_{n,k,m} \coloneqq \begin{cases}
        0,           &k \leq n \T{and} m \T{divides} k, \\
        s_{n,k,m-1}, &\T{otherwise.}
      \end{cases}
    \end{equation*}

    Again, a prime \( p \leq m - 1 \) divides \( k \leq n \) if and only if \( s_{n,k,m} = s_{n,k,m-1} = 0 \). The newly encountered prime \( p = m \) divides \( k \leq n \) if and only if we set \( s_{n,k,m} = 0 \) at this step. This shows correctness.
  \end{thmenum}
\end{algorithm}
\begin{comments}
  \item This algorithm can be found as \identifier{math.arithmetic.primes.build_erathostenes_sieve} in \cite{notebook:code}.
\end{comments}

\begin{definition}\label{def:arithmetic_function}\mcite[24]{Apostol1976AnalyticNumberTheory}
  We use the term \term[en=arithmetical function (\cite[24]{Apostol1976AnalyticNumberTheory})]{arithmetic function} to refer to complex-valued functions defined on the positive integers.
\end{definition}

\begin{definition}\label{def:prime_counting_function}\mcite[8]{Apostol1976AnalyticNumberTheory}
  Denote by \( \pi(n) \) the \hyperref[def:arithmetic_function]{arithmetic function} giving the number of primes less than or equal to \( n \).
\end{definition}

\begin{proposition}\label{thm:prime_counting_sieve}
  We can use \fullref{alg:sieve_of_eratosthenes} to compute the \hyperref[def:prime_counting_function]{prime counting function}:
  \begin{equation*}
    \pi(n) \coloneqq \sum_{k=1}^n s_{n,k}
  \end{equation*}
\end{proposition}
\begin{proof}
  The sieve is constructed so that \( s_{n,k} = 1 \) if \( k \leq n \) and \( k \) is prime.
\end{proof}

\begin{proposition}\label{thm:inclusion_exclusion_eratosthenes}\mcite[\S 8.6.3]{Rosen2019DiscreteMathematics}
  Denote by \( p_1, p_2, \ldots \) the increasing sequence of all \hyperref[def:prime_number]{prime numbers}. We can express the \hyperref[def:prime_counting_function]{prime counting function} as
  \begin{equation}\label{eq:thm:inclusion_exclusion_eratosthenes}
    \pi(n) = (n - 1) + \sum_{m=1}^{\mathclap{\pi(\op{isqrt}(n))}} (-1)^m \sum_{\mathclap{i_1 < \cdots < i_m}} \floor\parens[\Big]{ \frac n {p_{i_1} \cdots p_{i_m}} } + \pi(\op{isqrt}(n)).
  \end{equation}
\end{proposition}
\begin{proof}
  We will adapt the reasoning of \fullref{alg:sieve_of_eratosthenes} so that it can be used with \fullref{thm:inclusion_exclusion_principle}.

  Fix a positive integer \( n \), let \( N \coloneqq \set{ 1, 2, \ldots, n } \) and, for a positive integer \( k \), let \( A_k \coloneqq k\BbbZ \cap N \) be the subset of multiples of \( k \). Finally, let \( P \) be the set of prime numbers less than or equal to \( \op{isqrt}(n) \).

  \Cref{thm:prime_number_sqrt_prime} implies that \( m \in N \setminus \set{ 1 } \) is composite if and only if there exists some prime \( p \leq \op{isqrt}(m) \) such that \( m \in A_p \)\fnote{We can extend \( p \) to range up to \( \op{isqrt}(n) \), however we must then exclude the possibility that \( m \) is itself prime, in which case \( m \in A_m \) without \( m \) being composite}.

  Thus, the composite numbers in \( N \) are
  \begin{equation*}
    C \coloneqq \parens[\Big]{ \parens[\Big]{ \bigcup_{p \in P} A_p } \setminus P }.
  \end{equation*}

  Then
  \begin{equation*}
    \pi(n) = \card(N \setminus (C \cup \set{ 1 })).
  \end{equation*}

  Due to the additivity of cardinality,
  \begin{equation}\label{eq:thm:inclusion_exclusion_eratosthenes/sets}
    \pi(n)
    =
    \underbrace{n}_{\card N} - \overbrace{\card\parens[\Big]{ \bigcup_{p \in P} A_p } + \underbrace{\card P}_{\pi(\op{isqrt}(n))}}^{\card C} - \underbrace{1}_{\card\set{ 1 }}
    =
    n - 1 - \card\parens[\Big]{ \bigcup_{p \in P} A_p } + \pi(\op{isqrt}(n)).
  \end{equation}

  It remains to apply \fullref{thm:inclusion_exclusion_principle}. \Cref{thm:natural_number_divisibility_lattice/join} implies that
  \begin{equation*}
    A_{k_1} \cap \cdots \cap A_{k_m} = A_{\lcm(k_1, \ldots,k_m)},
  \end{equation*}
  which for prime numbers becomes
  \begin{equation*}
    A_{p_1} \cap \cdots \cap A_{p_m} = A_{p_1 \cdots p_m}.
  \end{equation*}

  Finally, note that
  \begin{equation*}
    \card(A_k) = \floor\parens[\Big]{ \frac n k }.
  \end{equation*}

  Then
  \begin{equation*}
    \card\parens[\Big]{ \bigcup_{p \in P} A_p } = - \sum_{m=1}^{\mathclap{\pi(\op{isqrt}(n))}} (-1)^m \sum_{\mathclap{i_1 < \cdots < i_m}} \floor\parens[\Big]{ \frac n {p_{i_1} \cdots p_{i_m}} }.
  \end{equation*}

  Note the additional minus sign that would otherwise change the index in \( (-1)^m \). After substituting in \eqref{eq:thm:inclusion_exclusion_eratosthenes/sets}, we obtain \eqref{eq:thm:inclusion_exclusion_eratosthenes}.
\end{proof}

\begin{example}\label{ex:thm:inclusion_exclusion_eratosthenes}
  As discussed in \cref{thm:inclusion_exclusion_eratosthenes}, we can count the number of primes less than or equal to \( n \) using only our knowledge of much smaller primes.

  For example, let \( n = 25 \). The primes less than or equal to \( \op{isqrt}(n) = 5 \) are \( 2 \), \( 3 \) and \( 5 \), and thus
  \begin{align*}
    \pi(25) &= 25 - 1 - \parens*{ \floor\parens*{ \frac {25} 2 } + \floor\parens*{ \frac {25} 3 } + \floor\parens*{ \frac {25} 5 } } + \\
            &+ \parens*{ \floor\parens*{ \frac {25} 6 } + \floor\parens*{ \frac {25} {10} } + \floor\parens*{ \frac {25} {15} } } + \\
            &- \floor\parens*{ \frac {25} {30} } + 3
            = \\ &= 25 - 1 - (12 + 8 + 5) + (4 + 2 + 1) - 0 + 3
            = \\ &= 9
  \end{align*}

  Indeed,
  \begin{equation*}
    \begin{array}{r *{23}{c}}
      1  & \hi{2} & \hi{3} & 4       & \hi{5} & 6       & \hi{7} & 8  & 9  & 10      & \hi{11} & 12 & \hi{13} \\
      14 & 15     & 16     & \hi{17} & 18     & \hi{19} & 20     & 21 & 22 & \hi{23} & 24      & 25 &
    \end{array}
  \end{equation*}
\end{example}

\begin{theorem}[Matiyasevich-Stechkin sieve]\label{thm:matiyasevich_stechkin_sieve}\mcite[61]{БарановСтечкин2004ЭкстремальнаяКомбинаторика}
  Consider the \hyperref[def:parabola]{parabola} \( y = x^2 \) with positive integer coordinates. For any two integers \( a > 1 \) and \( b > 1 \), consider the \hyperref[def:line_segment]{line segment} connecting the points \( (-a, a^2) \) and \( (b, b^2) \) of the parabola.

  Then \( k > 1 \) is a \hyperref[def:prime_number]{composite number} if and only if some segment passes through the point \( (0, k) \) on the ordinate.

  \begin{figure}[!ht]
    \centering
    \includegraphics[page=1]{output/thm__matiyasevich_stechkin_sieve}
    \caption{An illustration of the \hyperref[thm:matiyasevich_stechkin_sieve]{Matiyasevich-Stechkin sieve}.}\label{fig:thm:matiyasevich_stechkin_sieve}
  \end{figure}
\end{theorem}
\begin{proof}
  Fix positive integers \( a \) and \( b \). We are interested in the point in which the segment between \( (-a, a^2) \) and \( (b, b^2) \) passes though the ordinate. We must thus find the real number \( t \in [0, 1] \) such that
  \begin{equation*}
    tb + (1 - t)(-a) = 0.
  \end{equation*}

  This reduces to
  \begin{equation*}
    t(a + b) = a,
  \end{equation*}
  hence \( t = a / (a + b) \).

  Then
  \begin{equation*}
    tb^2 + (1 - t)a^2
    =
    \frac {ab^2} {a + b} + \frac {ba^2} {a + b}
    =
    ab \frac {b + a} {a + b}
    =
    ab.
  \end{equation*}

  Hence, the intersection point is \( (0, ab) \).

  We conclude that the ordinate point \( k \) intersects the segment corresponding to \( a \) and \( b \) if and only if \( k = ab \). Furthermore, \( k > 1 \) is composite if both \( a \) and \( b \) are greater than \( 1 \).
\end{proof}

\paragraph{Coprime numbers}

\begin{definition}\label{def:coprime_numbers}
  We say that the integers \( n \) and \( m \) are \term[ru=взаимно простые (числа) (\cite[45]{Зорич2019АнализЧасть1}), en=coprime (numbers) / relatively prime (numbers) (\cite[107]{GowersEtAl2008PrincetonCompanion})]{coprime} if any of the following equivalent conditions hold:
  \begin{thmenum}
    \thmitem{def:coprime_numbers/abstract}\mimprovised They are \hyperref[def:coprime_elements]{coprime elements} of \( \BbbZ \), that is, they satisfy any of the equivalent definitions in \cref{def:coprime_elements}.

    \thmitem{def:coprime_numbers/concrete}\mcite[45]{Зорич2019АнализЧасть1} Their only \hi{positive} common divisor is \( 1 \).

    \thmitem{def:coprime_numbers/prime}\mimprovised No \hyperref[def:prime_number]{prime number} divides both \( n \) and \( m \).
  \end{thmenum}
\end{definition}
\begin{defproof}
  \ImplicationSubProof{def:coprime_numbers/abstract}{def:coprime_numbers/concrete} If \( n \) and \( m \) are coprime elements of \( \BbbZ \), they satisfy \cref{def:coprime_elements/greatest}, thus every common divisor is invertible. The only invertible positive element of \( \BbbZ \) is \( 1 \), thus the only positive common divisor of \( n \) and \( m \) is \( 1 \).

  \ImplicationSubProof{def:coprime_numbers/concrete}{def:coprime_numbers/prime} Suppose that the only positive common divisor of \( n \) and \( m \) is \( 1 \). We have purposely excluded \( 1 \) from the list of prime numbers, thus no prime number divides both \( n \) and \( m \).

  \ImplicationSubProof{def:coprime_numbers/prime}{def:coprime_numbers/abstract} Suppose that no prime number divides both \( n \) and \( m \).

  Suppose that \( d \) is a common divisor of \( n \) and \( m \).

  \begin{itemize}
    \item If \( d > 0 \), \fullref{thm:fundamental_theorem_of_arithmetic} implies that \( d \) has a prime factorization; thus, if \( d > 1 \), then some prime number divides both \( n \) and \( m \), which is a contradiction. So \( d \) must be \( 1 \).

    \item If \( d < 0 \), then \( -d \) is a positive common divisor, and we conclude that \( d = -1 \).
  \end{itemize}

  Therefore, the only common divisors of \( n \) and \( m \) are invertible elements of \( \BbbZ \). Then \( n \) and \( m \) satisfy \cref{def:coprime_elements/divisors}.
\end{defproof}

\begin{proposition}\label{thm:n_plus_1_coprime}
  For any integer greater \( n \) than \( 1 \), the numbers \( n \) and \( n + 1 \) are \hyperref[def:coprime_elements]{coprime}.
\end{proposition}
\begin{proof}
  Let \( m \) be a common divisor of \( n \) and \( n + 1 \). Then there exists some integer \( k \) such that \( n = km \) and some integer \( l \) such that \( n + 1 = lm \). Then
  \begin{equation*}
    n + 1 = lm = km + 1,
  \end{equation*}
  thus \( (l - k)m = 1 \). \Cref{thm:integer_multiplicative_invertibility} implies that \( \abs{l - k} = \abs{m} = 1 \), hence \cref{def:coprime_numbers/concrete} is satisfied.
\end{proof}

\begin{proposition}\label{thm:primality_via_coprimality}
  The (positive) integer \( n \) is \hyperref[def:prime_number]{prime} if and only if \( n \) is \hyperref[def:coprime_numbers]{coprime} with every \( m < n \).
\end{proposition}
\begin{proof}
  \SufficiencySubProof Trivial.
  \NecessitySubProof Suppose that \( n \) is coprime with every \( m < n \). Thus, if \( k < m \) divides \( n \), it must be coprime, which implies that \( k = 1 \) due to \( \gcd(k, n) = k \).
\end{proof}

\paragraph{Euler's totient theorem}

\begin{definition}\label{def:eulers_totient_function}\mcite[25]{Apostol1976AnalyticNumberTheory}
  Denote by \( \varphi(n) \) the \hyperref[def:arithmetic_function]{arithmetic function} giving the number of positive integers smaller than or equal to \( n \) that are \hyperref[def:coprime_elements]{coprime} to \( n \). We call \( \varphi \) \term{Euler's totient function}.
\end{definition}
\begin{comments}
  \item In particular, we have \( \varphi(1) = 1 \). It is for this reason that we count integers smaller than \hi{or equal to} \( n \).

  \item \Fullref{thm:totient_function_product_formula} provides a useful expression in terms of prime factors.
\end{comments}

\begin{proposition}\label{thm:division_by_three_digits}
  A positive integer is divisible by \( 3 \) (resp. \( 9 \)) if and only if the sum of its \hyperref[def:positional_number_system/decimal]{decimal digits} is divisible by \( 3 \) (resp. \( 9 \)).
\end{proposition}
\begin{comments}
  \item We will discuss decimal \hyperref[def:integer_radix_expansion]{integer expansions} in \fullref{sec:positional_number_systems}. For the purpose of this proposition, a decimal expansion of the positive integer \( n \) is a polynomial \( p(X) \) such that \( p(10) = n \).
\end{comments}
\begin{proof}
  We will prove the statement for \( 3 \); the proof for \( 9 \) is identical.

  For any positive integer \( k \), \cref{thm:xn_minus_yn_factorization} implies that
  \begin{equation*}
    10^k - 1 = 9 \cdot \sum_{i=0}^{k-1} 10^i,
  \end{equation*}
  hence
  \begin{equation*}
    10^k = 1 \pmod 3.
  \end{equation*}

  Then, for the decimal expansion
  \begin{equation*}
    n = \sum_{k=0}^m a_0 10^k
  \end{equation*}
  we have
  \begin{equation*}
    n = \sum_{k=0}^m a_0 10^k = \sum_{k=0}^m a_0 \pmod 3.
  \end{equation*}
\end{proof}

\begin{proposition}\label{thm:def:eulers_totient_function}
  \hyperref[def:eulers_totient_function]{Euler's totient function} \( \varphi \) has the following basic properties:
  \begin{thmenum}
    \thmitem{thm:def:eulers_totient_function/one} \( \varphi(1) = 1 \).
    \thmitem{thm:def:eulers_totient_function/prime} \( p \) is \hyperref[def:prime_number]{prime} if and only if \( \varphi(p) = p - 1 \).
    \thmitem{thm:def:eulers_totient_function/zn} The \hyperref[def:semiring]{multiplicative group} \( \BbbZ_n^\times \) of the ring \hyperref[def:ring_of_integers_modulo]{\( \BbbZ_n \)} of integers modulo \( n > 1 \) has order \( \varphi(n) \).
  \end{thmenum}
\end{proposition}
\begin{proof}
  \SubProofOf{thm:def:eulers_totient_function/one} There are no positive integers smaller than \( 1 \), and \( 1 \) is vacuously coprime with itself.

  \SubProofOf{thm:def:eulers_totient_function/prime}

  \SufficiencySubProof* Every positive integer smaller than \( p \) is coprime to \( p \), and there are exactly \( p - 1 \) positive integers smaller than \( p \): \( 1, 2, \ldots, p - 1 \).

  \NecessitySubProof* If \( \varphi(p) = p - 1 \), the \( p \) is coprime to every positive integer smaller than \( p \). \Cref{thm:primality_via_coprimality} implies that \( p \) is prime.

  \SubProofOf{thm:def:eulers_totient_function/zn} Follows from \cref{thm:multiplicative_group_of_integers_modulo}.
\end{proof}

\begin{theorem}[Totient divisor sum]\label{thm:totient_divisor_sum}
  For any positive integer \( n \), we have
  \begin{equation}\label{eq:thm:totient_divisor_sum}
    n = \sum_{d \mid n} \varphi(d),
  \end{equation}
  where \( \varphi \) \hyperref[def:eulers_totient_function]{Euler's totient function}.
\end{theorem}
\begin{proof}
  Consider the \hyperref[def:cyclic_group]{cyclic group} \( C_n \).

  Every element \( x \) of \( C_n \) generates a cyclic group. \Cref{thm:cyclic_subgroup_classification/finite} implies that all elements of order \( d \) generate the same subgroup, \( H_d \), and \cref{thm:def:group_element_order/group_order} implies that \( d \) divides \( n \).

  Denote by \( G_d \) the set of generators of \( H_d \), i.e. the set of elements of order \( d \). Then we have the partition
  \begin{equation*}
    C_n = \bigcup \set{ G_d \given d \T{divides} n },
  \end{equation*}
  and thus, by \cref{thm:cardinality_sum_rule}, the cardinality \( n \) of \( C_n \) is the sum of the cardinalities of \( G_d \).

  \Cref{thm:def:cyclic_group/generators_cardinality} implies that \( H_d \) has \( \varphi(d) \) generators, hence \eqref{eq:thm:totient_divisor_sum} follows.
\end{proof}

\begin{theorem}[Totient function product formula]\label{thm:totient_function_product_formula}
  \hyperref[def:eulers_totient_function]{Euler's totient function} can be expressed as
  \begin{equation}\label{eq:thm:totient_function_product_formula}
    \varphi(n) = n \cdot \prod_{v_p(n) > 0} \parens*{ 1 - \frac 1 p }.
  \end{equation}
\end{theorem}
\begin{comments}
  \item Since we want to cover the case \( n = 1 \), where \( \varphi(1) = 1 \), we must allow \( r = 0 \) and agree that the empty product has value \( 1 \).
\end{comments}
\begin{proof}
  It will be simpler for us to work with a concrete prime factorization \( n = p_1^{a_1} \cdots p_r^{a_r} \).

  Let \( N \) and \( A_k \) be defined as in \cref{thm:inclusion_exclusion_eratosthenes}. Then
  \begin{equation*}
    \varphi(n) = \card N - \card\parens[\Big]{ \bigcup_{k=1}^r A_{p_k} }.
  \end{equation*}

  \Fullref{thm:inclusion_exclusion_principle} implies that
  \begin{equation}\label{eq:thm:totient_function_product_formula/intermediate}
    \varphi(n) = n + \sum_{m=1}^r (-1)^m \sum_{i_1 < \cdots < i_m} \frac n {p_{i_1} \cdots p_{i_m}}.
  \end{equation}

  Note the minus sign in the second term changed the index in \( (-1)^m \).

  We now use induction on \( r \).
  \begin{itemize}
    \item If \( r = 0 \), since we have agreed on \( 1 \) as the product of the empty set, \( \varphi(1) = 1 \).
    \item If \( r = 1 \), then
    \begin{equation*}
      \varphi(n) = n + (-1) \frac n {p_1} = n \parens[\Big]{ 1 - \frac 1 {p_1} }.
    \end{equation*}

    \item Let \( r > 1 \) and suppose that \eqref{eq:thm:totient_function_product_formula} holds for all positive integers with \( r - 1 \) prime factors. Then
    \begin{align*}
      \varphi(n)
      &\reloset{\eqref{eq:thm:totient_function_product_formula/intermediate}} =
      n + \sum_{m=1}^r (-1)^m \sum_{i_1 < \cdots < i_m} \frac n {p_{i_1} \cdots p_{i_m}}
      = \\ &=
      n + \sum_{m=1}^{r-1} \underbrace{(-1)^m} \sum_{i_1 < \cdots < i_m \leq r - 1} \frac n {p_{i_1} \cdots p_{i_m}} + \\ &\quad\quad + \frac n {p_r} + \sum_{m=1}^{r-1} \underbrace{(-1)^{m+1}} \sum_{i_1 < \cdots < i_m \leq r - 1} \frac n {p_{i_1} \cdots p_{i_m}} \cdot \frac 1 {p_r}
      = \\ &=
      \parens*{ 1 - \frac 1 {p_r} } \cdot \parens*{ n + \sum_{m=1}^{r-1} (-1)^m \sum_{i_1 < \cdots < i_m \leq r - 1} \frac n {p_{i_1} \cdots p_{i_m}} }
      \reloset {\T{ind.}} = \\ &=
      \parens*{ 1 - \frac 1 {p_r} } \cdot n \cdot \prod_{k=1}^{r - 1} \parens*{ 1 - \frac 1 {p_k} }.
    \end{align*}
  \end{itemize}
\end{proof}

\begin{example}\label{ex:thm:totient_function_product_formula} We can use \fullref{thm:totient_function_product_formula} to compute the totient function of a number if we know its prime factors. For example,
  \begin{equation*}
    \varphi(25) = 25 \cdot \parens[\Big]{ 1 - \frac 1 5 } = \frac {25 \cdot 4} 5 = 20.
  \end{equation*}
\end{example}

\begin{definition}\label{def:multiplicative_arithmetic_function}\mcite[33]{Apostol1976AnalyticNumberTheory}
  If an \hyperref[def:arithmetic_function]{arithmetic function} \( f \) satisfies
  \begin{equation}\label{eq:def:multiplicative_arithmetic_function}
    f(nm) = f(n) \cdot f(m)
  \end{equation}
  whenever \( n \) and \( m \) are \hyperref[def:coprime_numbers]{coprime}, we say that \( f \) is \term[ru=мультипликативная (функция) (\cite[def. 36]{Бухштаб1966ТеорияЧисел})]{multiplicative}.

  If \eqref{eq:def:multiplicative_arithmetic_function} is satisfied for \hi{all} positive integers \( n \) and \( m \), we say that \( f \) is \term[ru=вполне мультипликативная (функция) (\cite[def. 37]{Бухштаб1966ТеорияЧисел})]{completely multiplicative}.
\end{definition}
\begin{comments}
  \item There is a clash in terminology. \Cref{def:multiplicative_function} generalizes completely multiplicative arithmetic functions, but refers to them simply as \enquote{multiplicative}. Thus, a function may be multiplicative in the sense of \cref{def:multiplicative_arithmetic_function} but not \cref{def:multiplicative_function}.

  To resolve this issue, we use \enquote{multiplicative on coprimes} and \enquote{completely multiplicative} whenever confusion is possible.
\end{comments}

\begin{proposition}\label{thm:totient_function_multiplicative}
  \hyperref[def:eulers_totient_function]{Euler's totient function} is \hyperref[def:multiplicative_arithmetic_function]{multiplicative on coprimes}.
\end{proposition}
\begin{proof}
  Follows from \fullref{thm:totient_function_product_formula}.
\end{proof}

\begin{theorem}[Euler's totient theorem]\label{thm:eulers_totient_theorem}
  For positive coprime integers \( n \) and \( x \), we have
  \begin{equation*}
    x^{\varphi(n)} \cong 1 \pmod n,
  \end{equation*}
  where \( \varphi \) is \hyperref[def:eulers_totient_function]{Euler's totient function}.
\end{theorem}
\begin{proof}
  This is vacuous for \( n = 1 \) since all integers are equal modulo \( 1 \).

  Suppose that \( n > 1 \). First, use \fullref{alg:integer_division} to obtain integers \( q \) and \( y < n \) such that
  \begin{equation*}
    x = nq + y.
  \end{equation*}

  Since \( x \) is, by assumption, coprime with \( n \), then \( y \) must also coprime with \( n \). Indeed, every common divisor \( d \) of \( y \) and \( n \) is also a common divisor \( x \), and the largest such possible value is \( \gcd(n, x) = 1 \).

  Now consider the \hyperref[def:semiring]{multiplicative group} \( \BbbZ_n^\times \) of the ring \hyperref[def:ring_of_integers_modulo]{\( \BbbZ_n \)} of integers modulo \( n \) and the \hyperref[def:cyclic_group]{cyclic subgroup} \( \set{ 1, y, y^2, \ldots } \) (modulo \( n \)). It is necessarily finite as a subgroup of \( \BbbZ_n^\times \). Furthermore, by \fullref{thm:lagranges_subgroup_theorem}, its order \( k \) divides the order of \( \BbbZ_n^\times \). By \cref{thm:def:eulers_totient_function/zn}, the order of \( \BbbZ_n^\times \) is \( \varphi(n) \).

  Let \( m \) be the quotient of \( \varphi(n) \) and \( k \). We have \( y^k \cong 1 \pmod n \) since \( k \) is the (multiplicative) order of \( y \). Thus,
  \begin{equation*}
    y^{\varphi(n)}
    =
    y^{km}
    \reloset {\eqref{eq:thm:semigroup_exponentiation_properties/repeated}} =
    (y^k)^m
    \cong
    1^m
    \pmod n.
  \end{equation*}
\end{proof}

\begin{corollary}\label{thm:division_modulo}
  Given positive integers \( n \) and \( m \), we can apply \fullref{alg:integer_division} to obtain \( n = q \cdot \varphi(m) + r \), where \( \varphi \) is \hyperref[def:eulers_totient_function]{Euler's totient function}.

  Then, for a positive integer \( x \) coprime to \( m \), we have
  \begin{equation*}
    x^n \cong x^r \pmod m,
  \end{equation*}
\end{corollary}
\begin{proof}
  By \fullref{thm:eulers_totient_theorem}, \( x^{\varphi(m)} \cong 1 \pmod m \). Then
  \begin{equation*}
    x^n = (x^{\varphi(m)})^q x^r \cong x^r \pmod m.
  \end{equation*}
\end{proof}

\begin{example}\label{ex:thm:division_modulo}
  The single-digit positive integers coprime with \( 10 \) are \( 1 \), \( 3 \), \( 7 \) and \( 9 \), so \( \varphi(10) = 4 \). By \cref{thm:division_modulo}, since \( 1000 = 250 \cdot \varphi(10) \),
  \begin{equation*}
    9^{1000} \cong 9^0 \pmod {10}.
  \end{equation*}

  Thus, the last digit of the \hyperref[def:positional_number_system/decimal]{decimal expansion} of \( 9^{1000} \) is \( 1 \).
\end{example}

\begin{theorem}[Fermat's little theorem]\label{thm:fermats_little_theorem}
  For a \hyperref[def:prime_number]{prime number} \( p \) and for any positive integer \( x \), we have
  \begin{equation*}
    x^p \cong x \pmod p.
  \end{equation*}
\end{theorem}
\begin{proof}
  If \( p \mid x \), then both \( x^p \) and \( x \) and congruent to \( 0 \) modulo \( p \).

  Otherwise, by \fullref{thm:eulers_totient_theorem}, we have \( x^{\varphi(p) + 1} \cong x \pmod p \), and by \cref{thm:def:eulers_totient_function/prime}, we have \( \varphi(p) + 1 = p \).
\end{proof}
