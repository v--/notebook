\subsection{First-order models}\label{subsec:first_order_models}

\paragraph{First-order models}

\begin{definition}\label{def:propositional_model}\mcite[def. 1.4.1(i)]{Hinman2005}
  We say that the \hyperref[def:propositional_valuation/interpretation]{propositional interpretation} \( I \) is a \term{propositional model} of the set of \hyperref[def:propositional_syntax/formula]{propositional formulas} \( \Gamma \) if \( \Bracks{\varphi}_I = T \) for every formula \( \varphi \in \Gamma \).

  We also say that \( \Gamma \) is \term{valid} under \( I \), that \( I \) \term{satisfies} \( \Gamma \) and that the set \( \Gamma \) is \term{satisfiable} if there exists at least one model for it.
\end{definition}

\begin{remark}\label{rem:first_order_satisfiability_bivalence}
  We will now show why \fullref{def:propositional_model} requires some adjustments for first-order formulas.

  Given a \hyperref[def:propositional_syntax/formula]{propositional formula} \( \varphi \) and an \hyperref[def:propositional_valuation/interpretation]{interpretation} \( I \), the latter \hyperref[def:propositional_model]{satisfies} either \( \varphi \) or \( \neg \varphi \). This is the principle of bivalence discussed in \fullref{rem:classical_logic}.

  Similarly, given a \hyperref[def:first_order_valuation/variable_assignment]{first-order variable assignment} \( v \) in the \hyperref[def:first_order_structure]{structure} \( \mscrX \) and a \hyperref[def:first_order_syntax/formula]{first-order formula} \( \varphi \), either \( \Bracks{\varphi} = T \) or \( \Bracks{\neg \varphi}_v = T \).

  It is obvious how we should define satisfiability for a concrete variable assignment, but the question remains how to define it for a structure.

  Fix an arbitrary structure \( \mscrX = (X, I) \) with two elements \( X = \set{ a, b } \) and consider the formula \( \xi \doteq \eta \). Let \( v \) be any variable assignment such that \( v(\xi) = v(\eta) = a \) and let \( w \) be an assignment such that \( w(\xi) = a \) and \( w(\eta) = b \). Clearly \( \Bracks{\xi \doteq \eta}_v = T \) and \( \Bracks{\xi \doteq \eta}_w = F \). Thus, some assignments satisfy the formula and some do not.

  It makes sense to define
  \begin{equation*}
    \Bracks{\varphi}_\mscrX
    \coloneqq
    \begin{cases}
      T, \Bracks{\varphi}_v = T \T{for every assignment} v, \\
      F, \T{otherwise}.
    \end{cases}
  \end{equation*}

  This is what Peter Hinman in \incite[rem. 2.2.17]{Hinman2005} calls \term{universally valid} formulas in \( \mscrX \).

  We just saw that \( \xi \doteq \eta \) is not universally valid. But neither is \( \xi \doteq \eta \) because
  \begin{equation*}
    \Bracks{\neg (\xi \doteq \eta)}_v = \overline{\Bracks{\xi \doteq \eta}_v} = F
  \end{equation*}

  Therefore, the principle of bivalence does not hold for universal validity. In order for it to hold, what we will do in \fullref{def:first_order_model} is restrict to \hyperref[def:first_order_syntax/closed_formula]{closed formulas}, which depend only on the underlying structure and not on the variable assignments.
\end{remark}

\begin{definition}\label{def:universal_closure}\mcite[def. 2.2.28(i)]{Hinman2005}
  Given a formula \( \varphi \) with free variables \( \xi_1, \ldots, \xi_n \), we call
  \begin{equation*}
    \qforall {\xi_1} \cdots \qforall {\xi_n} \varphi
  \end{equation*}
  its \term{universal closure} and say that \( \varphi \) itself is \term{implicitly universally quantified}. Universal closures of quantifierless formulas are called \term{universal formulas}.
\end{definition}
\begin{comments}
  \item This allows us to skip quantifiers when writing formulas without changing their validity. This is useful for notational brevity and is used all across the document whenever we want \hi{closed} formulas, for example in \fullref{def:semiring/theory}, \fullref{def:semiring/theory} or \fullref{def:binary_relation}.
\end{comments}

\begin{proposition}\label{thm:implicit_universal_quantification}
  Every first-order formula is semantically equivalent to its \hyperref[def:universal_closure]{universal closure}.
\end{proposition}
\begin{comments}
  \item See \fullref{ex:def:first_order_natural_deduction_system/eigenvariables/invalid_universal_closure} for how this fails for derivability rather than entailment.
\end{comments}
\begin{proof}
  \SufficiencySubProof Let \( \mscrX = (X, I) \) be a structure that satisfies \( \varphi \). Let \( v \) be a variable assignment in \( \mscrX \). Then for any \( x \in X \), the modified variable assignment \( v_{\xi \mapsto x} \) also satisfies \( \varphi \), i.e.
  \begin{equation*}
    \Bracks{\varphi}_v = \Bracks{\varphi}_{v_{\xi \mapsto x}} = T.
  \end{equation*}

  Thus, \( \mscrX \) is also a model for \( \qforall \xi \varphi \).

  \NecessitySubProof Conversely, suppose that \( \mscrX \) satisfies \( \qforall \xi \varphi \) and \( v \) is any variable assignment. Then
  \begin{equation*}
    \Bracks{\varphi}_{v_{\xi \mapsto x}} = T
  \end{equation*}
  for any \( x \), including \( x = v(\xi) \). Thus,
  \begin{equation*}
    \Bracks{\varphi}_{v_{\xi \mapsto v(\xi)}} = \Bracks{\varphi}_v = T.
  \end{equation*}

  Therefore, \( \mscrX \) is also a model for \( \varphi \).
\end{proof}

\begin{definition}\label{def:first_order_model}\mcite[def. 2.2.13(ii)]{Hinman2005}
  We say that the \hyperref[def:first_order_structure]{first-order structure} \( \mscrX = (X, I) \) is a \term{first-order model} of the set of \hyperref[def:first_order_syntax/closed_formula]{closed first-order formulas} \( \Gamma \) if, for an arbitrary variable assignment \( v \) in \( \mscrX \), \( \Bracks{\varphi}_v = T \) for every formula \( \varphi \in \Gamma \).

  We also say that \( \Gamma \) is \term{valid} in \( \mscrX \), that \( \mscrX \) \term{satisfies} \( \Gamma \) and that the set \( \Gamma \) is \term{satisfiable} if there exists at least one model for it.
\end{definition}
\begin{comments}
  \item Since the formulas are closed, the result does not depend on the assignment. We only assignments as a technical tool because we avoid defining entailment within a structure. The problems of doing the latter are discussed in \fullref{rem:first_order_satisfiability_bivalence}.
\end{comments}

\begin{remark}\label{rem:first_order_model_notation}
  In first-order logic, \hyperref[def:first_order_structure]{structures} are defined as pairs \( \mscrX = (X, I) \). Each area of mathematics has its own conventions and structures are usually specified as simply as possible without being unambiguous (and sometimes even beyond non-ambiguity).

  A popular convention is to use compatible letters like we did with \( X \) and \( \mscrX \) or \( G \) and \( \mscrG \), where the structure itself is named using calligraphic letters while the domain is named using the corresponding capital letter in normal font. This only works very simple cases where we can say \enquote{Let \( \mscrP = (P, \leq) \) be a \hyperref[def:partially_ordered_set]{partially ordered set}}.

  The language of the \hyperref[def:group/theory]{theory of groups} has a signature consisting of three functional symbols and no predicate symbols. Specifying a structure for this language is thus the same as specifying a quadruple \( \mscrG = (G, e, (\anon)^{-1}, \cdot) \). We usually specify only the domain \( G \) and the basic structure needed to avoid ambiguity, for example \enquote{Let \( (G, \cdot) \) be a group}. This is technically wrong, but it is both convenient and conventional. The rest of the definition of the group can easily be inferred. In case of ambiguity, the simplest disambiguation is to use lower indices with the name of the structure, e.g. \( +_G \) and \( +_H \) may be the addition operation in different abelian groups.

  Furthermore, stating that \( (G, \cdot, \leq, \mscrT) \) is a totally ordered topological group is cumbersome and can even raise questions; for example, is \( \mscrT \) the \hyperref[def:order_topology]{order topology} or just an arbitrary \hyperref[rem:topological_first_order_structures]{group topology}?
\end{remark}

\begin{remark}\label{rem:questions_regarding_structures}
  Within this section, we are interested in the following questions regarding \hyperref[def:first_order_structure]{first-order structure} and \hyperref[def:first_order_model]{models}:

  \begin{itemize}
    \item Which subsets of a structure form a \hyperref[def:first_order_substructure]{substructure}?

    This is answered by \fullref{def:first_order_substructure} and by \fullref{def:first_order_generated_substructure}. Vacuously, if the language contains no functional symbols, every subset of (the domain of) a structure is a substructure. Such is the case with \hyperref[def:set]{sets} themselves, with \hyperref[def:partially_ordered_set]{partially ordered sets} or with \hyperref[def:metric_space]{metric} and \hyperref[def:topological_space]{topological spaces}.

    \Fullref{thm:substructures_form_complete_lattice} shows that the family of all substructures of a structure is worth studying in itself.

    \item Given a model of some set \( \Gamma \) of formulas, which substructures and \hyperref[def:first_order_homomorphism]{homomorphic} images of the model are again models of \( \Gamma \)?

    This is answered by \fullref{thm:positive_formulas_preserved_under_homomorphism}, \fullref{thm:arbitrary_formulas_preserved_under_isomorphisms} and \fullref{thm:functions_over_model_form_model}.
  \end{itemize}
\end{remark}

\paragraph{First-order substructures}

\begin{definition}\label{def:first_order_substructure}\mcite[def. 2.3.12]{Hinman2005}
  Let \( \mscrX = (X, I) \) be a structure for the language \( \mscrL \) and let \( Y \subseteq X \). We say that \( \mscrY = (Y, J) \) is a \term{substructure} of \( \mscrX \) if:

  \begin{thmenum}
    \thmitem{def:first_order_substructure/universe} The universe \( Y \) satisfies either of the equivalent conditions:

    \begin{thmenum}
      \thmitem{def:first_order_substructure/universe/deductive} It is closed under function application, that is, for any functional symbol \( f \) in \( \mscrL \) with arity \( n \), we have \( I(f)(Y^n) \subseteq Y \).

      \thmitem{def:first_order_substructure/universe/inductive} It is a \hyperref[def:fixed_point]{fixed point} of the operator
      \begin{equation*}
        \begin{aligned}
          &T: \pow(X) \to \pow(X), \\
          &T(A) \coloneqq A \cup \set[\Big]{ I(f)(x_1, \ldots, x_{\#f}) \given f \in \boldop{Fun} \T{and} x_1, \ldots, x_{\#f} \in A},
        \end{aligned}
      \end{equation*}
      which enlarges \( A \) with the union of all image of \( A \) under functions of the language \( \mscrL \).
    \end{thmenum}

    \thmitem{def:first_order_substructure/functional} For every functional symbol \( f \in \boldop{Fun}_\mscrL \), the interpretation \( J(f) \) is a restriction of \( I(f) \) to \( Y \).

    \thmitem{def:first_order_substructure/predicate} For every predicate symbol \( p \in \boldop{Pred}_\mscrL \), the interpretation \( J(p) \) is a restriction of \( I(p) \) to \( Y \).
  \end{thmenum}
\end{definition}
\begin{comments}
  \item We will say \enquote{\( (Y, I) \)} when we mean that \( Y \) is the domain of a substructure of \( \mscrX = (X, I) \) to avoid defining an interpretation \( J \) that merely restricts the domains and codomains from \( X \) to \( Y \).
\end{comments}
\begin{defproof}
  \ImplicationSubProof{def:first_order_substructure/universe/deductive}{def:first_order_substructure/universe/inductive} By definition of \( T \), \( Y \) if a fixed point if and only if
  \begin{equation*}
    \set[\Big]{ I(f)(x_1, \ldots, x_{\#f}) \given f \in \boldop{Fun} \T{and} x_1, \ldots, x_{\#f} \in A} \subseteq Y.
  \end{equation*}

  This condition is clearly satisfied if \( B \) satisfies \fullref{def:first_order_substructure/universe/deductive}.

  \ImplicationSubProof{def:first_order_substructure/universe/inductive}{def:first_order_substructure/universe/deductive} If, instead \( Y \) is a fixed point of \( T \), for the \( n \)-ary functional symbol \( f \in \boldop{Fun} \) and for any tuple \( x_1, \ldots, x_n \), the value \( I(f)(x_1, \ldots, x_n) \) belongs to \( Y \). Therefore, \fullref{def:first_order_substructure/universe/deductive} is satisfied.
\end{defproof}

\begin{proposition}\label{thm:substructure_relation_is_transitive}
  The \hyperref[def:first_order_substructure]{first-order substructure} relation is \hyperref[def:binary_relation/transitive]{transitive}.

  More precisely, let \( \mscrY = (Y, I) \) be a substructure of the first-order structure \( \mscrX = (X, I) \) and let \( Z \) be a subset of \( Y \).

  Then \( (Z, I) \) is a substructure of \( (Y, I) \) if and only if it is a substructure of \( (X, I) \).
\end{proposition}
\begin{proof}
  Trivial in both directions.
\end{proof}

\begin{example}\label{ex:def:first_order_substructure/vector_space}
  The classic definition for a subset \( U \) of a \hyperref[def:vector_space]{vector space} \( \mscrV \) being a vector subspace is that \( U \) is closed under \hyperref[rem:linear_combinations]{linear combinations}. Linear combinations are simply finite \hyperref[rem:function_superposition]{superpositions} of addition and scalar multiplication in \( \mscrV \). So this condition ensures that \( U \) is closed under application of the functional symbols corresponding to addition and scalar multiplication.

  See \fullref{thm:span_via_linear_combinations} for a further discussion.
\end{example}

\begin{remark}\label{rem:topological_first_order_structures}
  Let \( \mscrX = (X, I) \) be a structure over some language \( \mscrL \) without predicate symbols.

  If, for every functional symbol \( f \), the interpretation \( I(f) \) is a \hyperref[def:global_continuity]{continuous function}, we call \( \mscrX \) a \term{topological structure}.

  For every algebraic structure defined in \fullref{sec:group_theory} and \fullref{sec:ring_theory}, there exists a topological equivalent. We discuss \hyperref[def:topological_group]{topological groups} and \hyperref[def:topological_vector_space]{topological vector spaces} through the document, especially in \fullref{sec:functional_analysis}.

  Naturally, every substructure of a topological structure is again a topological structure.
\end{remark}

\begin{proposition}\label{thm:intersection_substructure}
  Fix a first-order structure \( \mscrX = (X, I) \). Let \( \seq{ (X_k, I) }_{k \in \mscrK} \) be a family of substructures of \( \mscrX \) and suppose that they are not disjoint. Then their \term{intersection substructure} \( \parens*{\bigcap_{k \in \mscrK} X_k, I} \) is again a substructure of \( \mscrX \).
\end{proposition}
\begin{comments}
  \item In case the substructures are disjoint, their intersection is empty, which is technically not the domain of a structure. If we allow empty domains, as per \fullref{rem:empty_first_order_structures}, then the condition for the substructures not to be disjoint is unnecessary.
\end{comments}
\begin{proof}
  For any functional symbol \( f \) in \( \mscrL \) with arity \( n \), we have
  \begin{equation*}
    I(f)\parens*{\parens*{\bigcap_{\smash{k \in \mscrK}} X_k}^n}
    \reloset {\ref{thm:function_image_properties/intersection}} \subseteq
    \bigcap_{k \in \mscrK} I(f)(X_k^n).
  \end{equation*}

  Therefore, \( \parens*{\bigcap_{k \in \mscrK} X_k, \bigcap_{k \in \mscrK} I_k} \) is indeed a substructure of \( \mscrX \).
\end{proof}

\begin{definition}\label{def:first_order_generated_substructure}\mimprovised
  Let \( \mscrX = (X, I) \) be a first-order structure. Given a subset \( A \) of \( X \), we define the substructure \term[bg=породена (\cite[110]{ПетровЗяпков2010}), ru=порожденная (\cite[55]{Мальцев1970})]{generated} by \( A \) as the \hyperref[thm:intersection_substructure]{intersection substructure} of all substructures whose domains contain \( A \).

  We denote the domain of this generated substructure by \( \braket{ A } \). \Fullref{thm:closure_operator_from_set_semilattice} implies that it is a \hyperref[def:moore_closure_operator]{Moore closure operator} on \( \pow(X) \).
\end{definition}
\begin{comments}
  \item In particular, as a consequence of \fullref{thm:closure_operator_minimality}, \( \braket{ A } \) is the least among all substructure domains containing \( A \).
\end{comments}

\begin{theorem}[Induction on generated substructures]\label{thm:induction_on_generated_substructures}
  Fix a \hyperref[def:first_order_structure]{first-order structure} \( \mscrX = (X, I) \) over \( \mscrL \) and a subset \( A \) of \( X \). Let \( \varphi \) be a formula over \( \mscrL \) with a single free variable \( \xi \).

  Then, in order for \( \Bracks{\varphi}(x) = T \) to hold for every \( x \) in the substructure \hyperref[def:first_order_generated_substructure]{generated} by \( A \), the following conditions are sufficient:
  \begin{thmenum}
    \thmitem{thm:induction_on_generated_substructures/base} Prove that \( \Bracks{\varphi}(x) = T \) for every \( x \) in \( A \).
    \thmitem{thm:induction_on_generated_substructures/step} For every functional symbol \( f \) in \( \mscrL \), prove that, given that \( n \) is the arity of \( f \), if there exists a tuple \( x_1, \ldots, x_n \) such that \( \Bracks{\varphi}(x_k) = T \) for every \( k = 1, \ldots, n \), then
    \begin{equation*}
      \Bracks{\varphi}\parens[\Big]{ I(f)(x_1, \ldots, x_n) } = T.
    \end{equation*}
  \end{thmenum}
\end{theorem}
\begin{proof}
  Suppose that both \fullref{thm:induction_on_generated_substructures/base} and \fullref{thm:induction_on_generated_substructures/step} hold. Let \( x \) be an arbitrary member of \( \braket{ A } \).

  \begin{itemize}
    \item If \( x \in A \), then \fullref{thm:induction_on_generated_substructures/base} ensures that \( \Bracks{\varphi}(x) = T \).
    \item Otherwise, there exists a functional symbol \( f \) and a tuple \( x_1, \ldots, x_n \) such that \( x = f(x_1, \ldots, x_n) \).

    Indeed, aiming at a contradiction, suppose not. Then \( \braket{ A } \setminus \set{ x } \) is also closed under application of all functions in \( \mscrL \), and hence is itself the domain of a substructure of \( \mscrX \). This contradicts the minimality of \( \braket{ A } \), however.

    Now that we have shown the existence of \( f \) and \( x_1, \ldots, x_n \), \fullref{thm:induction_on_generated_substructures/step} implies that
    \begin{equation*}
      \Bracks{\varphi}\parens[\Big]{ \underbrace{ I(f)(x_1, \ldots, x_n) }_{x} } = T.
    \end{equation*}
  \end{itemize}

  We have shown that \fullref{thm:induction_on_generated_substructures/base} and \fullref{thm:induction_on_generated_substructures/step} together imply that \( \Bracks{\varphi}(x) = T \) for every member \( x \) of \( \braket{ A } \).
\end{proof}

\begin{example}\label{ex:def:first_order_generated_substructure}
  Common examples of generated substructures are the \hyperref[def:semimodule/submodel]{linear span} discussed in \fullref{thm:span_via_linear_combinations} and the \hyperref[def:semiring_ideal/generated]{generated ring ideals}.
\end{example}

\begin{proposition}\label{thm:substructures_form_complete_lattice}
  Fix a structure \( \mscrX = (X, I) \) for the language \( \mscrL \).

  With respect to set inclusion of domains, the family of all substructures of a \( \mscrX \) forms a complete lattice. Explicitly:
  \begin{thmenum}
    \thmitem{thm:substructures_form_complete_lattice/join} The \hyperref[def:lattice/join]{join} of the family of substructures \( \seq{ (X_k, I) }_{k \in \mscrK} \) is the \hyperref[def:first_order_generated_substructure]{generated substructure} of the set \( \bigcup_{k \in \mscrK} X_k \).

    \thmitem{thm:substructures_form_complete_lattice/top} The \hyperref[def:extremal_points/top_and_bottom]{top element} is the structure \( \mscrX \) itself. Any substructures that are different from \( \mscrX \) are called \term{proper}.

    \thmitem{thm:substructures_form_complete_lattice/meet} The \hyperref[def:lattice/meet]{meet} of the family of substructures \( \seq{ (X_k, I) }_{k \in \mscrK} \) is simply the \hyperref[thm:intersection_substructure]{intersection substructure} \( \parens*{\bigcap_{k \in \mscrK} X_k, I} \).

    \thmitem{thm:substructures_form_complete_lattice/bottom} The \hyperref[def:extremal_points/top_and_bottom]{bottom element} of this lattice is the intersection of all substructures.
  \end{thmenum}
\end{proposition}
\begin{comments}
  \item The initial substructure may or may not be isomorphic to the \hyperref[rem:trivial_object]{trivial structure}.

  \item As discussed in \fullref{rem:empty_first_order_structures}, the empty set is not allowed to be the domain of a structure by definition. Nevertheless, for the sake of having a bottom element we allow structures with empty domains in this lattice.
\end{comments}
\begin{proof}
  \SubProofOf{thm:substructures_form_complete_lattice/join} Let \( (Y, I) \) be the generated substructure of the set \( A \coloneqq \bigcup_{k \in \mscrK} X_k \). From \fullref{thm:closure_operator_minimality} it follows that out of the domains of all substructures of \( \mscrX \), \( Y \) is the smallest that contains \( A \) and hence the smallest that contains \( X_k \) for all \( k \in \mscrK \). Therefore, it is indeed the supremum of the family \( \seq{ (X_k, I) }_{k \in \mscrK} \) with respect to set inclusion of domains.

  \SubProofOf{thm:substructures_form_complete_lattice/top} Since \( \mscrX \) is a substructure of itself, it is not only the supremum of the entire lattice, but actually the greatest element.

  \SubProofOf{thm:substructures_form_complete_lattice/meet} The domain of the intersection substructure of the family \( \seq{ (X_k, I_k) }_{k \in \mscrK} \) of substructures of \( \mscrX \) is the infimum of the family as a consequence of the equivalence in \fullref{def:first_order_generated_substructure}.

  \SubProofOf{thm:substructures_form_complete_lattice/bottom} It follows from \fullref{thm:substructures_form_complete_lattice/meet} that the bottom element is the intersection of all substructures of \( \mscrX \).
\end{proof}

\paragraph{Positive formulas}

\begin{definition}\label{def:positive_formula}\mcite[def. 3.5.67]{Hinman2005}
  The following grammar rule, extending the \hyperref[def:first_order_syntax/grammar_schema]{grammar schema of first-order logic}, describes what we call \term{positive formulas}:
  \begin{bnf*}
    \bnfprod{positive formula} {\bnftsq{\( \top \)} \bnfor} \\
    \bnfmore                   {\bnfpn{atomic formula} \bnfor} \\
    \bnfmore                   {\bnftsq{(} \bnfsp \bnfpn{formula} \bnfsp \bnftsq{\( \vee \)} \bnfsp \bnfpn{formula} \bnfsp \bnftsq{)} \bnfor} \\
    \bnfmore                   {\bnftsq{(} \bnfsp \bnfpn{formula} \bnfsp \bnftsq{\( \wedge \)} \bnfsp \bnfpn{formula} \bnfsp \bnftsq{)} \bnfor} \\
    \bnfmore                   {\bnfpn{quantifier} \bnfsp \bnfpn{variable} \bnfsp \bnftsq{.} \bnfsp \bnfpn{formula}}
  \end{bnf*}
\end{definition}
\begin{comments}
  \item The point of positive formulas is to avoid \hyperref[def:propositional_language/negation]{negation \( \neg \)}. We also avoid \( \rightarrow \) because, assuming classical logic, \fullref{thm:boolean_equivalences/conditional_as_disjunction} would then allow us to introduce negation.

  \item Positive formulas are used in \fullref{thm:positive_formulas_preserved_under_homomorphism}, which fails to hold for some non-positive formulas --- see \fullref{ex:monoid_cancellation_not_preserved_by_homomorphism}.

  \item When dealing with first-order logic, we simply use \hyperref[thm:first_order_substitution_equivalence/propositional]{substitution} to replace propositional variables with atomic formulas. This way we obtain positive first-order formulas with \hyperref[thm:implicit_universal_quantification]{implicit universal quantification}. Of course, we can always add explicit universal quantifiers, but we avoid existential quantifiers because of \fullref{thm:first_order_quantifiers_are_dual}.
\end{comments}

\begin{definition}\label{def:first_order_submodel}
  Given a \hyperref[def:first_order_model]{model} \( \mscrX \) of the set of \hyperref[def:first_order_syntax/closed_formula]{closed formulas} \( \Gamma \), we say that a \hyperref[def:first_order_substructure]{substructure} \( \mscrY \) of \( \mscrX \) is a \term{submodel} (with respect to \( \Gamma \)) if \( \mscrY \) is also a model of \( \Gamma \).
\end{definition}
\begin{comments}
  \item In this document, \( \Gamma \) is usually unambiguously clear from the context.
\end{comments}

\begin{proposition}\label{thm:substructure_is_model}
  If \( \Gamma \) is a set of closed \hyperref[def:positive_formula]{positive formulas} \hi{without existential quantifiers}, any \hyperref[def:first_order_substructure]{substructure} of a model of \( \Gamma \) is again a model of \( \Gamma \), i.e. a \hyperref[def:first_order_submodel]{first-order submodel}.
\end{proposition}
\begin{comments}
  \item See \fullref{ex:replacing_functional_symbols_via_relations} for an example of how this may fail if there are existential quantifiers.
\end{comments}
\begin{proof}
  This proposition can be proven by a straightforward application of \fullref{thm:induction_on_syntax_trees}. In each case of the induction, we do not require any elements in addition to those already present in the substructure.
\end{proof}

\begin{proposition}\label{thm:functions_over_model_form_model}
  Let \( \Gamma \) to be a set of closed \hyperref[def:positive_formula]{positive formulas} \hi{without existential quantifiers}. Let \( \mscrX = (X, I) \) be a model of \( \Gamma \) and let \( A \) be a nonempty \hyperref[def:set]{plain set}, possibly unrelated to \( \mscrX \). Consider the set \( Y \coloneqq \fun(A, \mscrX) \) of \hyperref[def:function]{all set functions} from \( A \) to \( X \).

  Define \( \iota: X \mapsto Y \) by sending each \( x \in X \) to the corresponding constant function in \( Y \).

  Define the interpretation \( J \) as follows:
  \begin{itemize}
    \item For each \( n \)-ary functional symbol \( f \) in \( \mscrL \), define the interpretation of the functions \( y_1, \ldots, y_n \) componentwise as
    \begin{equation*}
      \begin{aligned}
        &J(f): Y^n \to Y \\
        &J(f) \parens[\Big]{ y_1, \ldots, y_n } \coloneqq \parens[\Big]{ s \mapsto I(f) \parens[\Big]{ y_1(s), \ldots, y_n(s) } }.
      \end{aligned}
    \end{equation*}

    \item For each \( n \)-ary predicate symbol \( p \) in \( \mscrL \), define \( J(p) \subseteq Y^n \) via
    \begin{equation*}
      \begin{aligned}
        &J(p): Y^n \to \set{ T, F } \\
        &J(p) \parens[\Big]{ y_1, \ldots, y_n } \coloneqq \bigwedge_{s \in S} I(p) \parens[\Big]{ y_1(s), \ldots, y_n(s) }.
      \end{aligned}
    \end{equation*}

    This way \( J(p) (y_1, \ldots, y_n) = T \) if and only if \( I(p) (y_1(s), \ldots, y_n(s)) = T \) simultaneously for all \( s \in S \).
  \end{itemize}

  Then the structure \( \mscrY = (Y, J) \) is also a model of \( \Gamma \).
\end{proposition}
\begin{proof}
  It is obvious that \( \mscrY \) is a structure.

  Let \( \varphi \) be a positive formula and suppose that it is valid in \( \mscrX \). We will use \fullref{thm:induction_on_syntax_trees} to show that \( \Bracks{\varphi}_w = T \) for a fixed variable assignment \( w \) in \( \mscrY \).
  \begin{itemize}
    \item If \( \varphi = \top \), its valuation does not depend on \( w \) and thus \( \Bracks{\varphi}_w = T \).

    \item If \( \varphi = \tau_1 \doteq \tau_2 \), then \( \Bracks{\tau_1}_v = \Bracks{\tau_2}_v \) for every assignment \( v \) in \( \mscrX \), hence for any \( s \in S \) we have \( \Bracks{\tau_1}_w(s) = \Bracks{\tau_2}_w(s) \) since both sides of the latter equality here are elements of \( \mscrX \).

    \item Similarly, if \( \varphi = p(\tau_1, \ldots, \tau_n) \), then
    \begin{equation*}
      J(p) \parens[\Big]{ y_1, \ldots, y_n }
      =
      \bigwedge \set[\Big]{ I(p) \parens[\Big]{ y_1(s), \ldots, y_n(s) } \given* s \in S }
      =
      \bigwedge \set{ T \given s \in S }
      =
      T.
    \end{equation*}

    \item Analogous to our proof of \fullref{thm:positive_formulas_preserved_under_homomorphism}, conjunction and disjunction formulas that are valid in \( \mscrX \) are valid in \( \mscrY \).

    \item If \( \varphi = \qforall \xi \psi \) and the inductive hypothesis holds for \( \psi \), then
    \begin{equation*}
      \Bracks{\varphi}_w
      =
      \bigwedge_{y \in Y} \Bracks{\psi}_{w_{\xi \to y}}
      \geq
      \bigwedge_{\substack{\T{const.} \\ \T{func.} y}} \Bracks{\psi}_{w_{\xi \to y}}
      =
      \bigwedge_{x \in X} \Bracks{\psi}_{v_{\xi \to x}}
      =
      \bigwedge_{x \in X} T
      =
      T.
    \end{equation*}
  \end{itemize}
\end{proof}

\begin{example}\label{ex:thm:functions_over_model_of_positive_formulas_form_model}
  While the statement of \fullref{thm:functions_over_model_form_model} may be a little cryptic, a few examples show that it is actually obvious.
  \begin{itemize}
    \thmitem{ex:thm:functions_over_model_of_positive_formulas_form_model/boolean} \hyperref[def:boolean_operator]{Boolean operators} have their values in the Boolean algebra \( \set{ T, F } \). Let \( S \) be the set of all tuples of values in \( \set{ T, F }^n \) for arbitrary \( n \). That is,
    \begin{equation*}
      S \coloneqq \bigcup_{n \geq 1} \set{ T, F }^n.
    \end{equation*}

    Then from \fullref{thm:functions_over_model_form_model} it follows that the set \( B = \fun(S, \set{ T, F }) \) of all Boolean operators of arbitrary arities is again a Boolean algebra. See \fullref{thm:lindenmaum_tarski_algebra_of_full_propositional_logic/bijection} for further discussion.

    \thmitem{ex:thm:functions_over_model_of_positive_formulas_form_model/ring} If \( R \) is a \hyperref[def:ring]{ring} and \( A \) is any set, then \( \fun(A, R) \) is again a ring with componentwise operations --- see \fullref{thm:functions_over_algebra}.

    This is useful in functional analysis where we study real-valued and complex-valued functions over arbitrary sets.

    \thmitem{ex:thm:functions_over_model_of_positive_formulas_form_model/field} The axiom \eqref{eq:rem:entire_semiring_axiom} that holds for  \hyperref[def:field]{field} is not positive. Hence, if \( \BbbK \) is a \hyperref[def:field]{field}, then in general \( \fun(A, \BbbK) \) is not a field.

    A simple example is the ring of real-valued real functions --- \( \sin(x) \) has no multiplicative inverse since \( 1 / \sin(x) \) is not defined for \( x = 2k\pi, k = 1, 2, \ldots \).

    We can form a \hyperref[thm:field_of_fractions]{field of fractions}, but in general fields of fractions over function rings no longer correspond to functions --- they are purely algebraic constructions, just like \hyperref[def:formal_power_series]{formal power series}.
  \end{itemize}
\end{example}

\paragraph{First-order homomorphisms}

\begin{definition}\label{def:first_order_homomorphism}\mcite[def. 2.3.26(i); rem. 2.3.27]{Hinman2005}
  Let \( \mscrX = (X, I) \) and \( \mscrY = (Y, J) \) be structures over \( \mscrL \). We say that the \hyperref[def:function]{set-theoretic function} \( h: X \to Y \) is a \term{homomorphism} between \( \mscrX \) and \( \mscrY \) if it preserves all logical functions and predicates of \( \mscrL \). Explicitly:
  \begin{thmenum}
    \thmitem{def:first_order_homomorphism/functions} For any functional symbol \( f \) of arity \( n \) and any tuple \( x_1, \ldots, x_n \in X \) we have
    \begin{equation}\label{eq:def:first_order_homomorphism/functions}
      h\parens[\Big]{ I(f)(x_1, \ldots, x_n) } = J(f) \parens[\Big]{ h(x_1), \ldots, h(x_n) }
    \end{equation}

    \thmitem{def:first_order_homomorphism/predicates} For any predicate symbol \( p \) of arity \( n \) and any \( x_1, \ldots, x_n \in X \),
    \begin{equation}\label{eq:def:first_order_homomorphism/predicates}
      I(p) (x_1, \ldots, x_n) = T \T{implies} J(p) \parens[\Big]{ h(x_1), \ldots, h(x_n) } = T.
    \end{equation}
  \end{thmenum}
\end{definition}
\begin{comments}
  \item We sometimes use the notation \( h: \mscrX \to \mscrY \).
  \item \Fullref{thm:first_order_homomorphism_as_substructure} provides a condition equivalent to \fullref{def:first_order_homomorphism/functions}.
  \item Note that the condition \fullref{def:first_order_homomorphism/predicates} for predicates is strictly weaker than
  \begin{equation*}
    I(p) (x_1, \ldots, x_n) = J(p) \parens[\Big]{ h(x_1), \ldots, h(x_n) },
  \end{equation*}
  which is used in \fullref{def:first_order_embedding} to define embeddings.

  Peter Hinman in \incite[def. 2.3.26(i)]{Hinman2005} requires the latter condition, and then in \cite[rem. 2.3.27]{Hinman2005} calls \term{positive homomorphism} out definition.

  We see this as unnecessarily complicated since most of our use cases like \hyperref[def:partially_ordered_set]{partially ordered sets} and \hyperref[def:directed_graph]{simple graphs} are covered precisely by (what we just called) positive homomorphisms.
\end{comments}

\begin{proposition}\label{thm:def:first_order_homomorphism}
  \hyperref[def:first_order_homomorphism]{First-order homomorphisms} have the following basic properties:
  \begin{thmenum}
    \thmitem{thm:def:first_order_homomorphism/inclusion} If \( \mscrX = (X, I) \) is a structure and \( \mscrY = (Y, I) \) is a \hyperref[def:first_order_substructure]{substructure} of \( \mscrX \), then the \term{canonical inclusion} function
    \begin{equation}\label{thm:def:first_order_homomorphism/inclusion/canonical_inclusion}
      \begin{aligned}
        &\iota: Y \to X \\
        &\iota(y) \coloneqq y
      \end{aligned}
    \end{equation}
    is indeed a homomorphism (and thus an embedding in the sense of \fullref{def:first_order_embedding}).

    \thmitem{thm:def:first_order_homomorphism/image_is_substructure} Given a homomorphism \( h: \mscrX \to \mscrY \), the \hyperref[def:set_valued_map/image]{image} of \( \mscrX \) under \( h \) is a substructure of \( \mscrY \).

    \thmitem{thm:def:first_order_homomorphism/preimage_is_substructure} Given a homomorphism \( h: \mscrX \to \mscrY \) and a substructure \( \mscrZ \) of \( \mscrY \), the \hyperref[def:set_valued_map/inverse]{preimage} of \( \mscrZ \) under \( h \) is a substructure of \( \mscrX \).

    \thmitem{thm:def:first_order_homomorphism/composition} The \hyperref[def:set_valued_map/composition]{composition} of two homomorphisms is again a homomorphism.

    \thmitem{thm:def:first_order_homomorphism/term_valuation} Fix a homomorphism \( h: X \to Y \) and a term \( \tau \). For any variable assignments \( v \) and \( w \) such that \( w(\xi) = h(v(\xi)) \) for all \( \xi \in \boldop{Var}(\tau) \), we have
    \begin{equation*}
      h(\Bracks{\tau}_v) = \Bracks{\tau}_w.
    \end{equation*}
  \end{thmenum}
\end{proposition}
\begin{proof}
  \SubProofOf{thm:def:first_order_homomorphism/inclusion} The interpretation in the substructure \( \mscrY \) is the \hyperref[def:set_valued_map/restriction]{restriction} \( J \) of \( I \) to \( Y \). Thus, \( \mscrY = (Y, J) \) is a structure. Conditions \fullref{def:first_order_homomorphism/functions} and \fullref{def:first_order_homomorphism/predicates} are thus satisfied. Hence, \( \iota \) is a homomorphism.

  \SubProofOf{thm:def:first_order_homomorphism/image_is_substructure} We must show that the image \( h[X] \) satisfies \fullref{def:first_order_substructure/universe/deductive} and thus the domain of a substructure of \( \mscrY \).

  Indeed, due to \fullref{def:first_order_homomorphism/functions}, for any \( n \)-ary functional symbol and any \( n \)-tuple \( x_1, \ldots, x_n \) from \( X \), we have that
  \begin{equation*}
    J(f) \parens[\Big]{ h(x_1), \ldots, h(x_n) }
    \reloset {\ref{def:first_order_homomorphism/functions}} =
    h\parens[\Big]{ I(f)(x_1, \ldots, x_n) }
    \reloset {\ref{def:first_order_substructure/universe/deductive}} \in
    h[X].
  \end{equation*}

  \SubProofOf{thm:def:first_order_homomorphism/preimage_is_substructure} We must show that \( h^{-1}[Z] \) satisfies \fullref{def:first_order_substructure/universe/deductive}.

  For any \( n \)-ary functional symbol and any \( n \)-tuple \( x_1, \ldots, x_n \) from \( h^{-1}[Z] \), the value
  \begin{equation*}
    J(f) \parens[\Big]{ h(x_1), \ldots, h(x_n) }
    \reloset {\ref{def:first_order_homomorphism/functions}} =
    h\parens[\Big]{ I(f) (x_1, \ldots, x_n) }
  \end{equation*}
  is in \( Z \), hence \( I(f) (x_1, \ldots, x_n) \) is in \( h^{-1}[Z] \).

  \SubProofOf{thm:def:first_order_homomorphism/composition} Let \( h: \mscrX \mapsto \mscrY \) and \( l: \mscrY \mapsto \mscrZ \) both be homomorphisms. Then \( l \bincirc h: \mscrX \to \mscrY \) is a homomorphism:

  \begin{itemize}
    \item \Fullref{def:first_order_homomorphism/functions} is satisfied because for any \( n \)-ary functional symbol \( f \) and any tuple \( x_1, \ldots, x_n \in X \),
    \small
    \begin{equation*}
      (l \bincirc h) \parens[\Big]{ I(f)(x_1, \ldots, x_n) }
      \reloset {\ref{def:first_order_homomorphism/functions}} =
      l\parens[\Big]{ J(f) \parens[\Big]{ h(x_1), \ldots, h(x_n) } }
      \reloset {\ref{def:first_order_homomorphism/functions}} =
      I_{\mscrZ}(f) \parens[\Big]{ (l \bincirc h)(x_1), \ldots, (l \bincirc h)(x_n) }.
    \end{equation*}
    \normalsize

    \item \Fullref{def:first_order_homomorphism/predicates} is satisfied because for any \( n \)-ary predicate symbol \( p \) and any tuple \( x_1, \ldots, x_n \in X \),
    \begin{equation*}
      I(p) (x_1, \ldots, x_n)
      \reloset {\ref{def:first_order_homomorphism/predicates}} =
      J(p) \parens[\Big]{ h(x_1), \ldots, h(x_n) }
      \reloset {\ref{def:first_order_homomorphism/predicates}} =
      I_{\mscrZ}(p) \parens[\Big]{ (l \bincirc h)(x_1), \ldots, (l \bincirc h)(x_n) }.
    \end{equation*}
  \end{itemize}

  \SubProofOf{thm:def:first_order_homomorphism/term_valuation} We use induction on the structure of \( \tau \).
  \begin{itemize}
    \item If \( \tau \) is a variable, the statement is obvious from the compatibility condition for \( v \) and \( w \).
    \item If \( \tau = f(\kappa_1, \ldots, \kappa_m) \), then
    \begin{align*}
      \Bracks{\tau}_w
      &=
      I(f) \parens[\Big]{ \Bracks{\kappa_1}_w, \ldots, \Bracks{\kappa_m}_w }
      = \\ &=
      I(f) \parens[\Big]{ h(\Bracks{\kappa_1}_v), \ldots, h(\Bracks{\kappa_m}_v) }
      \reloset {\ref{def:first_order_homomorphism/functions}} = \\ &=
      h\parens[\Big]{ I(f) \parens[\Big]{ \Bracks{\kappa_1}_v, \ldots, \Bracks{\kappa_m}_v } }
      = \\ &=
      h(\Bracks{\tau}_v).
    \end{align*}
  \end{itemize}
\end{proof}

\begin{proposition}\label{thm:positive_formulas_preserved_under_homomorphism}
  A \hyperref[def:first_order_homomorphism]{first-order homomorphism} preserves models of closed \hyperref[def:positive_formula]{positive formulas}.

  More concretely, given some language \( \mscrL \), if \( \Gamma \) is a set of closed positive formulas and \( h: \mscrX \to \mscrY \) is a homomorphism between \hyperref[def:first_order_model]{models} of \( \Gamma \), then the image \( h[X] \) is also (the domain of) a model of \( \Gamma \).
\end{proposition}
\begin{comments}
  \item Compare this to \fullref{thm:arbitrary_formulas_preserved_under_isomorphisms}, which places restrictions on the homomorphism rather than the formulas.
\end{comments}
\begin{proof}
  Since the formulas in \( \Gamma \) are closed, we are free to choose any variable assignment we like. Via \fullref{thm:induction_on_syntax_trees} on an arbitrary positive formula \( \varphi \), we will show that, for every variable assignment \( w \) in \( \mscrY \), there exists an assignment \( v \) in \( \mscrX \) such that \( \Bracks{\varphi}_v = T \) implies \( \Bracks{\varphi}_w = T \).

  Let \( w \) a variable assignment in \( \mscrY \). Let \( v \) be an assignment in \( \mscrX \) such that, for any variable \( \xi \), we have
  \begin{equation*}
    h(v(\xi)) = w(\xi).
  \end{equation*}

  The \hyperref[def:zfc/choice]{axiom of choice} guarantees the existence of such an assignment. Furthermore, if \( h \) is injective, this assignment is unique.

  The inductive hypothesis is more general than \enquote{\( \Bracks{\varphi}_v = T \) implies \( \Bracks{\varphi}_w = T \)} because of the more complicated case of quantified formulas. Nonetheless, given our fixed assignments \( v \) and \( w \), the inductive conclusion in turn implies that the image \( h[X] \) satisfies any closed positive formula if \( \mscrX \) does, in particular the formulas from \( \Gamma \).

  \begin{itemize}
    \item The constant \( \top \) is vacuously preserved by homomorphisms because it does not depend on the interpretation or variable assignment.

    \item Suppose that \( \varphi = \tau_1 \doteq \tau_2 \). We have \( \Bracks{\tau_1}_v = \Bracks{\tau_2}_v \) and hence
    \begin{equation*}
      \Bracks{\tau_1}_w
      \reloset {\ref{thm:def:first_order_homomorphism/term_valuation}} =
      h(\Bracks{\tau_1}_v)
      =
      h(\Bracks{\tau_2}_v)
      \reloset {\ref{thm:def:first_order_homomorphism/term_valuation}} =
      \Bracks{\tau_2}_w.
    \end{equation*}

    \item Suppose that \( \varphi \) is the predicate formula \( p(\tau_1, \ldots, \tau_n) \). By assumption, \( \Bracks{p(\tau_1, \ldots, \tau_n)}_v = T \). Then
    \begin{equation}\label{eq:thm:positive_formulas_preserved_under_homomorphism/predicates/x}
      I(p) \parens[\Big]{ \Bracks{\tau_1}_v, \ldots, \Bracks{\tau_n}_v } = T.
    \end{equation}

    By the definition of homomorphism, this implies
    \begin{equation}\label{eq:thm:positive_formulas_preserved_under_homomorphism/predicates/y}
      J(p) \parens[\Big]{ \underbrace{h(\Bracks{\tau_1}_v)}_{\Bracks{\tau_1}_w}, \ldots, \underbrace{h(\Bracks{\tau_n}_v)}_{\Bracks{\tau_n}_w} } = T.
    \end{equation}

    Now \( \Bracks{p(\tau_1, \ldots, \tau_n)}_w = T \) follows from \fullref{thm:def:first_order_homomorphism/term_valuation}.

    \item Suppose that \( \varphi = \psi_1 \wedge \psi_2 \), where \( \psi_1 \) and \( \psi_2 \) are positive formulas, and that the inductive hypothesis holds for \( \psi_1 \) and \( \psi_2 \).

    Since \( \Bracks{\varphi}_v = T \) by assumption, by definition of valuation of conjunction we have
    \begin{equation*}
      \Bracks{\psi_1}_v
      =
      \Bracks{\psi_2}_v
      =
      T.
    \end{equation*}

    This allows us to apply the inductive hypothesis to obtain
    \begin{equation*}
      \Bracks{\psi_1}_w
      =
      \Bracks{\psi_2}_w
      =
      T.
    \end{equation*}
    and conclude that
    \begin{equation*}
      \Bracks{\varphi}_w
      =
      \Bracks{\psi_1}_w \wedge \Bracks{\psi_2}_w
      =
      T \wedge T
      =
      T.
    \end{equation*}

    \item Suppose that \( \varphi = \psi_1 \vee \psi_2 \), where \( \psi_1 \) and \( \psi_2 \) are positive formulas, and that the inductive hypothesis holds for \( \psi_1 \) and \( \psi_2 \).

    Since the formula \( \varphi \) is valid in \( \mscrX \), at least one of \( \psi_1 \) or \( \psi_2 \) is valid under \( v \), hence
    \begin{equation}\label{eq:thm:positive_formulas_preserved_under_homomorphism/sup_of_disjunction}
      \Bracks{\varphi}_v = \sup\set{ \Bracks{\psi_1}_v, \Bracks{\psi_2}_v } = T.
    \end{equation}

    The values \( \Bracks{\psi_1}_v \) and \( \Bracks{\psi_2}_v \) may differ between \( \psi_1 \) and \( \psi_2 \), but \eqref{eq:thm:positive_formulas_preserved_under_homomorphism/sup_of_disjunction} always holds.

    The inductive hypothesis holds for both \( \psi_1 \) and \( \psi_2 \), therefore
    \begin{equation*}
      \Bracks{\varphi}_w = \sup\set{ \Bracks{\psi_1}_w, \Bracks{\psi_2}_w } = T.
    \end{equation*}

    \item Suppose that \( \varphi = \qforall \xi \psi \), where \( \psi \) is a positive formula for which the inductive hypothesis holds.

    Fix some \( x \in X \). Since \( \Bracks{\varphi}_v = T \), then \( \Bracks{\psi}_{v_{\xi \to x}} = T \), hence the inductive hypothesis implies \( \Bracks{\psi}_{w_{\xi \to x}} = T \). This happens for all \( x \in X \), therefore \( \Bracks{\varphi}_w = T \).

    \item Finally, suppose that \( \varphi = \qexists \xi \psi \), where again \( \psi \) is a positive formula for which the inductive hypothesis holds.

    Since \( \Bracks{\varphi}_v = T \), there exists some \( x \in X \) such that \( \Bracks{\psi}_{v_{\xi \to x}} = T \), hence the inductive hypothesis implies \( \Bracks{\psi}_{w_{\xi \to x}} = T \). Therefore, \( \Bracks{\varphi}_w = T \).
  \end{itemize}
\end{proof}

\begin{example}\label{ex:thm:positive_formulas_preserved_under_homomorphism/proof_failure}
  To see how our proof of \fullref{thm:positive_formulas_preserved_under_homomorphism} fails for conditionals, consider the formula \( \varphi = \psi_1 \rightarrow \psi_2 \), where the inductive hypothesis holds for \( \psi_1 \) and \( \psi_2 \).

  If \( \Bracks{\varphi}_v = T \), then one of the following holds:
  \begin{itemize}
    \item \( \Bracks{\psi_1}_v = \Bracks{\psi_2}_v = T \), which via the inductive hypothesis implies \( \Bracks{\psi_1}_w = \Bracks{\psi_2}_w = T \) and hence \( \Bracks{\varphi}_w = T \).
    \item \( \Bracks{\psi_1}_v = F \), which doesn't imply \( \Bracks{\psi_1}_w = F \). In this case it is possible to have \( \Bracks{\psi_1}_w = T \) and \( \Bracks{\psi_2}_w = F \), which implies \( \Bracks{\varphi}_w = F \). This is the negation of what we need to prove.
  \end{itemize}

  What if we change our inductive hypothesis to \( \Bracks{\varphi}_v = \Bracks{\varphi}_w \)\footnote{This is precisely what we will do in the case of \hyperref[def:first_order_embedding]{embeddings} in \fullref{thm:arbitrary_formulas_preserved_under_isomorphisms}}? This fails for atomic formulas because \( \Bracks{\tau_1 \doteq \tau_2}_v = F \) doesn't imply \( \Bracks{\tau_1 \doteq \tau_2}_w = F \) --- consider the case of a group homomorphism from \( (\BbbR, +) \) to \( (\set{ 0 }, +) \). We can this of this alternative inductive hypothesis as a semantical way of introducing negation, which turns our to cause problems.

  See \fullref{ex:monoid_cancellation_not_preserved_by_homomorphism} for an example where a conditional is not preserved by a homomorphism.
\end{example}

\begin{example}\label{ex:replacing_functional_symbols_via_relations}
  Consider the \hyperref[def:semigroup/theory]{theory of semigroups}. We have a functional symbol \( \cdot \), which we can also represent via the ternary predicate \( p(\xi, \eta, \zeta) \), which holds for \( (x, y, z) \) in some model \( \mscrX \) if and only if \( x \cdot y = z \).

  If we choose to work only with the relation, the language would not have any functional symbols, and every subset of (the domain of) \( \mscrX \) would be a substructure.

  This also introduces a complication, however. We must ensure that the relation represents a function, and this can be done via the axiom
  \begin{equation*}
    \qforall \xi \qforall \eta \qExists \zeta p(\xi, \eta, \zeta),
  \end{equation*}
  where we have used the unique existence shorthand from \fullref{ex:replacing_functional_symbols_via_relations}.

  In this setting, a model of the theory of semigroups must satisfy this axiom, and thus it is possible for a substructure not to be a model.

  For example, the negative real numbers are not a semigroup under multiplication because the product of two negative numbers is positive. A functional symbol encodes this requirement into the definition of a substructure. But otherwise we must encode this via formulas, which makes the definition of substructure trivial, but now it is possible for a substructure not to be a model.
\end{example}

\paragraph{First-order direct products}

\begin{definition}\label{def:first_order_direct_product}\mcite[def. 2.3.54]{Hinman2005}
  Fix a family of \hyperref[def:first_order_structure]{first-order structures} \( \seq{ \mscrX_k }_{k \in \mscrK} \) over a common language \( \mscrL \), where \( \mscrX_k = (X_k, I_k) \).

  We call the \term{direct product} of this family the structure \( (X, I) \) denoted by \( \prod_{k \in \mscrK} \mscrX_k \) (or \( \mscrX^\mscrK \) if all structures are equal to \( \mscrX \)) and defined as follows:
  \begin{thmenum}
    \thmitem{def:first_order_direct_product/domain} The domain \( X \) is the \hyperref[def:cartesian_product]{Cartesian product} \( \prod_{k \in \mscrK} X_k \) of the corresponding domains.

    \thmitem{def:first_order_direct_product/functions} For every \( n \)-ary functional symbol \( f \) in \( \mscrL \), we define its interpretation componentwise:
    \begin{equation*}
      \begin{aligned}
        &I(f): \prod_{k \in \mscrK} \mscrX_k \to X, \\
        &I(f)\parens[\Big]{ \seq{ x_{1,k} }_{k \in \mscrK}, \ldots, \seq{ x_{n,k} }_{k \in \mscrK} } = \seq[\Big]{ I_k(f)(x_{1,k}, \ldots, x_{n,k}) }_{k \in \mscrK}. \\
      \end{aligned}
    \end{equation*}

    \thmitem{def:first_order_direct_product/predicates} For every \( n \)-ary predicate symbol \( p \) in \( \mscrL \), we define its interpretation componentwise:
    \begin{equation*}
      \begin{aligned}
        &I(p): \prod_{k \in \mscrK} \mscrX_k \to \set{ T, F }, \\
        &I(p)\parens[\Big]{ \seq{ x_{1,k} }_{k \in \mscrK}, \ldots, \seq{ x_{n,k} }_{k \in \mscrK} } = \bigwedge_{k \in \mscrK} I_k(p)(x_{1,k}, \ldots, x_{n,k}). \\
      \end{aligned}
    \end{equation*}
  \end{thmenum}
\end{definition}
\begin{comments}
  \item The direct product is surprisingly useful --- we use it to characterize homomorphisms and congruences as substructures. See \fullref{thm:first_order_homomorphism_as_substructure}.
\end{comments}

\begin{proposition}\label{thm:direct_product_projections}
  Given the \hyperref[def:first_order_direct_product]{first-order direct product} \( \prod_{k \in \mscrK} \mscrX_k \), for every \( m \in \mscrK \), the following \term{canonical projection} function is a \hyperref[def:first_order_homomorphism]{first-order homomorphism}:
  \begin{equation*}
    \begin{aligned}
      &\pi_m: \prod_{k \in \mscrK} \mscrX_k \to \mscrX_m, \\
      &\pi_m(\seq{ x_k }_{k \in \mscrK}) \coloneqq x_m.
    \end{aligned}
  \end{equation*}
\end{proposition}
\begin{proof}
  Let \( I \) be the interpretation of the product and \( I_k \) --- of \( \mscrX_k \). For every \( n \)-ary functional symbol \( f \) in \( \mscrL \), we have
  \begin{align*}
    &\phantom{{}={}}
    \pi_m\parens[\Big]{ I(f)\parens[\Big]{ \seq{ x_{1,k} }_{k \in \mscrK}, \ldots, \seq{ x_{n,k} }_{k \in \mscrK} } }
    = \\ &=
    \pi_m\parens[\Big]{ \seq[\Big]{ I_k(f)\parens{ x_{1,k}, \ldots, x_{n,k} } }_{k \in \mscrK} }
    = \\ &=
    I_m(f)\parens{ x_{1,m}, \ldots, x_{n,m} }
    = \\ &=
    I_m(f)\parens[\Big]{ \pi_m\parens[\Big]{ \seq{ x_{1,k} }_{k \in \mscrK} }, \ldots, \pi_m\parens[\Big]{ \seq{ x_{n,k} }_{k \in \mscrK} } }.
  \end{align*}

  This shows \fullref{def:first_order_homomorphism/functions}.

  Now fix an \( n \)-ary predicate symbol \( p \) in \( \mscrL \) and suppose that
  \begin{equation*}
    I(p)\parens[\Big]{ \seq{ x_{1,k} }_{k \in \mscrK}, \ldots, \seq{ x_{n,k} }_{k \in \mscrK} } = T.
  \end{equation*}

  Then \fullref{def:first_order_direct_product/predicates} implies that
  \begin{equation*}
    I_{k_0}(p)(x_{1,m}, \ldots, x_{n,m}) = T.
  \end{equation*}

  Then
  \begin{equation*}
    I_{k_0}(p)\parens[\Big]{ \pi_m\parens[\Big]{ \seq{ x_{1,k} }_{k \in \mscrK} }, \ldots, \pi_m\parens[\Big]{ \seq{ x_{n,k} }_{k \in \mscrK} } }
    =
    I_{k_0}(p)(x_{1,m}, \ldots, x_{n,m})
    =
    T.
  \end{equation*}

  This shows \fullref{def:first_order_homomorphism/predicates}.

  Therefore, \( \pi_m \) is a first-order homomorphism.
\end{proof}

\begin{proposition}\label{thm:first_order_homomorphism_as_substructure}
  Let \( \mscrX = (X, I) \) and \( \mscrY = (Y, J) \) be structures over \( \mscrL \). The \hyperref[def:function]{set-theoretic function} \( h: X \to Y \) preserves logical functions, i.e. satisfies \fullref{def:first_order_homomorphism/functions}, if and only if it is the domain of a \hyperref[def:first_order_substructure]{substructure} of the \hyperref[def:first_order_direct_product]{direct product} \( \mscrX \times \mscrY \).
\end{proposition}
\begin{proof}
  \SufficiencySubProof Suppose that \( h: X \to Y \) is a function that satisfies \fullref{def:first_order_homomorphism/functions}. We must show that \( h \) is closed under function application in \( \mscrX \times \mscrY \). Denote by \( K \) the interpretation in the structure \( \mscrX \times \mscrY \).

  First note that \( (x, y) \in h \) if and only if \( y = h(x) \).

  Let \( f \) be an \( n \)-ary function symbol from \( \mscrL \). Then, for any \( n \)-tuple of pairs \( (x_1, y_1), \ldots, (x_n, y_n) \) from \( h \), we have
  \begin{align*}
    K(f)\parens[\Big]{ (x_1, y_1), \ldots, (x_n, y_n) }
    &=
    \parens[\Big]{ I(f)\parens[\Big]{ x_1, \ldots, x_n }, J(f)\parens[\Big]{ y_1, \ldots, y_n } }
    = \\ &=
    \parens[\Big]{ I(f)\parens[\Big]{ x_1, \ldots, x_n }, J(f)\parens[\Big]{ h(x_1), \ldots, h(x_n) } }.
  \end{align*}

  Since \( h \) satisfies \fullref{def:first_order_homomorphism/functions}, it follows that
  \begin{equation*}
    h\parens[\Big]{ I(f)(x_1, \ldots, x_n) } = J(f)\parens[\Big]{ h(x_1), \ldots, h(x_n) },
  \end{equation*}
  and
  \begin{equation*}
    K(f)\parens[\Big]{ (x_1, y_1), \ldots, (x_n, y_n) } \in h.
  \end{equation*}

  Therefore, \( h \) is a substructure of \( \mscrX \times \mscrY \).

  \NecessitySubProof Suppose that \( h \) is a substructure of \( \mscrX \times \mscrY \). Again, denote by \( K \) the interpretation in the structure \( \mscrX \times \mscrY \).

  Fix an \( n \)-ary functional symbol \( f \) and an \( n \)-tuple \( x_1, \ldots, x_n \) from \( X \). The pairs \( (x_1, h(x_1)), \ldots, (x_n, h(x_n)) \) belong to \( h \). Since \( h \) is closed under logical function application, it must contain
  \begin{equation*}
    K(f)\parens[\Big]{ (x_1, h(x_1)), \ldots, (x_n, h(h_n)) }
    =
    \parens[\Big]{ I(f)\parens[\Big]{ x_1, \ldots, x_n }, J(f)\parens[\Big]{ h(x_1), \ldots, h(x_n) } }.
  \end{equation*}

  Therefore,
  \begin{equation*}
    h\parens[\Big]{ I(f)(x_1, \ldots, x_n) } = J(f)\parens[\Big]{ h(x_1), \ldots, h(x_n) }
  \end{equation*}
  and \( h \) satisfies \fullref{def:first_order_homomorphism/functions}.
\end{proof}

\begin{proposition}\label{thm:direct_product_preserves_positive_formulas}
  Let \( \Gamma \) be a closed set of \hyperref[def:positive_formula]{positive formulas} \hi{without disjunctions} over \( \mscrL \) and let \( \seq{ \mscrX_k }_{k \in \mscrK} \) be a family of structures over \( \mscrL \), where \( \mscrX_k = (X_k, I_k) \) for every \( k \in \mscrK \).

  If, for every \( k \in \mscrK \), the structure \( \mscrX_k \) is a \hyperref[def:first_order_model]{model} of \( \Gamma \), then so is the \hyperref[def:first_order_direct_product]{direct product} \( \prod_{k \in \mscrK} \mscrX_k \).
\end{proposition}
\begin{comments}
  \item \Fullref{ex:def:first_order_direct_product/algebraic} demonstrates that the requirement for positivity is crucial, while \fullref{ex:def:first_order_direct_product/order} demonstrates that the requirement for the formulas to have no disjunction is crucial.

  \item We can see in \eqref{eq:thm:direct_product_preserves_positive_formulas/proof_conjunction} why the proof fails for formulas with disjunction.
\end{comments}
\begin{proof}
  We will denote the domain and interpretation of the direct product by \( X \) and \( I \) correspondingly.

  First, we will use \fullref{thm:induction_on_syntax_trees} on a term \( \tau \) to show that the following extension of \fullref{def:first_order_direct_product/functions} holds:
  \begin{equation}\label{eq:thm:direct_product_preserves_positive_formulas/hypothesis_terms}
    \Bracks{\tau}_v = \seq[\Big]{ \Bracks{\tau}_{v^k} }_{k \in \mscrK},
  \end{equation}
  where \( v \) is any \hyperref[def:first_order_valuation/variable_assignment]{variable assignment} in \( \prod_{k \in \mscrK} \mscrX_k \) and \( v^k \) be the \( k \)-th component of \( v \).

  \begin{itemize}
    \item The case when \( \tau \) is a variable follows from our definition of \( v^k \).
    \item If \( \tau = f(\kappa_1, \ldots, \kappa_n) \) and the inductive hypothesis holds for \( \kappa_1, \ldots, \kappa_n \), then, for any assignment \( v \),
    \begin{align*}
      \Bracks{\tau}_v
      &=
      I(f) \parens[\Big]{ \Bracks{\kappa_1}_v, \ldots, \Bracks{\kappa_n}_v }
      \reloset {\T{ind.}} = \\ &=
      I(f) \parens[\Big]{ \seq[\Big]{ \Bracks{\kappa_1}_{v^k} }_{k \in \mscrK}, \ldots, \seq[\Big]{ \Bracks{\kappa_n}_{v^k} }_{k \in \mscrK} }
      = \\ &=
      \seq[\Big]{ I_k(f) \parens[\Big]{ \Bracks{\kappa_1}_{v^k}, \ldots, \Bracks{\kappa_n}_{v^k} } }_{k \in \mscrK}
      = \\ &=
      \seq[\Big]{ \Bracks{\tau}_{v^k} }_{k \in \mscrK}.
    \end{align*}
  \end{itemize}

  Now, we will use \fullref{thm:induction_on_syntax_trees} on a positive formula \( \varphi \) to show that the following extension of \fullref{def:first_order_direct_product/predicates} holds:
  \begin{equation}\label{eq:thm:direct_product_preserves_positive_formulas/hypothesis_formulas}
    \Bracks{\varphi}_v = \bigwedge_{k \in \mscrK} \Bracks{\varphi}_{v^k},
  \end{equation}
  where again \( v \) is taken to be arbitrary.

  \begin{itemize}
    \item The case \( \varphi = \top \) is vacuous.
    \item If \( \varphi = \tau_1 \doteq \tau_2 \), for a fixed assignment \( v \) we have two possibilities
    \begin{itemize}
      \item If \( \Bracks{\varphi}_{v^k} = T \) for every \( k \in \mscrK \), then \( \Bracks{\tau_1}_{v^k} = \Bracks{\tau_2}_{v^k} \) and thus
      \begin{equation}\label{eq:thm:direct_product_preserves_positive_formulas/proof_equality}
        \Bracks{\tau_1}_v
        \reloset {\eqref{eq:thm:direct_product_preserves_positive_formulas/hypothesis_terms}} =
        \seq[\Big]{ \Bracks{\tau_1}_{v^k} }_{k \in \mscrK}
        =
        \seq[\Big]{ \Bracks{\tau_2}_{v^k} }_{k \in \mscrK}
        \reloset {\eqref{eq:thm:direct_product_preserves_positive_formulas/hypothesis_terms}} =
        \Bracks{\tau_2}_v.
      \end{equation}

      Therefore,
      \begin{equation*}
        \Bracks{\varphi}_v
        =
        T
        =
        \bigwedge_{k \in \mscrK} \Bracks{\varphi}_{v^k}.
      \end{equation*}

      \item If there exists some index \( k_0 \) for which \( \Bracks{\varphi}_{v^{k_0}} = F \), then \eqref{eq:thm:direct_product_preserves_positive_formulas/proof_equality} does not hold, hence
      \begin{equation*}
        \Bracks{\varphi}_v
        =
        F
        =
        \bigwedge_{k \in \mscrK} \Bracks{\varphi}_{v^k}.
      \end{equation*}
    \end{itemize}

    \item If \( \varphi = p(\tau_1, \ldots, \tau_n) \), then, by what we have shown for terms, for any variable assignment \( v \):
    \begin{equation*}
      \Bracks{\varphi}_v
      =
      I(p)\parens[\Big]{ \Bracks{\tau_1}_v, \ldots, \Bracks{\tau_n}_v }
      \reloset {\eqref{eq:thm:direct_product_preserves_positive_formulas/hypothesis_terms}} =
      \bigwedge_{k \in \mscrK} I_k(p)\parens[\Big]{ \Bracks{\tau_1}_{v^k}, \ldots, \Bracks{\tau_n}_{v^k} }
      =
      \bigwedge_{k \in \mscrK} \Bracks{\varphi}_{v^k}.
    \end{equation*}

    \item Suppose that \( \varphi = \psi_1 \wedge \psi_2 \) and that the inductive hypothesis holds for \( \psi_1 \) and \( \psi_2 \). For each \( k \in \mscrK \), commutativity of \( \Bracks{\wedge} \) implies
    \begin{equation}\label{eq:thm:direct_product_preserves_positive_formulas/proof_conjunction}
      \begin{aligned}
        \Bracks{\varphi}_v
        &=
        \Bracks{\psi_1}_v \Bracks{\wedge} \Bracks{\psi_2}_v
        = \\ &=
        \parens[\Bigg]{ \bigwedge_{k \in \mscrK} \Bracks{\psi_1}_{v^k} } \Bracks{\wedge} \parens[\Bigg]{ \bigwedge_{k \in \mscrK} \Bracks{\psi_2}_{v^k} }
        = \\ &=
        \bigwedge_{k \in \mscrK} \parens[\Big]{ \Bracks{\psi_1}_{v^k} \Bracks{\wedge} \Bracks{\psi_2}_{v^k} }
        = \\ &=
        \bigwedge_{k \in \mscrK} \Bracks{\varphi}_{v^k}.
      \end{aligned}
    \end{equation}

    \item Suppose that \( \varphi = \qforall \xi \psi \) and that the inductive hypothesis holds for \( \psi \). Fix an assignment \( v \). Then, again because of the commutativity of meets in \( \set{ T, F } \),
    \begin{align*}
      \Bracks{\qforall \xi \psi}_v
      &=
      \bigwedge \set[\Big]{ \Bracks{\psi}_{v_{\xi \mapsto \seq{ x_k }_{k \in \mscrK}}} \given* \seq{ x_m }_{m \in \mscrK} \in \prod_{m \in \mscrK} X_m }
      = \\ &=
      \bigwedge \set[\Big]{ \bigwedge_{k \in \mscrK} \Bracks{\psi}_{v^k_{\xi \mapsto x_k}} \given* \seq{ x_m }_{m \in \mscrK} \in \prod_{m \in \mscrK} X_m }
      = \\ &=
      \bigwedge_{k \in \mscrK} \bigwedge \set[\Big]{ \Bracks{\psi}_{v^k_{\xi \mapsto x_k}} \given* \seq{ x_m }_{m \in \mscrK} \in \prod_{m \in \mscrK} X_m }
      = \\ &=
      \bigwedge_{k \in \mscrK} \bigwedge \set[\Big]{ \Bracks{\psi}_{v^k_{\xi \mapsto x_k}} \given* x_k \in X_k }
      = \\ &=
      \bigwedge_{k \in \mscrK} \Bracks{\qforall \xi \psi}_{v_k}.
    \end{align*}

    \item Suppose that \( \varphi = \qexists \xi \psi \) and that the inductive hypothesis holds for \( \psi \). Fix an assignment \( v \).
    \begin{itemize}
      \item If \( \Bracks{\qexists \xi \psi}_v = T \), then there exists some tuple \( \seq{ a_k }_{k \in \mscrK} \) from \( \prod_{k \in \mscrK} X_k \) such that
      \begin{equation*}
        \Bracks{\psi}_{v_{\xi \to \seq{ a_k }_{k \in \mscrK}}} = T.
      \end{equation*}

      By the inductive hypothesis, the above is equal to
      \begin{equation*}
        \bigwedge_{k \in \mscrK} \Bracks{\psi}_{v^k_{\xi \to a_k}},
      \end{equation*}
      hence \( \Bracks{\psi}_{v^k_{\xi \mapsto a_k}} = T \) for every \( k \in \mscrK \).

      Thus, for every \( k \in \mscrK \),
      \begin{equation*}
        \Bracks{\qexists \xi \psi}_{v^k}
        =
        \bigvee_{x \in X_k} \Bracks{\psi}_{v^k_{\xi \mapsto x}}
        =
        T,
      \end{equation*}
      therefore
      \begin{equation*}
        \bigwedge_{k \in \mscrK} \Bracks{\qexists \xi \psi}_{v^k}
        =
        T
        =
        \Bracks{\qexists \xi \psi}_v.
      \end{equation*}

      \item If \( \Bracks{\qexists \xi \psi}_v = F \), then, for any tuple \( \seq{ x_k }_{k \in \mscrK} \) from \( \prod_{k \in \mscrK} X_k \) we have
      \begin{equation*}
        \Bracks{\psi}_{v_{\xi \to \seq{ x_k }_{k \in \mscrK}}} = F.
      \end{equation*}

      The inductive hypothesis implies that, for any tuple,
      \begin{equation*}
        \Bracks{\psi}_{v_{\xi \to \seq{ x_k }_{k \in \mscrK}}} = \bigwedge_{k \in \mscrK} \Bracks{\psi}_{v^k_{\xi \to x_k}}.
      \end{equation*}

      Hence, for each tuple \( \seq{ x_k }_{k \in \mscrK} \), there exists some index \( k_0 \) such that
      \begin{equation}\label{eq:thm:direct_product_preserves_positive_formulas/proof_existential}
        \Bracks{\psi}_{v^{k_0}_{\xi \to x_{k_0}}} = F.
      \end{equation}

      There must exist some index \( k_0 \) for which \eqref{eq:thm:direct_product_preserves_positive_formulas/proof_existential} holds whenever \( x_{k_0} \in X_{k_0} \). Otherwise, we could assemble a tuple contradicting \eqref{eq:thm:direct_product_preserves_positive_formulas/proof_existential}.

      Then
      \begin{equation*}
        \Bracks{\qexists \xi \psi}_{v^{k_0}}
        =
        \bigvee_{x \in X_{k_0}} \Bracks{\psi}_{v^{k_0}_{\xi \mapsto x}}
        =
        F,
      \end{equation*}
      therefore
      \begin{equation*}
        \bigwedge_{k \in \mscrK} \Bracks{\qexists \xi \psi}_{v^k}
        =
        F
        =
        \Bracks{\qexists \xi \psi}_v.
      \end{equation*}
    \end{itemize}
  \end{itemize}

  In all cases, for any variable assignment \( v \), \eqref{eq:thm:direct_product_preserves_positive_formulas/hypothesis_formulas} holds. Hence, if \( \Bracks{\varphi}_{v^k} = T \) for all \( k \in \mscrK \), then \( \Bracks{\varphi}_v = T \).

  Generalizing on \( v \), we conclude that \( \prod_{k \in \mscrK} \mscrX_k \) is a model of (the universal closure of) \( \varphi \) if, for every \( k \in \mscrK \), \( \mscrX_k \) is a model.
\end{proof}

\begin{example}\label{ex:def:first_order_direct_product}
  We list examples of \hyperref[def:first_order_direct_product]{first-order direct products}:
  \begin{thmenum}
    \thmitem{ex:def:first_order_direct_product/algebraic} Direct products for algebraic structures are simple --- there are no predicates, and \fullref{thm:direct_product_preserves_positive_formulas} is usually satisfied.

    This holds for:
    \begin{itemize}
      \item \hyperref[def:pointed_set]{Pointed sets}, \hyperref[def:set_with_involution]{sets with involutions}, \hyperref[def:pointed_set]{pointed sets}, \hyperref[def:semigroup]{semigroups}, \hyperref[def:monoid]{monoids}, \hyperref[def:group]{groups} and \hyperref[def:abelian_group]{abelian groups}.

      \item \hyperref[def:semiring]{Semirings}, \hyperref[def:semimodule]{semimodules} and \hyperref[def:algebra_over_semiring]{algebras over semirings}.

      \item \hyperref[def:ring]{Rings}, \hyperref[def:module]{modules} and \hyperref[def:algebra_over_ring]{algebras over rings}.
    \end{itemize}

    It fails, however, for \hyperref[def:integral_domain]{integral domains} --- in the product \( \BbbZ \times \BbbZ \), the element \( (n, 0) \) is a zero divisor for any integer \( n \). The reason for this is that the axiom ensuring \hyperref[def:entire_semiring]{entireness} is not positive, as well as the axiom \( \neq (0 \doteq 1) \) that excludes the \hyperref[def:ring/trivial]{trivial ring}.

    \thmitem{ex:def:first_order_direct_product/order} The direct product of the family of \hyperref[def:preordered_set]{preordered sets} \( \seq{ (P_k, \leq_k) }_{k \in \mscrK} \) is the first-order structure with domain
    \begin{equation*}
      P \coloneqq \prod_{k \in \mscrK} P_k
    \end{equation*}
    and predicate
    \begin{equation*}
      \seq{ x_k }_{k \in \mscrK} \leq \seq{ y_k }_{k \in \mscrK} \T{if and only if} \qforall{k \in \mscrK} x_k \leq_k y_k.
    \end{equation*}

    The axioms \eqref{eq:def:binary_relation/reflexive} for reflexivity and \eqref{eq:def:binary_relation/transitive} for transitivity are positive and have no disjunctions, thus the product \( (P, \leq) \) is also preordered as a consequence of \fullref{thm:direct_product_preserves_positive_formulas}.

    Furthermore, if \( \leq_k \) is a \hyperref[def:partially_ordered_set]{partial order} for every \( k \in \mscrK \), the product order \( \leq \) is also a partial order because the axiom \eqref{eq:def:binary_relation/antisymmetric} for antisymmetry also satisfies \fullref{thm:direct_product_preserves_positive_formulas}.

    On the other hand, the axiom \eqref{eq:def:binary_relation/connected} for connectedness has a disjunction, hence the direct product of totally ordered sets is not totally ordered.
  \end{thmenum}
\end{example}

\paragraph{First-order embeddings}

\begin{definition}\label{def:first_order_embedding}\mcite[def. 2.3.26(ii)]{Hinman2005}
  Let \( \mscrX = (X, I) \) and \( \mscrY = (Y, J) \) be structures over \( \mscrL \).

  We say that an \hyperref[def:function_invertibility/injective]{injective} \hyperref[def:first_order_homomorphism]{homomorphism} \( h: \mscrX \to \mscrY \) is an \term{embedding} if any of the following equivalent conditions hold:

  \begin{thmenum}
    \thmitem{def:first_order_embedding/inverse} The inverse of \( h \) on its image is also a homomorphism.
    \thmitem{def:first_order_embedding/predicates} For any predicate symbol \( p \) in \( \mscrL \),
    \begin{equation}\label{eq:def:first_order_embedding/predicates}
      I(p) (x_1, \ldots, x_n) = J(p) \parens[\Big]{ h(x_1), \ldots, h(x_n) }.
    \end{equation}
  \end{thmenum}
\end{definition}
\begin{comments}
  \item In particular, if there are no predicate symbols in the language, an embedding is simply an injective homomorphism.

  \item Peter Hinman in \incite[def. 2.3.26(ii)]{Hinman2005} actually defines embeddings as injective homomorphisms, but he requires homomorphisms to satisfy \eqref{eq:def:first_order_embedding/predicates} in \cite[def. 2.3.26(i)]{Hinman2005} --- a condition that is too restrictive for \hyperref[def:order_function]{order-preserving maps} or \hyperref[def:directed_graph/homomorphism]{graph homomorphisms}.

  \item \Fullref{ex:bijective_order_homomorphism_not_isomorphism} demonstrates how a bijective homomorphism may fail to be an isomorphism.
\end{comments}
\begin{defproof}
  Let \( h: \mscrX \to \mscrY \) be an injective homomorphism. We will denote by \( h^{-1} \) the \hyperref[def:set_valued_map/partial]{partial} \hyperref[def:set_valued_map/inverse]{inverse} of \( h \).

  Requiring \( h^{-1} \) to satisfy the condition \eqref{eq:def:first_order_embedding/predicates} on homomorphisms for predicate symbols is identical to requiring \( h \) (or \( h^{-1} \)) to satisfy the condition \eqref{eq:def:first_order_homomorphism/predicates} on embeddings.

  The condition on functional symbols is simpler to handle. We will show that \( h^{-1} \) always satisfies the condition \eqref{eq:def:first_order_homomorphism/functions} on homomorphisms for functional symbols.

  Fix an \( n \)-ary functional symbol \( f \) and a tuple \( y_1, \ldots, y_n \) of members of \( h(X) \). Then
  \begin{align*}
    h^{-1}\parens[\Big]{ J(f)(y_1, \ldots, y_n) }
    &=
    h^{-1}\parens[\Big]{ J(f)(h(h^{-1}(y_1)), \ldots, h(h^{-1}(y_n))) }
    \reloset {\eqref{eq:def:first_order_homomorphism/functions}} = \\ &=
    h^{-1}\parens[\Big]{ g^{-1}\parens[\Big]{ I(f) \parens[\Big]{ h^{-1}(y_1), \ldots, h^{-1}(y_n) } } }
    = \\ &=
    I(f) \parens[\Big]{ h^{-1}(y_1), \ldots, h^{-1}(y_n) }.
  \end{align*}
\end{defproof}

\begin{definition}\label{def:first_order_isomorphism}\mcite[def. 2.3.1(i)]{Hinman2005}
  If a \hyperref[def:first_order_embedding]{first-order embedding} is \hyperref[def:function_invertibility/surjective]{surjective}, we call it an \term{isomorphism} and say that the structures are \term{isomorphic}. In accordance with \fullref{def:morphism_invertibility/automorphism}, we call an isomorphism from a structure to itself an \term{automorphism}.
\end{definition}

\begin{remark}\label{rem:embeds_isomorphically}
  We sometimes refer to \hyperref[def:first_order_embedding]{first-order embeddings} as \enquote{isomorphic embeddings} to highlight that they are not merely an injective function.

  For example, we can say that \( \mscrY \) embeds isomorphically into \( \mscrX \).

  Similar terminology is used, among others, by \incite[100]{Enderton1977Sets}.
\end{remark}

\begin{example}\label{ex:bijective_order_homomorphism_not_isomorphism}
  Consider the \hyperref[def:integers]{set of integers} \( \BbbZ \) endowed with two different \hyperref[def:partially_ordered_set]{partial orders}:
  \begin{itemize}
    \item The standard total order \( \leq \) where \( n \leq m \) if there exists a nonnegative integer \( k \) such that \( n + k = m \).
    \item The equality relation \( = \).
  \end{itemize}

  The identity \( \id(x) = x \) is an \hyperref[def:order_function]{order homomorphisms} from \( (\BbbZ, =) \) to \( (\BbbZ, \leq) \). Indeed, for any integers \( n \) and \( m \), \( n = m \) implies \( n \leq m \).

  Furthermore, the identity function is bijective. The inverse of \( \id \), which is again \( \id \), is not however a homomorphism from \( (\BbbZ, \leq) \) to \( (\BbbZ, =) \) since, for example, \( 1 \leq 2 \), but \( 1 \neq 2 \).

  Hence, \( \id: (\BbbZ, =) \to (\BbbZ, \leq) \) is a bijective homomorphism, but not an isomorphism.
\end{example}

\begin{proposition}\label{thm:arbitrary_formulas_preserved_under_isomorphisms}
  A \hyperref[def:first_order_embedding]{first-order embeddings} preserves models of arbitrary closed formulas.

  More concretely, given some language \( \mscrL \), if \( \Gamma \) is a set of closed formulas and \( h: \mscrX \to \mscrY \) is an embedding between \hyperref[def:first_order_model]{models} of \( \Gamma \), then the image \( h[X] \) is also (the domain of) a model of \( \Gamma \).
\end{proposition}
\begin{comments}
  \item Compare this to \fullref{thm:positive_formulas_preserved_under_homomorphism}, which places restrictions on the formulas rather than the homomorphism.
  \item We say that embeddings preserve the validity arbitrary formulas.
\end{comments}
\begin{proof}
  The embedding condition allows us to extend the induction in our proof of \fullref{thm:arbitrary_formulas_preserved_under_isomorphisms} to the case of arbitrary formulas by instead requiring that \( \Bracks{\varphi}_v = \Bracks{\varphi}_w \) with the fixed variable assignments \( v \) and \( w \) from our proof of \fullref{thm:arbitrary_formulas_preserved_under_isomorphisms}.
\end{proof}

\begin{proposition}\label{thm:isomorphism_preserves_validity}\mcite[prop. 2.3.39]{Hinman2005}
  Let \( \mscrX = (X, I) \) and \( \mscrY = (Y, J) \) be structures over \( \mscrL \). Let \( h: \mscrX \to \mscrY \) be a \hyperref[def:first_order_isomorphism]{first-order isomorphism}. Fix a formula \( \varphi \) in \( \mscrL \) with (at most) \( n \) free variables. Then
  \begin{equation*}
    \Bracks{\varphi}_\mscrX(x_1, \ldots, x_n) = \Bracks{\varphi}_\mscrY\parens[\Big]{ h(x_1), \ldots, h(x_n) },
  \end{equation*}
  where \( \Bracks{\varphi} \) denotes the valuation function defined in \fullref{def:propositional_valuation/valuation_function}.
\end{proposition}
\begin{proof}
  We will show via \fullref{thm:induction_on_syntax_trees} that
  \begin{equation}\label{eq:thm:isomorphism_preserves_validity/hypothesis_formulas}
    \Bracks{\varphi}_v = \Bracks{\varphi}_w,
  \end{equation}
  where \( \varphi \) is a formula over \( \mscrL \), \( v \) is a variable assignment in \( \mscrX \) and \( w(\xi) \coloneqq h(v(\xi)) \) is an assignment in \( \mscrY \).

  Then it will follow that, if \( \xi_1, \ldots, \xi_n \) are all the free variables of \( \varphi \), the following restatement of the proposition holds:
  \begin{equation*}
    \Bracks{\varphi}_{v_{\xi_1 \mapsto x_1, \ldots, \xi_n \mapsto x_n}}
    =
    \Bracks{\varphi}_{w_{\xi_1 \mapsto h(x_1), \ldots, \xi_n \mapsto h(x_n)}}.
  \end{equation*}

  First, we will need to prove the following auxiliary result: for any term \( \tau \) over \( \mscrL \), we have
  \begin{equation}\label{eq:thm:isomorphism_preserves_validity/hypothesis_terms}
    \Bracks{\tau}_w = h(\Bracks{\tau}_v).
  \end{equation}

  \begin{itemize}
    \item If \( \tau \) is a variable, \eqref{eq:thm:isomorphism_preserves_validity/hypothesis_terms} is trivial.
    \item If \( \tau = f(\kappa_1, \ldots, \kappa_n) \) and if the inductive hypothesis holds for \( \kappa_1, \ldots, \kappa_n \), then
    \begin{align*}
      \Bracks{\tau}_w
      &=
      J(f)\parens[\Big]{ \Bracks{\kappa_1}_w, \ldots, \Bracks{\kappa_n}_w }
      \reloset {\T{ind.}} = \\ &=
      J(f)\parens[\Big]{ h(\Bracks{\kappa_1}_v), \ldots, h(\Bracks{\kappa_n}_v) }
      = \\ &=
      h\parens[\Big]{ I(f)\parens[\Big]{ \Bracks{\kappa_1}_v, \ldots, \Bracks{\kappa_n}_v } }
      = \\ &=
      h(\Bracks{\tau}_v).
    \end{align*}
  \end{itemize}

  Now we will perform induction on \( \varphi \):
  \begin{itemize}
    \item The case where \( \varphi \) is a constant is vacuous.
    \item If \( \varphi = \tau_1 \doteq \tau_2 \), then, since \( h \) is injective,
    \begin{equation*}
      \Bracks{\tau_1 \doteq \tau_2}_w = T
      \T{if and only if}
      \underbrace{\Bracks{\tau_1}_w}_{h(\Bracks{\tau_1}_v)} = \underbrace{\Bracks{\tau_2}_w}_{h(\Bracks{\tau_2}_v)}
      \T{if and only if}
      \Bracks{\tau_1 \doteq \tau_2}_v = T.
    \end{equation*}

    \item Suppose that \( \varphi = p(\tau_1, \ldots, \tau_n) \).
    \begin{itemize}
      \item If \( \Bracks{\varphi}_v = T \), we have
      \begin{equation*}
        \Bracks{\varphi}_w
        =
        J(p)\parens[\Big]{ \Bracks{\tau_n}_w, \ldots, \Bracks{\tau_n}_w }
        \reloset {\T{ind.}} =
        J(p)\parens[\Big]{ h(\Bracks{\tau_n}_v), \ldots, h(\Bracks{\tau_n}_v) }
        \reloset {\eqref{eq:def:first_order_homomorphism/predicates}} =
        T.
      \end{equation*}

      \item If \( \Bracks{\varphi}_v = F \), then \( \Bracks{\varphi}_w = F \) because \( h^{-1} \) is also a homomorphism and, by what we have already shown, \( \Bracks{\varphi}_w = T \) would imply \( \Bracks{\varphi}_v = T \).
    \end{itemize}

    \item If \( \varphi = \neg \psi \) and if the inductive hypothesis holds for \( \psi \), then
    \begin{equation*}
      \Bracks{\neg \psi}_v
      =
      \overline{\Bracks{\psi}_v}
      \reloset {\T{ind.}} =
      \overline{\Bracks{\psi}_w}
      =
      \Bracks{\neg \psi}_w.
    \end{equation*}

    \item If \( \varphi = \psi_1 \bincirc \psi_2 \), where \( \bincirc \in \set{ \vee, \wedge, \rightarrow, \leftrightarrow } \), and if the inductive hypothesis holds for \( \psi_1 \) and \( \psi_2 \), then
    \begin{equation*}
      \Bracks{\varphi}_v
      =
      \Bracks{\psi_1}_v \Bracks{\bincirc} \Bracks{\psi_2}_v
      \reloset {\T{ind.}} =
      \Bracks{\psi_1}_w \Bracks{\bincirc} \Bracks{\psi_2}_w
      =
      \Bracks{\varphi}_w
    \end{equation*}

    \item If \( \varphi = \qforall \xi \psi \) and if the inductive hypothesis holds for \( \psi \), then
    \begin{equation*}
      \Bracks{\varphi}_v
      =
      \bigwedge_{x \in X} \Bracks{\psi}_{v_{\xi \mapsto x}}
      \reloset {\T{ind.}} =
      \bigwedge_{x \in X} \Bracks{\psi}_{w_{\xi \mapsto h(x)}}
      =
      \bigwedge_{y \in Y} \Bracks{\psi}_{w_{\xi \mapsto y}}
      =
      \Bracks{\varphi}_w.
    \end{equation*}

    \item The case where \( \varphi = \qexists \xi \psi \) is similar.
  \end{itemize}
\end{proof}

\paragraph{First-order congruences}

\begin{definition}\label{def:first_order_congruence}\mcite[46]{Мальцев1970}
  Let \( \mscrX = (X, I) \) be a \hyperref[def:first_order_structure]{first-order structure} over some language.

  We say that the \hyperref[def:equivalence_relation]{equivalence relation} \( \cong \) on \( X \) is a (first-order) \term[ru=конгруэнция (\cite[46]{Мальцев1970})]{congruence} on \( \mscrX \) if any of the following equivalent conditions hold:
  \begin{thmenum}
    \thmitem{def:first_order_congruence/direct} For any \( n \)-ary functional symbol \( f \), from \( x_1 \cong x_1', \ldots, x_n \cong x_n' \) it follows that
    \begin{equation}\label{eq:def:first_order_congruence/direct}
      I(f)(x_1, \ldots, x_n) \cong I(f)(x_1', \ldots, x_n').
    \end{equation}

    \thmitem{def:first_order_congruence/substructure} The relation \( \cong \) is itself the domain of a substructure of the \hyperref[def:first_order_direct_product]{direct product} \( \mscrX^2 \).
  \end{thmenum}
\end{definition}
\begin{comments}
  \item Anatoly Maltsev gives this definition in \cite[46]{Мальцев1970}, but calls structures \enquote{algebraic systems} and studies them independently of first-order logic.
\end{comments}
\begin{defproof}
  \EquivalenceSubProof{def:first_order_congruence/direct}{def:first_order_congruence/substructure} Denote by \( K \) the interpretation in \( \mscrX^2 \). Note that
  \begin{equation*}
    K(f)\parens[\Big]{ (x_1, x_1'), \ldots, (x_n, x_n') }
    =
    \parens[\Big]{ I(f)(x_1, \ldots, x_n), I(f)(x_1', \ldots, x_n') }.
  \end{equation*}

  Therefore, if \( x_1 \cong x_1', \ldots, x_n \cong x_n' \), then
  \begin{equation*}
    K(f)\parens[\Big]{ (x_1, x_1'), \ldots, (x_n, x_n') } \in {\cong}
  \end{equation*}
  if and only if
  \begin{equation*}
    I(f)(x_1, \ldots, x_n) \cong I(f)(x_1', \ldots, x_n').
  \end{equation*}
\end{defproof}

\begin{proposition}\label{thm:homomorphism_induces_congruence}
  Every first-order homomorphism \( h: \mscrX \to \mscrY \) induces a \hyperref[def:first_order_congruence]{congruence} \( {\cong} \) on its domain \( \mscrX \) defined by putting \( x \cong x' \) if \( h(x) = h(x') \).
\end{proposition}
\begin{proof}
  The relation defined is obviously an equivalence relation. We will verify that it satisfies \eqref{eq:def:first_order_congruence/direct}.

  Fix an \( n \)-ary functional symbol \( f \) and \( n \) pairs of congruence elements \( x_1 \cong x_1', \ldots, x_n \cong x_n' \). Then
  \small
  \begin{equation*}
    \varphi\parens[\Big]{ I(f)(x_1, \ldots, x_n) }
    \reloset {\eqref{eq:def:first_order_homomorphism/functions}} =
    J(f)\parens[\Big]{ \underbrace{\varphi(x_1)}_{=\varphi(x_1')}, \ldots, \underbrace{\varphi(x_n)}_{=\varphi(x_n')} }
    =
    J(f)\parens[\Big]{ \varphi(x_1'), \ldots, \varphi(x_n') }
    \reloset {\eqref{eq:def:first_order_homomorphism/functions}} =
    \varphi\parens[\Big]{ I(f)(x_1', \ldots, x_n') }.
  \end{equation*}
  \normalsize

  Generalizing on \( f \), we conclude that \( {\cong} \) is a congruence relation.
\end{proof}

\begin{definition}\label{def:first_order_generated_congruence}\mimprovised
  Let \( \mscrX = (X, I) \) be a first-order structure. Given a binary relation \( {\sim} \) on \( X \), we define the \hyperref[def:first_order_congruence]{congruence} on \( \mscrX \) \term{generated} by \( {\sim} \) as the intersection of all congruences containing \( {\sim} \).

  \Fullref{thm:closure_operator_from_set_semilattice} implies that it is a \hyperref[def:moore_closure_operator]{Moore closure operator} on \( \pow(X^2) \).
\end{definition}
\begin{comments}
  \item In particular, as a consequence of \fullref{thm:closure_operator_minimality}, the generated congruence is the smallest congruence containing \( {\sim} \).
\end{comments}
\begin{defproof}
  Let \( \Omega \) be the family of all congruences on \( \mscrX \) containing \( {\sim} \).
  \begin{itemize}
    \item The intersection \( \bigcap \Omega \) is an equivalence relation as an intersection of equivalence relations.
    \item It is also (the domain of) a substructure of \( \mscrX^2 \) as implied by \fullref{thm:intersection_substructure}.
  \end{itemize}

  Hence, \( \bigcap \Omega \) is a congruence on \( \mscrX \).
\end{defproof}

\begin{proposition}\label{thm:congruences_form_complete_lattice}
  Fix a structure \( \mscrX = (X, I) \) for the language \( \mscrL \).

  With respect to set inclusion, the family of all \hyperref[def:first_order_congruence]{congruences} on \( \mscrX \) forms a complete lattice. Explicitly:
  \begin{thmenum}
    \thmitem{thm:congruences_form_complete_lattice/join} The \hyperref[def:lattice/join]{join} of the family of congruences \( \seq{ {\cong_k} }_{k \in \mscrK} \) is the \hyperref[def:first_order_generated_congruence]{generated congruence} of their union \( \bigcup_{k \in \mscrK} {\cong_k} \).

    \thmitem{thm:congruences_form_complete_lattice/top} The \hyperref[def:extremal_points/top_and_bottom]{top element} is the relation under which all elements of \( X \) are equivalent.

    \thmitem{thm:congruences_form_complete_lattice/meet} The \hyperref[def:lattice/meet]{meet} of the family of congruences \( \seq{ {\cong_k} }_{k \in \mscrK} \) is simply their intersection \( \bigcap_{k \in \mscrK} {\cong_k} \).

    \thmitem{thm:congruences_form_complete_lattice/bottom} The \hyperref[def:extremal_points/top_and_bottom]{bottom element} of this lattice is the equality relation.
  \end{thmenum}
\end{proposition}
\begin{proof}
  Trivial.
\end{proof}

\begin{definition}\label{def:first_order_quotient}\mcite[62]{Мальцев1970}
  Consider a \hyperref[def:first_order_congruence]{first-order congruence} \( \cong \) on \( \mscrX = (X, I) \) and the \hyperref[def:equivalence_relation/projection]{quotient map}
  \begin{equation*}
    \begin{aligned}
      &\pi: X \to X / {\cong}, \\
      &\pi(x) = [x].
    \end{aligned}
  \end{equation*}

  We define the following interpretation on the \hyperref[def:equivalence_relation/quotient]{quotient set} \( X / {\cong} \):
  \begin{thmenum}
    \thmitem{def:first_order_quotient/functions} For every functional symbol \( f \) of arity \( n \):
    \begin{equation}\label{eq:def:first_order_quotient/functions}
      I_\cong(f)\parens[\Big]{ [x_1], \ldots, [x_n] } \coloneqq [I(f)(x_1, \ldots, x_n)]
    \end{equation}

    \thmitem{def:first_order_quotient/predicates} For every predicate symbol \( p \) of arity \( n \):
    \begin{equation}\label{eq:def:first_order_quotient/predicates}
      I_\cong(p)\parens[\Big]{ [x_1], \ldots, [x_n] } \coloneqq \bigvee\set[\Big]{ I(p)(x_1', \ldots, x_n') \given* x_1' \in [x_1], \ldots, x_n' \in [x_n] }
    \end{equation}
  \end{thmenum}

  Then \( \mscrX / {\cong} \coloneqq (X / {\cong}, I_\cong) \) is a structure over the same language and, furthermore, the projection \( \pi \) is a \hyperref[def:first_order_homomorphism]{homomorphism}.
\end{definition}

\begin{theorem}[Quotient structure universal property]\label{thm:quotient_structure_universal_property}
  For every first-order structure \( \mscrX \) and every \hyperref[def:first_order_congruence]{congruence} \( \cong \) on \( \mscrX \), the \hyperref[def:first_order_quotient]{quotient structure} \( \mscrX / {\cong} \) has the following \hyperref[rem:universal_mapping_property]{universal mapping property}:
  \begin{displayquote}
    Every homomorphism \( h: \mscrX \to \mscrY \) for which \( x \cong x' \) implies \( h(x) = h(x') \) \hyperref[def:factors_through]{uniquely factors through} \( \mscrX / {\cong} \).

    More precisely, there exists a unique homomorphism \( \widetilde{h}: \mscrX / {\cong} \to \mscrY \), such that the following diagram commutes:
    \begin{equation}\label{eq:thm:quotient_structure_universal_property/diagram}
      \begin{aligned}
        \includegraphics[page=1]{output/thm__quotient_structure_universal_property}
      \end{aligned}
    \end{equation}
  \end{displayquote}
\end{theorem}
\begin{comments}
  \item For \hyperref[def:group]{groups}, this theorem can be restated via \hyperref[def:group/kernel]{kernels} and \hyperref[def:normal_subgroup]{normal subgroups}:
  \begin{displayquote}
    Given a normal subgroup \( N \) of \( G \), every homomorphism \( h: G \to H \) satisfying \( N \subseteq \ker h \) uniquely factors through \( G / N \).
  \end{displayquote}

  Similarly, when stated for \hyperref[def:ring]{rings} and \hyperref[def:algebra_over_ring]{algebras over rings}, the theorem uses \hyperref[def:ring/kernel]{kernels} and \hyperref[def:semiring_ideal]{ideals}:
  \begin{displayquote}
    Given an ideal \( I \) of \( R \), every homomorphism \( h: R \to T \) satisfying \( I \subseteq \ker h \) uniquely factors through \( R / I \).
  \end{displayquote}

  For \hyperref[def:module]{modules over rings}, it becomes particularly simple:
  \begin{displayquote}
    Given an \( R \)-submodule \( N \) of \( M \), every homomorphism \( h: M \to K \) satisfying \( N \subseteq \ker h \) uniquely factors through \( M / N \).
  \end{displayquote}
\end{comments}
\begin{proof}
  For any element \( x \) of \( \mscrX \), we want
  \begin{equation*}
    \widetilde{h}(\pi(x)) = h(x).
  \end{equation*}

  This condition can be used as a definition, but only in the case where \( h \) only depends on the equivalence class \( \pi(x) \), but not the representative. This is the reason we have the additional restriction that \( x \cong x' \) must imply \( h(x) = h(x') \).

  Uniqueness follows by construction.
\end{proof}

\begin{proposition}\label{thm:quotient_preserves_positive_formulas}
  Fix a set \( \Gamma \) of closed \hyperref[def:positive_formula]{positive formulas} over a language without predicate symbols.

  If \( \mscrX = (X, I) \) is a \hyperref[def:first_order_model]{model} of \( \Gamma \) and \( \cong \) is a \hyperref[def:first_order_congruence]{first-order congruence} on \( \mscrX \), then the \hyperref[def:first_order_quotient]{quotient structure} \( \mscrX / {\cong} \) defined as \( (X / {\cong}, I_\cong) \) is also a model of \( \Gamma \).
\end{proposition}
\begin{defproof}
  Fix a positive formula \( \varphi \). Via \fullref{thm:induction_on_syntax_trees}, we will show that if any variable assignment \( v \) satisfies \( \varphi \) in \( \mscrX \), the following variable assignment satisfies \( \varphi \) in \( \mscrX / {\cong} \):
  \begin{equation*}
    \begin{aligned}
      &v^{\cong}: \boldop{Var} \to X / {\cong}, \\
      &v^{\cong}(\xi) \coloneqq [v(\xi)].
    \end{aligned}
  \end{equation*}

  We start by noting that, for any term \( \tau \), we have
  \begin{equation}\label{eq:thm:quotient_preserves_positive_formulas/term_equality}
    \Bracks{\tau}_{v^{\cong}} = \bracks[\Big]{ \Bracks{\tau}_v }.
  \end{equation}

  This is obvious if \( \tau \) is a variable, and it follows directly from \eqref{eq:def:first_order_quotient/functions} if \( \tau \) is a function application.

  Now we will use induction on \( \varphi \) to show that, if \( v \) satisfies \( \varphi \), then so does \( w \).
  \begin{itemize}
    \item The validity of \( \varphi = \top \) is clear.
    \item If \( \varphi = \tau_1 \doteq \tau_2 \) and \( v \) satisfies \( \varphi \), then \( \Bracks{\tau_1}_v = \Bracks{\tau_2}_v \), implying that \( \Bracks{\tau_1}_{v^{\cong}} = \Bracks{\tau_2}_{v^{\cong}} \) and \( \Bracks{\varphi}_{v^{\cong}} = T \).

    \item If \( \varphi = \psi_1 \wedge \psi_2 \), if the inductive hypothesis holds for \( \psi_1 \) and \( \psi_2 \) and if \( v \) satisfies \( \varphi \), then
    \begin{equation*}
      T
      =
      \Bracks{\psi_1 \wedge \psi_2}_v
      =
      \Bracks{\psi_1}_v \Bracks{\wedge} \Bracks{\psi_2}_v.
    \end{equation*}

    Thus, we have
    \begin{equation*}
      \Bracks{\psi_1}_v = \Bracks{\psi_2}_v = T,
    \end{equation*}
    and the inductive hypothesis allows us to conclude that
    \begin{equation*}
      \Bracks{\psi_1}_{v^{\cong}} = \Bracks{\psi_2}_{v^{\cong}} = T.
    \end{equation*}

    Therefore,
    \begin{equation*}
      \Bracks{\psi_1 \wedge \psi_2}_{v^{\cong}}
      =
      \Bracks{\psi_1}_{v^{\cong}} \Bracks{\wedge} \Bracks{\psi_2}_{v^{\cong}}
      =
      T \Bracks{\wedge} T
      =
      T.
    \end{equation*}

    \item For the case \( \varphi = \psi_1 \vee \psi_2 \), we have two subcases:
    \begin{itemize}
      \item If \( \Bracks{\psi_1}_v = T \), then \( \Bracks{\psi_1}_{v^{\cong}} = T \) and thus
      \begin{equation*}
        \Bracks{\psi_1 \vee \psi_2}_{v^{\cong}}
        =
        \Bracks{\psi_1}_{v^{\cong}} \Bracks{\vee} \Bracks{\psi_2}_{v^{\cong}}
        =
        T \Bracks{\vee} \Bracks{\psi_2}_{v^{\cong}}
        =
        T.
      \end{equation*}

      \item If \( \Bracks{\psi_1}_v = F \), then necessarily \( \Bracks{\psi_2}_v = T \) because otherwise we would obtain
      \begin{equation*}
        T
        =
        \Bracks{\psi_1 \vee \psi_2}_v
        =
        \Bracks{\psi_1}_v \Bracks{\vee} \Bracks{\psi_2}_v
        =
        F \Bracks{\vee} F
        =
        F,
      \end{equation*}
      which is a contradiction.

      Thus, we have \( \Bracks{\psi_2}_{v^{\cong}} = T \), and we can conclude that
      \begin{equation*}
        \Bracks{\psi_1 \vee \psi_2}_{v^{\cong}}
        =
        \Bracks{\psi_1}_{v^{\cong}} \Bracks{\vee} \Bracks{\psi_2}_{v^{\cong}}
        =
        F \Bracks{\vee} T
        =
        T.
      \end{equation*}
    \end{itemize}

    \item Suppose that \( \varphi = \qexists \xi \psi \), that \( \psi \) satisfies the inductive hypothesis and that \( \Bracks{\varphi}_v = T \).

    We have
    \begin{equation*}
      T
      =
      \Bracks{ \qexists \xi \psi }_v
      =
      \bigvee\set[\Big]{ \Bracks{\psi}_{v_{\xi \to x}} \given* x \in X },
    \end{equation*}
    thus there exists some value \( x_0 \) such that \( \Bracks{\psi}_{\xi \to x_0} = T \).

    The inductive hypothesis implies that
    \begin{equation*}
      \Bracks{\psi}_{v_{\xi \to x_0}^{\cong}}
      =
      \Bracks{\psi}_{v_{\xi \to x_0}}
      =
      T.
    \end{equation*}

    But
    \begin{equation*}
      v_{\xi \to x_0}^{\cong}
      =
      v^{\cong}_{\xi \to [x_0]}(\eta)
      =
      \begin{cases}
        [x_0],           &\eta = \xi, \\
        v^{\cong}(\eta), &\T{otherwise,}
      \end{cases}
    \end{equation*}
    hence
    \begin{equation*}
      \Bracks{\psi}_{v^{\cong}_{\xi \to [x_0]}}
      =
      T
    \end{equation*}
    and
    \begin{equation*}
      \Bracks{ \qexists \xi \psi }_{v^{\cong}}
      =
      \bigvee\set[\Big]{ \Bracks{\psi}_{v^{\cong}_{\xi \to [x]}} \given*{} [x] \in X / {\cong} }
      =
      \Bracks{\psi}_{v^{\cong}_{\xi \to [x_0]}}
      =
      T.
    \end{equation*}

    \item If \( \varphi = \qforall \xi \psi \), we instead take an arbitrary value \( [x] \) of \( X / {\cong} \) and use that
    \begin{equation*}
      \Bracks{\psi}_{v^{\cong}_{\xi \to [x]}}
      =
      \Bracks{\psi}_{v_{\xi \to x}^{\cong}}
      =
      T.
    \end{equation*}

    Generalizing on \( [x] \), we obtain
    \begin{equation*}
      \Bracks{ \qforall \xi \psi }_{v^{\cong}}
      =
      \bigwedge\set[\Big]{ \Bracks{\psi}_{v^{\cong}_{\xi \to [x]}} \given*{} [x] \in X }
      =
      \bigwedge\set[\Big]{ T \given*{} [x] \in X }
      =
      T.
    \end{equation*}
  \end{itemize}

  In all cases of the induction, we have shown that variable assignments in \( \mscrX \) that satisfy \( \varphi \) correspond to variable assignments in \( \mscrX / {\cong} \) that satisfy \( \varphi \). Generalizing on both \( \varphi \) and \( v \), we conclude that the proposition holds.
\end{defproof}

\begin{theorem}[Lattice theorem for substructures]\label{thm:lattice_theorem_for_substructures}
  Let \( \mscrX = (X, I) \) be a \hyperref[def:first_order_structure]{structure} over \hyperref[def:first_order_language]{first-order language} \( \mscrL \) and let \( {\cong} \) be a \hyperref[def:first_order_congruence]{congruence} on \( \mscrX \).

  We will consider only \hyperref[def:first_order_substructure]{substructures} \( (S, I) \) of \( (X, I) \) satisfying the following compatibility condition:
  \begin{equation}\label{eq:thm:lattice_theorem_for_substructures/compatibility}
    \T{If} x \in S \T{and} x \cong x', \T{then} x' \in S.
  \end{equation}

  This condition ensures that every equivalence classes of the quotient set \( S / {\cong} \) is also an element of \( X / {\cong} \).

  We will give a verbose formulation as a buildup for \fullref{thm:lattice_theorem_for_substructures/isomorphism}; the theorem is summarized in \ref{fig:thm:lattice_theorem_for_substructures}.

  \begin{figure}[!ht]
    \centering
    \includegraphics[page=1]{output/thm__lattice_theorem_for_substructures}
    \caption{The lattices from \fullref{thm:lattice_theorem_for_substructures}.}
    \label{fig:thm:lattice_theorem_for_substructures}
  \end{figure}

  \begin{thmenum}
    \thmitem{thm:lattice_theorem_for_substructures/direct} If \( (S, I) \) is a substructure of \( (X, I) \) compatible with \( {\cong} \), then \( (S / {\cong}, I_\cong) \) is a substructure of \( (X / {\cong}, I_\cong) \), that is, a structure for \( \mscrL \) satisfying \( S / {\cong} \subseteq X / {\cong} \).

    We know that \( (S, I) \) has a quotient structure with respect to \( {\cong} \), but the interpretation is in general different from \( I_\cong \).

    \thmitem{thm:lattice_theorem_for_substructures/reverse} If \( (Q, I_\cong) \) is a substructure of \( (X / {\cong}, I_\cong) \), then \( (\bigcup Q, I) \) is a substructure of \( (X, I) \) compatible with \( {\cong} \), that is, a structure over \( \mscrL \) satisfying \( \bigcup Q \subseteq X \) and \eqref{eq:thm:lattice_theorem_for_substructures/compatibility}.

    \thmitem{thm:lattice_theorem_for_substructures/left_invertible} If \( (S, I) \) is a substructure of \( (X, I) \) compatible with \( {\cong} \), then the sets \( S \) and \( \bigcup (S / {\cong}) \) coincide.

    \thmitem{thm:lattice_theorem_for_substructures/right_invertible} If \( (Q, I_\cong) \) is a substructure of \( (X / {\cong}, I_\cong) \), then the sets \( Q \) and \( (\bigcup Q) / {\cong} \) coincide.

    \thmitem{thm:lattice_theorem_for_substructures/direct_order} Taking congruence is \hyperref[def:order_function/preserving]{order-preserving}: if \( S \subseteq T \subseteq X \) and if both \( (S, I) \) and \( (T, I) \) are substructures of \( (X, I) \) compatible with \( {\cong} \), then \( (T / {\cong}, I_\cong) \) is a substructure of \( (S / {\cong}, I_\cong) \).

    \thmitem{thm:lattice_theorem_for_substructures/reverse_order} Similarly, if \( R \subseteq Q \subseteq X / {\cong} \) and if both \( (R, I_\cong) \) and \( (Q, I_\cong) \) are substructures of \( (X / {\cong}, I_\cong) \), then \( (\bigcup R, I) \) is a substructure of \( (\bigcup Q, I_\cong) \).

    \thmitem{thm:lattice_theorem_for_substructures/src_complete_lattice} The family of all substructures of \( (X, I) \) compatible with \( {\cong} \) is a \hyperref[def:lattice]{complete lattice} with respect to the substructure relation.

    In general, the join operation is incompatible with the one from the \hyperref[thm:substructures_form_complete_lattice]{substructure lattice}.

    \thmitem{thm:lattice_theorem_for_substructures/dest_complete_lattice} The family of all substructures of \( (X / {\cong}, I_\cong) \) is a \hyperref[def:lattice]{complete lattice} with respect to the substructure relation.

    This is precisely the \hyperref[thm:substructures_form_complete_lattice]{substructure lattice} of \( (X / {\cong}, I_\cong) \).

    \thmitem{thm:lattice_theorem_for_substructures/isomorphism} The map \( (S, I) \mapsto (S / {\cong}, I_\cong) \) is an isomorphism between the (complete) lattice of all substructures of \( (X, I) \) compatible with \( {\cong} \) and the lattice of all substructures of \( (X / {\cong}, I_\cong) \).
  \end{thmenum}
\end{theorem}
\begin{comments}
  \item Simpler forms of this theorem hold in some special cases --- see \fullref{thm:lattice_theorem_for_subgroups}, \fullref{thm:lattice_theorem_for_ideals} and especially \fullref{thm:lattice_theorem_for_submodules}.
\end{comments}
\begin{proof}
  \SubProofOf{thm:lattice_theorem_for_substructures/direct} Let \( (S, I) \) be a substructure of \( (X, I) \). In order to show that \( (S / {\cong}, I_\cong) \) is a substructure of \( (X / {\cong}, I_\cong) \), we must show that the set \( S / {\cong} \) is closed under function application.

  Let \( f \) be an \( n \)-ary functional symbol from \( \mscrL \). If \( [x_1], \ldots, [x_n] \) are members of \( S / {\cong} \), then \( x_1, \ldots, x_n \) are members of \( S \). Since \( S \) is closed under function application, it contains
  \begin{equation*}
    I(f)(x_1, \ldots, x_n).
  \end{equation*}

  Thus, \( S / {\cong} \) contains
  \begin{equation*}
    I_\cong(f)\parens{ [x_1], \ldots, [x_n] }
    =
    [I(f)(x_1, \ldots, x_n)].
  \end{equation*}

  Therefore, \( S / {\cong} \) is closed under function application.

  \SubProofOf{thm:lattice_theorem_for_substructures/reverse} Let \( (Q, I_\cong) \) be a substructure of \( (X / {\cong}, I_\cong) \). We must show that the set \( \bigcup Q \) is closed under function application.

  Again, let \( f \) be an \( n \)-ary functional symbol from \( \mscrL \). If \( x_1, \ldots, x_n \) are members of \( \bigcup Q \), then the cosets \( [x_1], \ldots, [x_n] \) belong to \( Q \) and since \( Q \) is closed under application of \( I_\cong(f) \), it contains
  \begin{equation*}
    I_\cong(f)\parens{ [x_1], \ldots, [x_n] }
    =
    [I(f)(x_1, \ldots, x_n)].
  \end{equation*}

  The union \( \bigcup Q \) satisfies the compatibility condition \eqref{eq:thm:lattice_theorem_for_substructures/compatibility} because it contains the entire equivalence classes. In particular, \( \bigcup Q \) contains \( I(f)(x_1, \ldots, x_n) \) itself.

  Therefore, \( \bigcup Q \) is closed under function application and \( (\bigcup Q, I) \) is a substructure of \( (X, I) \) compatible with \( {\cong} \).

  \SubProofOf{thm:lattice_theorem_for_substructures/left_invertible} Let \( (S, I) \) be a substructure of \( (X, I) \) compatible with \( {\cong} \). We will show that the sets \( S \) and \( \bigcup(S / {\cong}) \) coincide.

  In one direction, if \( s \in S \), then \( [s] \in S / {\cong} \) and thus \( s \in [s] \subseteq \bigcup (S / {\cong}) \).

  In the other direction, if \( s \in \bigcup (S / {\cong}) \), then \( [s] \in S / {\cong} \) and there exists some \( s' \) congruent to \( s \) that belongs to \( S \). The compatibility condition \eqref{eq:thm:lattice_theorem_for_substructures/compatibility} ensures that \( s \) itself belongs to \( S \).

  Therefore, \( S = \bigcup(S / {\cong}) \).

  \SubProofOf{thm:lattice_theorem_for_substructures/right_invertible} Let \( (Q, I_\cong) \) be a substructure of \( (X / {\cong}, I_\cong) \). We will show that the sets \( Q \) and \( (\bigcup Q) / {\cong} \) coincide.

  In one direction, if \( [q] \in Q \), then \( q \in \bigcup Q \) and, since we have shown in \fullref{thm:lattice_theorem_for_substructures/reverse} that \( (\bigcup Q, I) \) is a structure satisfying the compatibility condition \eqref{eq:thm:lattice_theorem_for_substructures/compatibility}, we conclude that \( [q] \in (\bigcup Q) / {\cong} \).

  In the other direction, if \( [q] \in (\bigcup Q) / {\cong} \), then \( q \in \bigcup Q \) and thus its coset \( [q] \) belongs to \( Q \).

  \SubProofOf{thm:lattice_theorem_for_substructures/direct_order} Let \( (S, I) \) and \( (T, I) \) be substructures of \( (X, I) \) compatible with \( {\cong} \) and suppose that \( T \subseteq S \).

  Every member \( t \) of \( T \) is also a member of \( S \), hence compatibility ensures that \( [t] \) is a member of \( S / {\cong} \).

  Therefore, \( T / {\cong} \) is a subset \( S / {\cong} \). \Fullref{thm:lattice_theorem_for_substructures/direct} ensures that both are substructures of \( (X, I) \) and \fullref{thm:substructure_relation_is_transitive} ensures that \( (T / {\cong}, I_\cong) \) is a substructure of \( (S / {\cong}, I_\cong) \).

  \SubProofOf{thm:lattice_theorem_for_substructures/reverse_order} Analogous.

  \SubProofOf{thm:lattice_theorem_for_substructures/src_complete_lattice} Let \( \seq{ (S_k, I) }_{k \in \mscrK} \) be a nonempty family of substructures of \( (X, I) \) compatible with \( {\cong} \).

  It is clear that their \hyperref[thm:intersection_substructure]{intersection structure} \( (\bigcap_{k \in \mscrK} S_k, I) \) is also a substructure of \( (X, I) \) compatible with \( {\cong} \). Then this is their infimum, that is, meet.

  Furthermore, \fullref{thm:closure_operator_from_set_semilattice} shows that the following is a \hyperref[def:moore_closure_operator]{Moore closure operator}:
  \begin{equation*}
    \begin{aligned}
      &\cl^\cong: \pow(X) \to \pow(X), \\
      &\cl^\cong(A) \coloneqq \bigcap \set{ S \subseteq X \given (S, I) \T{is a substructure of} (X, I) \T{compatible with} {\cong} }.
    \end{aligned}
  \end{equation*}

  Then we can define the supremum of the family \( \seq{ (S_k, I) }_{k \in \mscrK} \) as the structure
  \begin{equation*}
    \parens[\Bigg]{ \cl^\cong \parens[\Bigg]{ \bigcup_{k \in \mscrK} S_k }, I }.
  \end{equation*}

  From \fullref{thm:closure_operator_minimality} it follows that this is indeed the smallest suitable substructure.

  Therefore, arbitrary families of substructures compatible with \( {\cong} \) have both joins and meets, implying that the family of all such substructures is a complete lattice.

  \SubProofOf{thm:lattice_theorem_for_substructures/dest_complete_lattice} Trivial.

  \SubProofOf{thm:lattice_theorem_for_substructures/isomorphism} The map \( (S, I) \mapsto (S / {\cong}, I_\cong) \) is left invertible as per \fullref{thm:lattice_theorem_for_substructures/left_invertible} and right invertible as per \fullref{thm:lattice_theorem_for_substructures/right_invertible}. It is also order-preserving as per \fullref{thm:lattice_theorem_for_substructures/direct_order}, and is order-reflecting as per \fullref{thm:lattice_theorem_for_substructures/reverse_order}.

  Then \fullref{thm:def:complete_lattice/embedding} is satisfied, implying that the aforementioned map is an isomorphism of complete lattices.
\end{proof}

\paragraph{First-order definability}

\begin{definition}\label{def:first_order_definability}\mcite[def. 2.3.37]{Hinman2005}
  Fix a \hyperref[def:first_order_language]{first-order language} \( \mscrL \) and a \hyperref[def:first_order_structure]{structure} \( \mscrX = (X, I) \) for \( \mscrL \).

  To every \hyperref[def:first_order_syntax/formula]{formula} \( \varphi \) whose \hyperref[def:first_order_syntax/formula_free_variables]{free variables} are among \( \xi_1, \ldots, \xi_n, \eta_1, \ldots, \eta_m \), and to every \( m \)-tuple \( u_1, \ldots, u_m \) of members of \( A \), which we call \term{parameters}, there corresponds a set \( A \subseteq X^n \) such that
  \begin{equation*}
    (x_1, \ldots, x_n) \in A \T{if and only if} \Bracks{\varphi}(x_1, \ldots, x_n, u_1, \ldots, u_m) = T,
  \end{equation*}
  where \( \Bracks{\varphi} \) denotes the valuation function defined in \fullref{def:propositional_valuation/valuation_function}.

  We say that \( \varphi \) \term{defines} \( A \) with parameters \( u_1, \ldots, u_m \). An arbitrary set \( A \subseteq X^n \) is \term{definable} with parameters \( u_1, \ldots, u_m \) if there exists a formula \( \varphi \) that defines \( A \), or simply \enquote{definable} if it is definable without parameters.
\end{definition}
\begin{comments}
  \item See \fullref{def:set_builder_notation} and \fullref{thm:cumulative_hierarchy_model_of_zfc} for how this concept deeply relates to set theory.
\end{comments}

\begin{proposition}\label{thm:automorphism_of_definable_set}
  Let \( \mscrX = (X, I) \) be a structure over some language \( \mscrL \).

  \begin{thmenum}
    \thmitem{thm:automorphism_of_definable_set/direct}\mcite[corr. 2.3.40]{Hinman2005} If the set \( A \subseteq X \) is \hyperref[def:first_order_definability]{definable} (without parameters) and if \( h: \mscrX \to \mscrX \) is an automorphism, then \( h(A) = A \).

    \thmitem{thm:automorphism_of_definable_set/contrapositive} If for some automorphism \( h: X \to X \) we have \( h(A) \neq A \), then the set \( A \subseteq X \) is not definable.
  \end{thmenum}
\end{proposition}
\begin{proof}
  \SubProofOf{thm:automorphism_of_definable_set/direct} If \( A \) is definable via \( \varphi \), then \fullref{thm:isomorphism_preserves_validity} implies that,if \( (x_1, \ldots, x_n) \in A \), then
  \begin{equation*}
    \Bracks{\varphi}_\mscrX\parens[\Big]{ h(x_1), \ldots, h(x_n) } = \Bracks{\varphi}_\mscrX(x_1, \ldots, x_n) = T,
  \end{equation*}
  which in turn implies
  \begin{equation*}
    \parens[\Big]{ h(x_1), \ldots, h(x_n) } \in A.
  \end{equation*}

  Thus, \( A = h(A) \).

  \SubProofOf{thm:automorphism_of_definable_set/contrapositive} This is the contrapositive of \fullref{thm:automorphism_of_definable_set/direct}.
\end{proof}
