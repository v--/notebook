\section{Enumerative combinatorics}\label{sec:enumerative_combinatorics}

\paragraph{Cardinality arithmetic}

\begin{theorem}[Cardinality sum rule]\label{thm:cardinality_sum_rule}
  The \hyperref[thm:cardinality_existence]{cardinality} of the union of finitely many \hi{\hyperref[def:subset_ordering]{disjoint}} \hyperref[def:set]{sets} is the sum of their individual cardinalities.
\end{theorem}
\begin{comments}
  \item Although this result is elementary, it is ubiquitous and giving it a name helps to justify steps in proofs whose justification may otherwise be unclear. See, for example, our proof of \fullref{thm:roots_of_unity_cyclic_group}.

  \item The generalization of this property is called \hyperref[def:boolean_algebra_additive_function/finite]{finite additivity}, and is required to hold for all \hyperref[def:measure]{measures}. In particular, it holds for the \hyperref[def:counting_measure]{counting measure}, which is also based on cardinalities.

  \item If the sets are not disjoint (but are finite), we can instead use \fullref{thm:inclusion_exclusion_principle}.
\end{comments}
\begin{proof}
  Fix a family \( A_1, \ldots, A_n \) of disjoint sets. We will use induction on \( n \). The base case \( n = 0 \) is vacuous, so suppose that the rule holds for families of \( n - 1 \) sets. Then
  \begin{equation*}
    \sum_{k=1}^n \card A_k
    =
    \sum_{k=1}^{n-1} \card A_k + \card A_n
    \reloset {\T{ind.}} =
    \card\parens[\Big]{ \bigcup_{k=1}^{n-1} A_k } + \card A_n.
  \end{equation*}

  Denote the union \( \bigcup_{k=1}^{n-1} A_k \) by \( B \). \Fullref{def:cardinal_arithmetic/addition} defines the sum above as the cardinality of the disjoint union \( B \amalg A_n \). However, since \( B \) and \( A_n \) are disjoint, \fullref{thm:disjoint_union_of_disjoint_sets} implies that \( B \amalg A_n \) is equinumerous with \( B \cup A_n \). Therefore, as desired,
  \begin{equation*}
    \sum_{k=1}^n \card A_k = \card\parens[\Big]{ \bigcup_{k=1}^n A_k }.
  \end{equation*}
\end{proof}

\begin{theorem}[Cardinality product rule]\label{thm:cardinality_product_rule}
  The \hyperref[thm:cardinality_existence]{cardinality} of the \hyperref[def:cartesian_product]{Cartesian product} of finitely many sets is the product of their individual cardinalities.
\end{theorem}
\begin{proof}
  \Fullref{def:cardinal_arithmetic/multiplication} defines the product of two cardinal numbers as the cardinality of their Cartesian product. The proposition follows by induction similarly to \fullref{thm:cardinality_sum_rule}.
\end{proof}

\paragraph{Inclusion-exclusion principle}

\begin{theorem}[Binary inclusion-exclusion principle]\label{thm:binary_inclusion_exclusion_principle}
  For any two sets \( A \) and \( B \) we have
  \begin{equation}\label{eq:thm:binary_inclusion_exclusion_principle/general}
    \card(A \cup B) + \card(A \cap B) = \card(A) + \card(B).
  \end{equation}

  If both are finite, then
  \begin{equation}\label{eq:thm:binary_inclusion_exclusion_principle/finite}
    \card(A \cup B) = \card(A) + \card(B) - \card(A \cap B).
  \end{equation}
\end{theorem}
\begin{proof}
  Consider the disjoint union
  \begin{equation*}
    U \coloneqq (A \cup B) \amalg (A \cap B)
  \end{equation*}
  and the (injective) functions
  \begin{equation*}
    \begin{aligned}
      &f_A: A \to U, \\
      &f_A(x) \coloneqq \iota_{A \cup B}(x).
    \end{aligned}
  \end{equation*}
  and
  \begin{equation*}
    \begin{aligned}
      &f_B: B \to U, \\
      &f_B(x) \coloneqq \begin{cases}
        \iota_{A \cap B}(x), &x \in A, \\
        \iota_{A \cup B}(x), &x \not\in A.
      \end{cases}
    \end{aligned}
  \end{equation*}

  \begin{figure}[!ht]
    \centering
    \includegraphics[align=c]{output/thm__binary_inclusion_exclusion_principle}
    \caption{The functions from our proof of \fullref{thm:binary_inclusion_exclusion_principle}}\label{fig:thm:binary_inclusion_exclusion_principle}
  \end{figure}

  We can now easily combine \( f_A \) and \( f_B \) into a bijective function from \( A \amalg B \) to \( U \), thus
  \begin{equation*}
    \card(A \amalg B) = \card(U).
  \end{equation*}

  As per our definition of cardinal addition in \fullref{def:cardinal_arithmetic/addition}, the cardinality of a disjoint union is the sum of the individual cardinalities; thus, \eqref{eq:thm:binary_inclusion_exclusion_principle/general} follows.
\end{proof}

\begin{theorem}[Inclusion-exclusion principle]\label{thm:inclusion_exclusion_principle}
  Fix a nonempty \( \Omega \) and consider a \hyperref[def:measure/positive]{finitely-additive positive measure} \( \mu \) on an \hyperref[def:algebra_of_subsets]{algebra of subsets} \( \mscrA \) of \( \Omega \). As usually stated, the principle applies to the \hyperref[def:counting_measure]{counting measure} on \( \Omega \).

  For every finite family \( A_1, \ldots, A_n \) in \( \mscrA \) of sets of finite measure, we have
  \begin{equation}\label{eq:thm:inclusion_exclusion_principle}
    \mu(A_1 \cup \cdots \cup A_n) = \sum_{k=1}^n (-1)^{k - 1} \sum_{\mathclap{i_1 < \cdots < i_k}} \mu(A_{i_1} \cap \cdots \cap A_{i_k}).
  \end{equation}
\end{theorem}
\begin{comments}
  \item We can generally regard \fullref{thm:binary_inclusion_exclusion_principle} as a special case, however it also handles the case of infinite sets.

  \item \Fullref{thm:inclusion_exclusion_eratosthenes} and \fullref{thm:totient_function_product_formula} are corollaries of this principle.

  \item \incite*[195]{Stanley2012EnumCombinatoricsVol1} uses a linear-algebraic generalization of this theorem to handle integer-valued functions other than the cardinality. Our statement makes use only of the finite additivity of \( \mu \).
\end{comments}
\begin{proof}
  We will use induction on \( n \). The base case \( n = 1 \) is trivial. Suppose \eqref{eq:thm:inclusion_exclusion_principle} holds for all families of \( n \) sets of finite measure. For the family \( A_1, \ldots, A_n, A_{n+1} \) we thus have
  \begin{align*}
    &\phantom{{}={}}
    \mu(A_1 \cup \cdots \cup A_n)
    = \\ &=
    \mu\parens[\Big]{ (A_1 \setminus A_{n+1}) \cup \cdots \cup (A_n \setminus A_{n+1}) \cup A_{n+1} }
    \reloset {\eqref{eq:def:boolean_algebra_additive_function/finite}} = \\ &=
    \mu\parens[\Big]{ (A_1 \setminus A_{n+1}) \cup \cdots \cup (A_n \setminus A_{n+1}) } + \mu(A_{n+1})
    \reloset {\T{ind.}} = \\ &=
    \sum_{k=1}^n (-1)^{k - 1} \sum_{\mathclap{i_1 < \cdots < i_k \leq n}} \mu( (A_{i_1} \cap \cdots \cap A_{i_k}) \setminus A_{n+1}) + \mu(A_{n+1})
    \reloset {\eqref{eq:def:boolean_algebra_additive_function/finite}} = \\ &=
    \sum_{k=1}^n (-1)^{k - 1} \sum_{\mathclap{i_1 < \cdots < i_k \leq n}} \parens[\Big]{ \mu(A_{i_1} \cap \cdots \cap A_{i_k}) - \mu(A_{i_1} \cap \cdots \cap A_{i_k} \cap A_{n+1}) } + \mu(A_{n+1})
    = \\ &=
    \sum_{k=1}^{n + 1} (-1)^{k - 1} \sum_{\mathclap{i_1 < \cdots < i_k \leq n + 1}} \mu(A_{i_1} \cap \cdots \cap A_{i_k}).
  \end{align*}
\end{proof}

\paragraph{Pigeonhole principle}

\begin{concept}\label{con:pigeonhole_principle}
  The \enquote{Pigeonhole principle} refers to the following observation:
  \begin{displayquote}
    If we are given more pigeons than pigeonholes, then at least one pigeonhole must contain multiple pigeons in it.
  \end{displayquote}

  \incite*[sec. 6.2]{Rosen2019DiscreteMathematics} dedicates entire sections to nontrivial applications of this principle.

  The Pigeonhole principle is attributed to Dirichlet, and variations of it are stated in the literature under different names:
  \begin{itemize}
    \item The \enquote{pigeonhole principle} is used, among others, by \incite[289]{Knuth1997ArtVol2}, \incite[sec. 6.2]{Rosen2019DiscreteMathematics}, \incite[66]{HopcroftEtAl2001Computability}, \incite[exerc. A-4.1]{Rotman2015AlgebraPart1}, \incite[134]{Enderton1977Sets} and \incite[16]{Savage2008Computability}.
    \item The \enquote{drawer principle} is used by \incite[222]{Арнольд2014ОДУ} (as \enquote{принцип ящиков Дирихле}), Goncharov in \cite[156]{АлександровМаркушевичХинчин1952ЭнциклопедияТом3} (as \enquote{принцип Дирихле}), \incite[224]{Проданов1982ФункАнализЧаст1} (as \enquote{принцип за чекмеджетата}).
    \item \enquote{Dirichlet's principle} is used by \incite[64]{Гуров2013Решётки} (as \enquote{принцип Дирихле}), \incite[9]{Мирчев2001Графи} (as \enquote{принцип на Дирихле}).
  \end{itemize}
\end{concept}

\begin{theorem}[Dirichlet's pigeonhole principle]\label{thm:pigeonhole_principle}
  We give several statements of the \hyperref[con:pigeonhole_principle]{pigeonhole principle} in a differing levels of generality.

  \begin{thmenum}
    \thmitem{thm:pigeonhole_principle/simple} For every function \( f: A \to B \), if \( A \) has greater cardinality, at least two members of \( A \) map to the same value in \( B \).

    \thmitem{thm:pigeonhole_principle/general} For every function \( f: A \to B \) we have
    \begin{equation}\label{eq:thm:pigeonhole_principle/general}
      \sup\set[\Big]{ \card(f^{-1}(b)) \given* b \in B } \cdot \card(\img f) \geq \card(A).
    \end{equation}

    The supremum in \eqref{eq:thm:pigeonhole_principle/general} is \( 0 \) in case \( B \) is empty.

    \thmitem{thm:pigeonhole_principle/finitary} Fix nonempty \hi{finite} sets \( A \) with \( n \) elements and \( B \) with \( m \) elements. For every function \( f: A \to B \) between them, there exists some element \( b \) in \( B \) such that \( f(a) = b \) for at least \( n / m \) elements \( a \) of \( A \).

    \thmitem{thm:pigeonhole_principle/infinitary} Fix two sets \( A \) and \( B \) such that \( A \) is infinite and \( \card(A) > \card(B) \). Then, for every function \( f: A \to B \), we have
    \begin{equation}\label{eq:thm:pigeonhole_principle/infinitary}
      \sup\set[\Big]{ \card(f^{-1}(b)) \given* b \in B } = \card(A).
    \end{equation}

    In particular, if the supremum above is attained for \( b_0 \), then \( f^{-1}(b_0) \) and \( A \) are equinumerous.
  \end{thmenum}
\end{theorem}
\begin{proof}
  \SubProofOf{thm:pigeonhole_principle/simple} It is sufficient to show that \( f: A \to B \) cannot be injective if \( \card(A) > \card(B) \). This follows easily from \fullref{thm:set_domination_relation_trichotomy}.

  \SubProofOf{thm:pigeonhole_principle/general} Denote by \( \mu \) the supremum in \eqref{eq:thm:pigeonhole_principle/general}.

  For every \( b \) in \( B \), since \( \card(f^{-1}(b)) \leq \mu \) there exists an injective function
  \begin{equation*}
    m_b: f^{-1}(b) \to \mu
  \end{equation*}

  Then we can define
  \begin{equation*}
    \begin{aligned}
      &g: A \to \mu \times \img f, \\
      &g(a) \coloneqq (m_b(a), f(a)).
    \end{aligned}
  \end{equation*}

  It is injective by construction, hence
  \begin{equation*}
    \card(A) \leq \card(\mu \times \img f) = \mu \cdot \card(\img f).
  \end{equation*}

  \SubProofOf{thm:pigeonhole_principle/finitary} \Fullref{thm:pigeonhole_principle/general} implies that
  \begin{equation*}
    \max\set[\Big]{ \card(f^{-1}(b)) \given* b \in B } \geq \frac n m.
  \end{equation*}

  Since \( B \) is finite, there exists a member attaining the maximum above.

  \SubProofOf{thm:pigeonhole_principle/infinitary} Again denote by \( \mu \) the supremum in \eqref{eq:thm:pigeonhole_principle/general}. Then
  \begin{equation*}
    \mu \cdot \card(\img f) \geq \card(A).
  \end{equation*}

  \Fullref{thm:simplified_cardinal_arithmetic/infinite} implies that
  \begin{equation*}
    \mu \cdot \card(\img f) = \max\set{ \mu, \card(\img f) }.
  \end{equation*}

  We have \( \mu > \card(\img f) \) since otherwise we would obtain
  \begin{equation*}
    \card(B) \geq \card(\img f) \geq \card(A) > \card(B),
  \end{equation*}
  which is a contradiction. Thus,
  \begin{equation*}
    \mu \geq \card(A).
  \end{equation*}

  Furthermore, since \( f^{-1}(b) \subseteq A \) for every \( b \in B \), the supremum \( \mu \) of their cardinals cannot exceed \( \card(A) \). Therefore,
  \begin{equation*}
    \card(A) = \mu.
  \end{equation*}
\end{proof}

\begin{example}\label{ex:thm:pigeonhole_principle}
  We list several examples related to \fullref{thm:pigeonhole_principle}:
  \begin{thmenum}
    \thmitem{ex:thm:pigeonhole_principle/lagrange} Given a \hyperref[def:group/homomorphism]{group homomorphism} \( \varphi: G \to H \), by \fullref{thm:group_zero_morphisms/isomorphism},
    \begin{equation*}
      G / \ker \varphi \cong \img \varphi.
    \end{equation*}

    \Fullref{thm:lagranges_subgroup_theorem} then implies that
    \begin{equation*}
      \card(\ker \varphi) \cdot \card(\img \varphi) = \card(G).
    \end{equation*}

    All cosets are equinumerous by \fullref{thm:subgroup_cosets/equinumerous}, so we can restate the above as
    \begin{equation*}
      \sup\set[\Big]{ \card(\varphi^{-h}) \given* h \in H } \cdot \card(\img \varphi) = \card(G).
    \end{equation*}

    We have thus obtained a special case of \fullref{thm:pigeonhole_principle/general} in which equality holds due to group homomorphisms being well-behaved structurally.

    \thmitem{ex:thm:pigeonhole_principle/birthdays} \Fullref{thm:pigeonhole_principle/finitary} allows us to conclude that, among \( 1000 \) people,
    \begin{itemize}
      \item At least \( 3 = \ceil(1000 / 365) \) were born on the same day.
      \item At least \( 20 = \ceil(1000 / 52) \) were born in the same week.
      \item At least \( 84 = \ceil(1000 / 12) \) were born in the same month.
    \end{itemize}

    \thmitem{ex:thm:pigeonhole_principle/boolean} Again via \fullref{thm:pigeonhole_principle/finitary} we conclude that, for every \hyperref[def:boolean_function]{predicate} \( f: A \to \set{ T, F } \) on a finite set \( A \) with \( n \) elements, either \( f \) holds for at least \( n / 2 \) members of \( A \) or \( f \) doesn't hold for (at least) \( n / 2 \) members.

    \thmitem{ex:thm:pigeonhole_principle/party} As a consequence of \fullref{ex:thm:pigeonhole_principle/boolean}, in a group of \( 6 \) people, either \( 3 \) know everybody else or \( 3 \) do not.

    Compare this example to \fullref{ex:ramsey_party_problem}, where we are interested how many people know \hi{each other}. This leads to the considerably harder problem of estimating \hyperref[def:ramsey_number]{Ramsey numbers}.
  \end{thmenum}
\end{example}

\paragraph{Permutations}

\begin{definition}\label{def:factorial}\mcite[46]{Knuth1997ArtVol1}
  We define the \term[bg=факториел (\cite[129]{Тагамлицки1971Диф}), ru=факториал (\cite[145]{АлександровМаркушевичХинчин1952ЭнциклопедияТом3})]{factorial} of a \hyperref[def:integer_signum]{nonnegative integer} \( n \) recursively as follows:
  \begin{equation}\label{eq:def:factorial}
    n! \coloneqq \begin{cases}
      1,                &n = 0, \\
      (n - 1)! \cdot n, &n > 0.
    \end{cases}
  \end{equation}
\end{definition}
\begin{comments}
  \item For \( n > 0 \), this is simply the product of all smaller positive integers. The base case \( n = 0 \) is justified by \fullref{thm:symmetric_group_cardinality}.
\end{comments}

\begin{theorem}[Stirling's factorial approximation]\label{thm:stirlings_factorial_approximation}
  For the factorial function we have
  \begin{equation*}
    n! = \sqrt{2 \pi n} \cdot \parens*{ \frac n e }^n \cdot e^{\mu(n)},
  \end{equation*}
  where \( \mu \), defined by \eqref{eq:thm:stirlings_gamma_approximation/mu}, satisfies
  \begin{equation*}
    0 < \mu(n) < \frac 1 {12n}.
  \end{equation*}
\end{theorem}
\begin{proof}
  Follows from \fullref{thm:stirlings_gamma_approximation}.
\end{proof}

\begin{proposition}\label{thm:symmetric_group_cardinality}
  The \hyperref[def:symmetric_group]{symmetric group} \( S_n \) has \( n! \) elements.
\end{proposition}
\begin{proof}
  We will use induction on \( n \).

  \begin{itemize}
    \item The case \( n = 0 \) is trivial --- there is only one empty permutation in \( S_0 \).

    \item For \( n > 0 \), suppose that \( S_{n - 1} \) has \( (n - 1)! \) elements. The group \( S_n \) is obtained by permuting \( n \) with each element of \( S_{n - 1} \). This can be expressed via composition with the \hyperref[def:transposition]{transposition} \( \cycle{ k, n } \) for different \( k \):
    \begin{equation*}
      S_n = \set{ \cycle{ k, n } \bincirc \sigma \given \sigma \in S_{n-1} \T{and} 1 \leq k \leq n }.
    \end{equation*}

    There are \( n \) such transpositions, thus \( S_n \) is equinumerous with \( S_{n-1} \times \set{ 1, \ldots, n } \). \Fullref{thm:cardinality_product_rule} implies that
    \begin{equation*}
      \card(S_n)
      =
      \card(S_{n-1}) \cdot n
      \reloset {\T{ind.}} =
      (n - 1)! \cdot n
      =
      n!.
    \end{equation*}
  \end{itemize}
\end{proof}

\begin{lemma}\label{thm:permutation_parity_homomorphism}
  If we regard a \hyperref[def:permutation_parity]{permutation's sign} as a function of \( S_n \) into the \hyperref[def:cyclic_group]{cyclic group} \( C_2 \), then it is a homomorphism.
\end{lemma}
\begin{proof}
  Follows from \fullref{thm:permutation_product_parity}.
\end{proof}

\begin{proposition}\label{thm:alternating_group_cardinality}
  The \hyperref[def:alternating_group]{alternating group} \( A_n \) has \( n! / 2 \) elements.
\end{proposition}
\begin{proof}
  \Fullref{thm:permutation_parity_homomorphism} implies \( \sgn: S_n \to C_2 \) is a homomorphism. Its kernel is \( A_n \).

  \Fullref{thm:group_zero_morphisms/isomorphism} implies that the quotient \( S_n / A_n \) is isomorphic to \( C_2 \).

  \Fullref{thm:symmetric_group_cardinality} implies that \( S_n \) has \( n! \) elements. Then \fullref{thm:lagranges_subgroup_theorem} implies that \( A_n \) has \( n! / 2 \) elements.
\end{proof}

\paragraph{Variations}

\begin{definition}\label{def:combinatorial_variation}\mimprovised
  A \term[bg=вариация (\cite[27]{ДимитровЯнев2007Статистика}), ru=размещение (\cite[171]{Яблонский2003ДискретнаяМатематика})]{combinatorial variation} on \( A \) of \term{size} \( k \) is simply an \hyperref[def:ordered_tuple]{ordered tuple} of \( k \) elements of \( A \).

  We say that the variation is with or without \term[bg=(вариация с) повторение (\cite[27]{ДимитровЯнев2007Статистика}), en=(permutation with) repetition (\cite[446]{Rosen2019DiscreteMathematics})]{repetition} depending on whether its components are unique. Unless otherwise noted, we will assume that variations have no repetitions.
\end{definition}
\begin{comments}
  \item The term \enquote{permutation} is often preferred to \enquote{variation} despite not being equivalent to permutations in \hyperref[def:symmetric_group]{symmetric groups}. See \fullref{rem:combinatorial_permutation_terminology}.
\end{comments}

\begin{remark}\label{rem:combinatorial_permutation_terminology}
  In \fullref{def:combinatorial_variation}, we called an ordered tuple of length \( k \) of elements of \( A \) a \enquote{variation}. A more common term is \enquote{permutation}.

  When comparing his terminology to that of others, \incite[29]{Aigner1997Combinatorics} states that injective functions from a set of \( r \) elements to a set of \( n \) elements are also called \enquote{\( n \)-permutations of \( r \) objects}. He then remarks that, in older literature, \enquote{\( n \)-permutations} are called \enquote{\( n \)-variations}. This terminology is still used in Bulgarian, for example in \cite[27]{ДимитровЯнев2007Статистика}.

  In Russophone literature, \enquote{размещение} (\enquote{arrangement}) is used instead. This usage can be found in \incite[171]{Яблонский2003ДискретнаяМатематика} and \incite[100]{БелоусовТкачёв2004ДискретнаяМатематика}.

  Multiset permutations in the sense of \fullref{def:multiset_permutation} bring additional confusion, since they are formally neither of the above.

  We avoid using the term \enquote{permutation} for variations, but describe in \fullref{thm:combinatorial_and_algebraic_permutation} cases in which this would be compatible with our usage in symmetric groups.

  In the context of combinatorics, the term \enquote{permutation} does indeed often refer to what we call \enquote{variation}. \incite[1]{Hall1986Combinatorics} provides the following definition:
  \begin{displayquote}
    A permutation is an ordered selection of objects from a set \( S \).
  \end{displayquote}

  \incite[429]{Rosen2019DiscreteMathematics} provides two related definition:
  \begin{displayquote}
    A permutation of a set of distinct objects is an ordered arrangement of these objects. We are also interested in ordered arrangements of some of the elements of the set. An ordered arrangement of \( r \) elements of a set is called an \( r \)-permutation.
  \end{displayquote}

  On the other hand, the predominant usage of \enquote{permutation} is to refer to bijective \hyperref[def:function/endofunction]{endofunction}.
  \begin{itemize}
    \item For elements of the finite symmetric group \( S_n \), it is used by
    \incite[31]{Jacobson1985AlgebraI},
    \incite[78]{Винберг2014Алгебра} (as \enquote{перестановка}) and
    \incite[82]{Тыртышников2017Алгебра} (as \enquote{подстановка})

    \item In the same sense, but without explicit discussion of symmetric groups, it is used by
    \incite[28]{Knuth1997ArtVol1},
    \incite[20]{Stanley2012EnumCombinatoricsVol1} and
    \incite[def. 2.11.1]{Savage2008Computability}.

    \item For elements of a general symmetric group \( S_A \), it is used by
    \incite[8]{Lang2002Algebra},
    \incite[116]{Rotman2015AlgebraPart1},
    \incite[def. II.2.1]{Aluffi2009Algebra} and
    \incite[\S 2.2.5]{Новиков2013ДискретнаяМатематика} (as \enquote{перестановка}).
  \end{itemize}
\end{remark}

\begin{proposition}\label{thm:combinatorial_and_algebraic_permutation}
  The \hyperref[def:ordered_tuple]{ordered tuple} \( (a_1, \ldots, a_k) \) of integers between \( 1 \) and \( n \) is a \hyperref[def:combinatorial_variation]{combinatorial variation} (without repetition) if and only if there exists a member \( \sigma \) of the \hyperref[def:symmetric_group]{symmetric group} \( S_n \) such that \( \sigma(i) = a_i \) for \( i = 1, \ldots, k \).
\end{proposition}
\begin{comments}
  \item This proposition connects different definitions of \enquote{permutation}, as discussed in \fullref{rem:combinatorial_permutation_terminology}.
\end{comments}
\begin{proof}
  \SufficiencySubProof Consider the following function on \( \set{ 1, \ldots, n } \):
  \begin{equation*}
    \sigma(i) \coloneqq \begin{cases}
      i,                                                                  &i \leq k, \\
      \min\set{ 1 \leq a \leq n \given \sigma(j) \neq a \T{for} j < i }, &i > k.
    \end{cases}
  \end{equation*}

  If the elements of \( (a_1, \ldots, a_k) \) are distinct, then \( \sigma \) is bijective, and thus belongs to \( S_n \).

  \NecessitySubProof For every bijective function \( \sigma \) in \( S_n \), the elements \( \sigma(1), \ldots, \sigma(k) \) are distinct, thus they form a variation without repetition.
\end{proof}

\begin{lemma}\label{thm:combinatorial_and_algebraic_permutation_quotient_lemma}
  Regard the \hyperref[def:symmetric_group]{symmetric group} \( S_{n - k} \) as a subgroup of \( S_n \) whose members fix the numbers \( 1, \ldots, k \). Then two members from \( S_n \) belong to the same coset with respect to \( S_{n - k} \) if and only if they coincide on \( 1, \ldots, k \).

  For every \hyperref[def:combinatorial_variation]{combinatorial variations} (without repetition) \( (a_1, \ldots, a_k) \) on \( \set{ 1, \ldots, n } \), \fullref{thm:combinatorial_and_algebraic_permutation} gives us a member \( \sigma \) from \( S_n \).

  The map sending \( (a_1, \ldots, a_k) \) to the coset \( \pi(\sigma) \) in \( S_n / S_{n - k} \) is bijective.
\end{lemma}
\begin{proof}
  Follows from \fullref{thm:combinatorial_and_algebraic_permutation}.
\end{proof}

\begin{proposition}\label{thm:combinatorial_and_algebraic_permutation_quotient}
  The \hyperref[def:group/quotient]{quotient} \( S_n / S_{n - k} \) of \hyperref[def:symmetric_group]{symmetric groups} is \hyperref[def:equinumerosity]{equinumerous} with the set of all \hyperref[def:combinatorial_variation]{combinatorial variations} (without repetition) of size \( k \) on any set with \( n \) elements.
\end{proposition}
\begin{proof}
  Fix a set \( A \) of \( n \) elements. Its elements can be enumerated by some bijective function \( f: A \to \set{ 1, \ldots, n } \). Then \fullref{thm:combinatorial_and_algebraic_permutation_quotient_lemma} implies that the variations of \( \set{ 1, \ldots, n } \) of size \( k \) are equinumerous with the quotient \( S_n / S_{n - k} \), and thus, via \( f \), to the variations of \( A \) of size \( k \).
\end{proof}

\begin{proposition}\label{thm:combinatorial_variation_count}
  Fix a set \( A \) of \( n \) elements.

  \begin{thmenum}
    \thmitem{thm:combinatorial_variation_count/repetition} The number of \hyperref[def:combinatorial_variation]{variations} on \( A \) of size \( k \) \hi{with repetition} is \( n^k \).

    \thmitem{thm:combinatorial_variation_count/no_repetition} The number of variations on \( A \) of size \( k \) \hi{without repetition} is \( 0 \) if \( k > n \) and
    \begin{equation}\label{eq:thm:combinatorial_variation_count/no_repetition}
      \frac {n!} {(n - k)!} = \prod_{m=0}^{k - 1} (n - m).
    \end{equation}
    otherwise.
  \end{thmenum}
\end{proposition}
\begin{comments}
  \item \incite[74]{Aigner1997Combinatorics} calls \eqref{eq:thm:combinatorial_variation_count/no_repetition} a \enquote{falling factorial}.
\end{comments}
\begin{proof}
  \SubProofOf{thm:combinatorial_variation_count/repetition} The variations in \( A \) of size \( k \) with repetition are precisely the elements of the Cartesian power \( A^k \). \Fullref{thm:cardinality_product_rule} implies that the cardinality of the \( A^k \) is \( n^k \).

  \SubProofOf{thm:combinatorial_variation_count/no_repetition} There are no combinatorial variations without repetitions of size \( k > n \).

  If \( k < n \), \fullref{thm:combinatorial_and_algebraic_permutation_quotient} implies that the set of variations on \( A \) of size \( k \) is equinumerous with the quotient \( S_n / S_{n - k} \).

  \Fullref{thm:symmetric_group_cardinality} implies that \( S_n \) has \( n! \) elements and \( S_{n - k} \) --- \( k! \) elements. Then \eqref{eq:thm:combinatorial_variation_count/no_repetition} follows from \fullref{thm:lagranges_subgroup_theorem}.
\end{proof}

\paragraph{Binomial coefficients}

\begin{definition}\label{def:binomial_coefficient}\mimprovised
  Fix a ring element \( \alpha \) and a nonnegative integer \( k \). We define their \term[ru=биномиальный коеффициент (\cite[100]{БелоусовТкачёв2004ДискретнаяМатематика}), en=binomial coefficient (\cite[53]{Knuth1997ArtVol1})]{binomial coefficient} as
  \begin{equation}\label{eq:def:binomial_coefficient}
    \binom \alpha k \coloneqq \prod_{m=0}^{k - 1} \frac {\alpha - m} {k - m}.
  \end{equation}

  \begin{paracol}{2}
    \begin{leftcolumn}
      Empty products evaluate to \( 1 \), hence
      \begin{equation}\label{eq:def:binomial_coefficient/zero}
        \binom \alpha 0 = 1
      \end{equation}
    \end{leftcolumn}

    \begin{rightcolumn}
      Another trivial case is
      \begin{equation}\label{eq:def:binomial_coefficient/one}
        \binom \alpha 1 = \alpha
      \end{equation}
    \end{rightcolumn}
  \end{paracol}

  Instead of an abstract ring element \( \alpha \), we will almost exclusively consider a nonnegative integer \( n \). In fact, we will refer to the general case as a \term{generalized binomial coefficient}.

  As we will show in \fullref{thm:binomial_coefficient_is_integer}, the binomial coefficient for a nonnegative integer is itself a nonnegative integer; thus, it is well-defined over any semiring.

  When \( \alpha \) is a negative integer \( -n \), we refer to the \term{negative binomial coefficient}. As we will show in \fullref{thm:negative_binomial_coefficient}, negative binomial coefficients can be expressed via nonnegative coefficients, and are sometimes also well-defined over semirings.
\end{definition}
\begin{comments}
  \item We base our definition on \cite[53]{Knuth1997ArtVol1}, where Knuth considers \( \alpha \) to be an arbitrary real number. We will need to use complex numbers in \fullref{thm:binomial_series}.

  \item Binomial coefficients notably arise when counting the number of \hyperref[def:combinatorial_combination]{combinatorial combinations}, that is, subsets of cardinality \( k \) of a set of cardinality \( n \). This is discussed in \fullref{thm:combinatorial_combination_count}. For this reason, they are sometimes denoted using variants of the letter \enquote{C}, for example \( C_k^n \). \incite[432]{Rosen2019DiscreteMathematics} and \incite[100]{БелоусовТкачёв2004ДискретнаяМатематика} use such notation in addition to \( \binom n k \) when they want to distinguish between \enquote{the number of combinations} and \eqref{eq:def:binomial_coefficient}.
  .

  \item The name \enquote{binomial coefficient} comes from \fullref{thm:binomial_theorem}, where they represent the number of times the same monomial occurs when using distributivity to expand the binomial power \( (X + Y)^n \).
\end{comments}

\begin{proposition}\label{thm:def:binomial_coefficient}
  \hyperref[def:binomial_coefficient]{Binomial coefficients} have the following basic properties:
  \begin{thmenum}
    \thmitem{thm:def:binomial_coefficient/plus_one}
    \begin{equation}\label{eq:thm:def:binomial_coefficient/plus_one}
      \binom {\alpha + 1} {k + 1} = \frac \alpha k \cdot \binom \alpha k.
    \end{equation}

    \thmitem{thm:def:binomial_coefficient/negative}
    \begin{equation}\label{eq:thm:def:binomial_coefficient/negative}
      \binom {-\alpha} k = (-1)^k \cdot \binom {\alpha + k - 1} k.
    \end{equation}

    \thmitem{thm:def:binomial_coefficient/factorials}
    \begin{equation}\label{eq:thm:def:binomial_coefficient/factorials}
      \binom n k = \begin{dcases}
        \frac {n!} {k!(n-k)!}, &k \leq n, \\
        0,                     &k > n.
      \end{dcases}
    \end{equation}

    \thmitem{thm:def:binomial_coefficient/symmetry} If \( k \leq n \), we have
    \begin{equation}\label{eq:thm:def:binomial_coefficient/symmetry}
      \binom n k = \binom n {n - k}.
    \end{equation}
  \end{thmenum}
\end{proposition}
\begin{comments}
  \item In particular, negative binomial coefficients can be expressed via positive coefficients.
\end{comments}
\begin{proof}
  \SubProofOf{thm:def:binomial_coefficient/plus_one}
  \begin{equation*}
    \binom {\alpha + 1} {k + 1}
    =
    \prod_{m=0}^k \frac {\alpha + 1 - m} {k + 1 - m}.
    =
    \frac {\alpha + 1} {k + 1} \cdot \prod_{m=1}^k \frac {\alpha + 1 - m} {k + 1 - m}.
    =
    \frac {\alpha + 1} {k + 1} \cdot \binom \alpha k.
  \end{equation*}

  \SubProofOf{thm:def:binomial_coefficient/negative} Due to commutativity of multiplication, we have
  \begin{equation*}
    \prod_{m=0}^{k - 1} (\alpha + m)
    =
    \prod_{m=0}^{k - 1} (\alpha + k - 1 - m).
  \end{equation*}

  Then
  \begin{equation*}
    \binom {-\alpha} k
    =
    \prod_{m=0}^{k - 1} \frac {-\alpha - m} {k - m}
    =
    (-1)^k \cdot \prod_{m=0}^{k - 1} \frac {\alpha + m} {k - m}
    =
    (-1)^k \cdot \binom {\alpha + k - 1} k.
  \end{equation*}

  \SubProofOf{thm:def:binomial_coefficient/factorials} If \( k \leq n \), then \( n - m \) is a positive integer for every \( m = 0, \ldots, k - 1 \), thus
  \begin{equation*}
    \binom n k
    =
    \prod_{m=0}^{k - 1} \frac {n - m} {k - m}
    =
    \parens[\Bigg]{ \prod_{m=0}^{k - 1} (n - m) } \cdot \parens[\Bigg]{ \prod_{m=0}^{k - 1} \frac 1 {k - m} }
    =
    \parens[\Bigg]{ \frac {n!} {(n - k)!} } \cdot \frac 1 {k!}.
  \end{equation*}

  If \( k > n \), then
  \begin{equation*}
    \binom n k
    =
    \prod_{m=0}^{k - 1} \frac {n - m} {k - m}
    =
    \frac {n - n} {k - n} \cdot \parens[\Bigg]{ \prod_{m \neq n}^{k - 1} \frac {n - m} {k - m} }
    =
    0.
  \end{equation*}

  \SubProofOf{thm:def:binomial_coefficient/symmetry} Since \( k \) is nonnegative, we can add \( n \) to both sides of \( -k \leq 0 \) to conclude that \( n - k \leq n \). Then, since \( k \leq n \), \( n - k \) is nonnegative, and \fullref{thm:def:binomial_coefficient/factorials} implies that
  \begin{equation*}
    \binom n {n - k} = \frac {n!} {k!(n - k)!} = \binom n k.
  \end{equation*}
\end{proof}

\begin{theorem}[Pascal's binomial recurrence]\label{thm:pascals_binomial_recurrence}
  The \hyperref[def:binomial_coefficient]{binomial coefficient} satisfy the following recurrence:
  \begin{equation}\label{eq:thm:pascals_binomial_recurrence}
    \binom {n + 1} {k + 1} = \binom n {k + 1} + \binom n k.
  \end{equation}
\end{theorem}
\begin{comments}
  \item \incite[thm. 6.4.2]{Rosen2019DiscreteMathematics} calls this recurrence \enquote{Pascal's identity} after Pascal because of its relation to \hyperref[con:pascals_triangle]{Pascal's triangle}. \incite[56]{Knuth1997ArtVol1} calls it the \enquote{addition formula for binomial coefficients}.

  \item This recurrence is useful for inductive proofs on \( n \).
\end{comments}
\begin{proof}
  We will use the representation \fullref{thm:def:binomial_coefficient/factorials}.

  \SubProof{Proof when \( k < n \)} We have
  \begin{balign*}
    \binom n {k + 1} + \binom n k
    &=
    \frac {n!} {(k + 1)! (n - k - 1)!} + \frac {n!} {k! (n - k)!}
    = \\ &=
    \frac {n!} {k! (n - k - 1)!} \bracks*{ \frac 1 {k + 1} + \frac 1 {n - k} }
    = \\ &=
    \frac {n!} {k! (n - k - 1)!} \frac {n + 1} {(k + 1)(n - k)}
    = \\ &=
    \frac {(n + 1)!} {(k + 1)! (n - k)!}
    = \\ &=
    \binom {n + 1} {k + 1}.
  \end{balign*}

  \SubProof{Proof when \( k = n \)} In this case
  \begin{equation*}
    \binom {n + 1} {k + 1}
    =
    \binom {n + 1} {n + 1}
    \reloset {\eqref{eq:def:binomial_coefficient/zero}} =
    1
  \end{equation*}
  and
  \begin{equation*}
    \binom n k = \binom n n = 1,
  \end{equation*}
  however
  \begin{equation*}
    \binom n {k + 1} = \binom n {n + 1} = 0.
  \end{equation*}

  We again conclude that \eqref{eq:thm:pascals_binomial_recurrence} holds.

  \SubProof{Proof when \( k > n \)} In this case
  \begin{equation*}
    \binom {n + 1} {k + 1} = \binom n {k + 1} = \binom n {k + 1} = 0.
  \end{equation*}
\end{proof}

\begin{corollary}\label{thm:binomial_coefficient_is_integer}
  The \hyperref[def:binomial_coefficient]{binomial coefficient} with nonnegative integer arguments is itself a nonnegative integer.
\end{corollary}
\begin{proof}
  We can use induction on \( n \) to show that \( \binom n k \) is a nonnegative integer for any nonnegative integer \( k \).
  \begin{itemize}
    \item In the case \( n = 0 \), by \fullref{thm:def:binomial_coefficient/factorials},
    \begin{equation*}
      \binom 0 k = \begin{cases}
        1, k = 0, \\
        0, k > 0.
      \end{cases}
    \end{equation*}

    \item In the case \( n > 0 \), either \( k = 0 \) and
    \begin{equation*}
      \binom n 0 \reloset {\eqref{eq:def:binomial_coefficient/zero}} = 1
    \end{equation*}
    or \( k > 0 \) and \fullref{thm:pascals_binomial_recurrence} implies that
    \begin{equation*}
      \binom n k
      =
      \binom {n - 1} k + \binom {n - 1} {k - 1}.
    \end{equation*}

    By the inductive hypothesis, both summands are nonnegative integers, hence so is their sum.
  \end{itemize}
\end{proof}

\begin{theorem}[Newton's binomial theorem]\label{thm:binomial_theorem}
  In any \hyperref[def:semiring/commutative]{commutative semiring}, we have the polynomial factorization
  \begin{equation}\label{eq:thm:binomial_theorem}
    (X + Y)^n = \sum_{k=0}^n \binom n k X^k Y^{n-k}.
  \end{equation}
\end{theorem}
\begin{comments}
  \item This theorem generalizes to \fullref{thm:multinomial_theorem}.
\end{comments}
\begin{proof}
  We will use induction on \( n \). The case \( n = 0 \) is trivial, so suppose that the theorem holds for \( n \).

  Then the inductive hypothesis implies that
  \begin{equation*}
    Y(X + Y)^n
    =
    \sum_{k=0}^n \binom n k X^k Y^{n-(k-1)}
    =
    Y^{n+1} + \sum_{k=0}^{n-1} \binom n {k+1} X^{k+1} Y^{n-k}.
  \end{equation*}

  \Fullref{thm:def:binomial_coefficient/factorials} implies that,for \( k = n \), we have \( \binom n {k+1} = 0 \), thus
  \begin{equation*}
    Y(X + Y)^n
    =
    Y^{n+1} + \sum_{k=0}^n \binom n {k+1} X^{k+1} Y^{n-k}.
  \end{equation*}

  Again, by the inductive hypothesis, we have
  \begin{equation*}
    X(X + Y)^n = \sum_{k=0}^n \binom n k X^{k+1} Y^{n-k}
  \end{equation*}

  We can thus use \fullref{thm:pascals_binomial_recurrence} to conclude that
  \begin{balign*}
    (X + Y)^{n+1}
    &=
    X(X + Y)^n + Y(X + Y)^n
    = \\ &=
    \sum_{k=0}^n \bracks[\Big]{ \binom n k + \binom n {k+1} } X^{k+1} Y^{n-k} + Y^{n+1}
    = \\ &=
    \sum_{k=0}^n \binom {n+1} {k+1} X^{k+1} Y^{n-k} + Y^{n+1}
    = \\ &=
    \sum_{k=0}^{n+1} \binom {n+1} k X^k Y^{n+1-k}.
  \end{balign*}
\end{proof}

\begin{corollary}[Binomial theorem for positive characteristic]\label{thm:binomial_theorem_positive_characteristic}
  In a \hyperref[def:ring]{ring} of \hyperref[def:ring_characteristic]{characteristic} \( p \), if \( q = p^n \) for any nonnegative integer \( n \), \fullref{thm:binomial_theorem} reduces to
  \begin{equation}\label{eq:thm:binomial_theorem_positive_characteristic}
    (X + Y)^q = X^q + Y^q.
  \end{equation}
\end{corollary}
\begin{comments}
  \item A memorable name for this theorem is \enquote{Freshman's dream}, based on a poem with subtitle \enquote{The Freshman's Dream}, published by \incite{Gleason1938FreshmansDream}. The following two verses seem most relevant:
  \begin{displayquote}
    Remove the brackets, radicals, \\
    And do so with discretion.
  \end{displayquote}
\end{comments}
\begin{proof}
  If \( k > 0 \), \fullref{thm:def:binomial_coefficient/plus_one} implies that
  \begin{equation*}
    \binom p k = \frac p k \cdot \binom {p - 1} {k - 1}.
  \end{equation*}

  If \( k < p \), since \( p \) is prime, \( k \) does not divide \( p \). Furthermore, \( k - 1 - m \) does not divide \( p \) for any \( m = 0, \ldots, k - 2 \).

  Therefore, if \( 0 < k < p \), \( p \) divides \( \binom p k \). \Fullref{thm:binomial_theorem} then implies that
  \begin{equation}\label{eq:thm:binomial_theorem_positive_characteristic/proof/prime}
    (X + Y)^p = X^p + Y^p.
  \end{equation}

  We can now use induction on \( n \) to show \eqref{eq:thm:binomial_theorem_positive_characteristic}. The case \( n = 0 \) is clear, and for \( n > 1 \) we have
  \begin{equation*}
    (X + Y)^q
    =
    \parens[\Big]{ (X + Y)^{p^{n-1}} }^p
    \reloset {\T{ind.}} =
    (X^{p^{n-1}} + Y^{p^{n-1}})^p
    \reloset {\eqref{eq:thm:binomial_theorem_positive_characteristic/proof/prime}} =
    X^q + Y^q.
  \end{equation*}
\end{proof}

\begin{theorem}[Binomial theorem for complex exponent]\label{thm:binomial_theorem_for_complex_exponent}\mcite[302]{Маркушевич1967АналитическиеФункцииТом1}
  For \hyperref[def:complex_numbers]{complex numbers} \( z \) and \( \alpha \), where \( \abs{z} < 1 \), we have
  \begin{equation}\label{eq:thm:binomial_theorem_for_complex_exponent}
    (z + 1)^\alpha = \sum_{k=0}^\infty \binom \alpha k z^k.
  \end{equation}
\end{theorem}
\begin{comments}
  \item We can make \eqref{eq:thm:binomial_theorem_for_complex_exponent} look closer to \fullref{thm:binomial_theorem} by multiplying with \( w^\alpha \) for some complex number \( w \):
  \begin{equation*}
    ({wz} + w)^\alpha = \sum_{k=0}^\infty \binom \alpha k (wz)^k w^{\alpha - k}.
  \end{equation*}
\end{comments}
\begin{proof}
  We will show by induction on \( k \) that the \( k \)-th derivative of \( (z + 1)^\alpha \) is
  \begin{equation}\label{eq:thm:binomial_theorem_for_complex_exponent/proof/derivative}
    \prod_{m=0}^{k-1} (\alpha - k) \cdot (z + 1)^{\alpha - k}.
  \end{equation}

  Then \eqref{eq:thm:binomial_theorem_for_complex_exponent} will follow since as the Taylor series of \( (z + 1)^\alpha \).

  The base case \( k = 0 \) for \eqref{eq:thm:binomial_theorem_for_complex_exponent/proof/derivative} is vacuous, so suppose that the inductive hypothesis holds for \( k \).

  Note that
  \begin{equation*}
    (z + 1)^{\alpha - k} = e^{(\alpha - k) \cdot \ln(z + 1)}
  \end{equation*}
  and differentiating gives us
  \begin{equation*}
    (\alpha - k) \cdot \underbrace{\frac 1 {z + 1}}_{(z + 1)^{-1}} \cdot e^{(\alpha - k) \cdot \ln(z + 1)}
    =
    (\alpha - k) \cdot e^{(\alpha - (k + 1)) \cdot \ln(z + 1)}.
  \end{equation*}

  Then \eqref{eq:thm:binomial_theorem_for_complex_exponent/proof/derivative} follows.
\end{proof}

\begin{theorem}[Vandermonde convolution]\label{thm:vandermonde_convolution}\mcite[59]{Knuth1997ArtVol1}
  \hyperref[def:binomial_coefficient]{Binomial coefficients} satisfy
  \begin{equation}\label{eq:thm:vandermonde_convolution}
    \binom {n + m} k = \sum_{i+j=k} \binom n i \cdot \binom m j.
  \end{equation}
\end{theorem}
\begin{proof}
  Consider the polynomial \( X + 1 \) over any commutative semiring.

  By \fullref{thm:binomial_theorem}, we have
  \begin{equation*}
    (X + 1)^{n+m} = \sum_{k=0}^{n+m} \binom {n+m} k X^k 1^{n+m-k}.
  \end{equation*}

  Using the \hyperref[def:semigroup_algebra]{convolution product} instead, we obtain
  \begin{equation*}
    (X + 1)^n \cdot (X + 1)^m = \sum_{k=0}^{n+m} \parens*{ \sum_{i+j=k} \binom n i \cdot \binom m j } X^k.
  \end{equation*}

  Since the two are equal, we obtain \eqref{eq:thm:vandermonde_convolution}.
\end{proof}

\paragraph{Combinations}

\begin{definition}\label{def:combinatorial_combination}\mimprovised
  A \term[bg=комбинация (\cite[27]{ДимитровЯнев2007Статистика}), ru=сочетание (\cite[172]{Яблонский2003ДискретнаяМатематика}), en=combination (\cite[431]{Rosen2019DiscreteMathematics})]{combinatorial combination} on \( A \) of \term{size} \( k \) is simply subset of \( A \) of cardinality \( k \).

  Similarly to \hyperref[def:combinatorial_variation]{combinatorial variations}, we also consider combinations with \term[bg=(комбинация с) повторение (\cite[28]{ДимитровЯнев2007Статистика}), ru=(сочетание) с повторением (\cite[172]{Яблонский2003ДискретнаяМатематика}), en=(combination with) repetition (\cite[446]{Rosen2019DiscreteMathematics})]{repetition} --- \hyperref[def:multiset]{multisets} of elements of \( A \) with \hyperref[def:multiset/cardinality]{multiset cardinality} \( k \).
\end{definition}

\begin{proposition}\label{thm:combinatorial_combination_count}
  Fix a set \( A \) of \( n \) elements.

  \begin{thmenum}
    \thmitem{thm:combinatorial_combination_count/no_repetition} The number of combinations on \( A \) of size \( k \) \hi{without repetition} is given by the \hyperref[def:binomial_coefficient]{binomial coefficient} \( \binom n k \).

    \thmitem{thm:combinatorial_combination_count/repetition} The number of \hyperref[def:combinatorial_combination]{combinations} on \( A \) of size \( k \) \hi{with repetition} is given by the \hyperref[def:binomial_coefficient]{negative binomial coefficient}
    \begin{equation}\label{eq:thm:combinatorial_combination_count/repetition}
      \abs*{ \binom {-n} k }
      \reloset {\eqref{eq:thm:def:binomial_coefficient/negative}} =
      \binom {n + k - 1} k.
    \end{equation}
  \end{thmenum}
\end{proposition}
\begin{proof}
  \SubProofOf{thm:combinatorial_combination_count/no_repetition} We will use induction on \( n \), simultaneously for all \( k \), to show there \( A \) has \( \binom n k \) combinations of size \( k \) without repetition.

  The base case is trivial --- if \( A \) is empty, then \( n = 0 \), and there is only one combination of size \( 0 \) and no other combinations.

  Let \( n > 1 \) and suppose that the inductive hypothesis holds for \( n - 1 \). Fix an element \( a \) of \( A \).

  Then there are \( \binom {n - 1} k \) subsets of \( A \setminus \set{ a } \) with \( k \) elements --- precisely the combinations on \( A \) of size \( k \) not containing \( a \).

  Similarly, there are \( \binom {n - 1} {k - 1} \) subsets of \( A \setminus \set{ a } \) with \( k - 1 \) elements, which become combinations of size \( k \) when we add \( a \) to them.

  \Fullref{thm:cardinality_sum_rule} implies that the total number of combinations of size \( k \) is
  \begin{equation*}
    \binom {n - k} k + \binom {n - 1} {k - 1},
  \end{equation*}
  which equals \( \binom n k \) as shown in \fullref{thm:pascals_binomial_recurrence}.

  \SubProofOf{thm:combinatorial_combination_count/repetition} Combinations with repetition are more complicated.

  We will use induction on \( n \), with nested induction on \( k \). The base case where \( n = 0 \) is again trivial, so suppose that \( A \) is nonempty and that the inductive hypothesis holds for its strict subsets.

  \SubProof{Proof when \( k < n \)} Consider a nonempty subset \( B \) of \( A \) of cardinality \( m \leq k \). A multiplicity assignment \( \mu \) on \( B \) has cardinality \( k \) if
  \begin{equation*}
    \sum_{b \in B} \mu(b) = k.
  \end{equation*}

  We have a restriction on \( \mu \) --- given that \( B \) already contains its elements once, \( \mu(b) \) must be at least \( 1 \). We can avoid this restriction by instead considering the assignment \( \widehat{\mu} \) such that
  \begin{equation*}
    \sum_{b \in B} \widehat{\mu}(b) = k - m
  \end{equation*}
  and putting \( \mu(b) = \widehat{\mu}(b) + 1 \).

  These assignments are given by combinations with repetition on \( B \) of size \( (k - m) \). By the inductive hypothesis on \( n \), there are
  \begin{equation*}
    \binom {m + (k - m) - 1} {k - m} = \binom {k - 1} {k - m}
  \end{equation*}
  such combinations.

  \Fullref{thm:combinatorial_combination_count/no_repetition} implies that there are \( \binom n m \) subsets of \( A \) of cardinality \( m \). We just showed that each of them has \( \binom {k - 1} {k - m} \) has suitable multiplicity assignments, hence \fullref{thm:cardinality_product_rule} implies that there are
  \begin{equation*}
    \binom n m
    \cdot
    \binom {k - 1} {k - m}
  \end{equation*}
  combinations with repetition of size \( k \) based on subsets of \( A \) of size \( m \).

  By \fullref{thm:vandermonde_convolution}, the sum by all \( m \leq k \) gives us
  \begin{equation*}
    \sum_{m=0}^k \binom n m \cdot \binom {k - 1} {k - m} = \binom {n + k - 1} k.
  \end{equation*}

  \SubProof{Proof when \( k \geq n \)} In this case we proceed similarly to \fullref{thm:combinatorial_combination_count/no_repetition}.

  At this point we are in the inductive step of both \( n \) and \( k \). so both are nonzero.

  Then \( A \) is nonempty. Fix an element \( a \) of \( A \). By the inductive hypothesis on \( n \), there are
  \begin{equation*}
    \binom {(n - 1) + k - 1} k
  \end{equation*}
  combinations with repetition of \( A \setminus \set{ x } \) of size \( k \).

  Similarly, by the inductive hypothesis on \( k \), there are
  \begin{equation*}
    \binom {n + (k - 1) - 1} {k - 1}
  \end{equation*}
  combinations with repetition of \( A \) of size \( k - 1 \), to which we can add \( a \) one more time.

  Then \fullref{thm:pascals_binomial_recurrence} implies that their sum, the total number of combinations with repetition of size \( k \), is
  \begin{equation*}
    \binom {n + k - 1} k.
  \end{equation*}

  This concludes the proof.
\end{proof}

\paragraph{Pascal's triangle}

\begin{concept}\label{con:pascals_triangle}\mcite[fig. 6.4.1]{Rosen2019DiscreteMathematics}
  \term[ru=треугольник Паскаля (\cite[\S 5.3.4]{Новиков2013ДискретнаяМатематика})]{Pascal's triangle} is a colloquial name for schematic \hyperref[def:triangle]{triangles} and \hyperref[def:triangular_point_configuration]{triangular point configurations} a-la \cref{fig:con:pascals_triangle}, in which every number is the sum of the two numbers above, with ones on the boundary.

  \begin{figure}[!ht]
    \centering
    \includegraphics[page=1]{output/con__pascals_triangle}
    \caption{\hyperref[con:pascals_triangle]{Pascal's triangle}.}\label{fig:con:pascals_triangle}
  \end{figure}

  By \enquote{schematic triangle} we mean that every object showing the same recurrence can again be called \enquote{Pascal's triangle}. For example, \incite[54]{Knuth1997ArtVol1} and \incite[179]{Яблонский2003ДискретнаяМатематика} use the term to refer to \hyperref[def:pascal_matrix/lower]{lower triangular Pascal matrices}.
\end{concept}

\begin{definition}\label{def:pascal_matrix}\mcite[1]{EdelmanStrang2018PascalMatrices}
  We will define three families of square matrices, which we will collectively call \term{Pascal matrices}.
  \begin{thmenum}
    \thmitem{def:pascal_matrix/lower} The \hyperref[def:triangular_matrix]{lower triangular} matrix \( L_n = \seq{ l_{i,j} }_{i,j=1}^n \), where
    \begin{equation*}
      l_{i,j} \coloneqq \begin{cases}
        0,                       &j > i, \\
        1,                       &j = 1, \\
        1,                       &j = i, \\
        l_{i-1,j} + l_{i-1,j-1}, &1 < j < i.
      \end{cases}
    \end{equation*}

    \thmitem{def:pascal_matrix/upper} Its \hyperref[def:transpose_matrix]{transpose}, the \hyperref[def:triangular_matrix]{upper triangular} matrix \( U_n = \seq{ u_{i,j} }_{i,j=1}^n \).

    \thmitem{def:pascal_matrix/symmetric} The symmetric matrix \( S_n = \seq{ s_{i,j} }_{i,j=1}^n \), where
    \begin{equation*}
      s_{i,j} \coloneqq \begin{cases}
        1,                     &i = 1, \\
        1,                     &j = 1, \\
        s_{i-1,j} + s_{i,j-1}, &i > 1 \T{and} j > 1.
      \end{cases}
    \end{equation*}
  \end{thmenum}
\end{definition}
\begin{comments}
  \item These matrices in \identifier{combinatorics.binomial} in \cite{notebook:code}.
\end{comments}

\begin{example}\label{ex:con:pascals_triangle}
  We give examples of \hyperref[def:pascal_matrix]{Pascal matrices}:
  \begin{equation*}
    L_7
    =
    \begin{pmatrix}
      1        &          &           &        &        &      &   \\
      \fbox{1} & \fbox{1} &           &        &        &      &   \\
      1        & \fbox{2} & 1         &        &        &      &   \\
      1        & 3        & 3         & 1      &        &      &   \\
      1        & 4        & 6         & 4      & 1      &      &   \\
      1        & \fbox{5} & \fbox{10} & 10     & 5      & 1    &   \\
      1        & 6        & \fbox{15} & 20     & 15     & 6    & 1
    \end{pmatrix}
  \end{equation*}
  \begin{equation*}
    U_7
    =
    \begin{pmatrix}
      1        & \fbox{1} & 1         & 1      & 1      & 1         & 1         \\
               & \fbox{1} & \fbox{2}  & 3      & 4      & \fbox{5}  & 6         \\
               &          & 1         & 3      & 6      & \fbox{10} & \fbox{15} \\
               &          &           & 1      & 4      & 10        & 20        \\
               &          &           &        & 1      & 5         & 15        \\
               &          &           &        &        & 1         & 6         \\
               &          &           &        &        &           & 1
    \end{pmatrix}
  \end{equation*}
  \begin{equation*}
    S_7
    =
    \begin{pmatrix}
      1        & \fbox{1} & 1         & 1      & 1      & 1      & 1   \\
      \fbox{1} & \fbox{2} & 3         & 4      & 5      & 6      & 7   \\
      1        & 3        & 6         & 10     & 15     & 21     & 28  \\
      1        & 4        & \fbox{10} & 20     & 35     & 56     & 84  \\
      1        & \fbox{5} & \fbox{15} & 35     & 70     & 126    & 210 \\
      1        & 6        & 21        & 56     & 126    & 252    & 462 \\
      1        & 7        & 28        & 84     & 210    & 462    & 924
    \end{pmatrix}
  \end{equation*}
\end{example}

\begin{proposition}\label{thm:pascal_matrix_binomial}
  We have the following relation between \hyperref[def:binomial_coefficient]{Binomial coefficients} and elements of \hyperref[def:pascal_matrix]{Pascal matrices}:
  \begin{align*}
    l_{i,j} &= \binom i j \thickspace\T{if}\thickspace i \leq j, \\
    u_{i,j} &= \binom j i \thickspace\T{if}\thickspace i \geq j, \\
    s_{i,j} &= \binom {i + j} j = \binom {i + j} i = \frac {(i + j)!} {i! j!}. \\
  \end{align*}
\end{proposition}
\begin{proof}
  Follows from \fullref{thm:pascals_binomial_recurrence}.
\end{proof}

\begin{proposition}\label{thm:pascal_matrix_product}
  For \hyperref[def:pascal_matrix]{Pascal matrices}, we have \( S_n = L_n \cdot U_n \).
\end{proposition}
\begin{proof}
  The \( (i, j) \)-th entry of \( L_n \cdot U_n \) is
  \begin{equation*}
    \sum_{k=1}^n l_{i,k} \cdot u_{k,j}
    =
    \sum_{k=1}^n l_{i,k} \cdot l_{j,k}
    =
    \sum_{k=1}^{\min\set{ i, j }} \binom i k \cdot \binom j k
    \reloset {\eqref{eq:thm:vandermonde_convolution}} =
    \binom {i + j} i
    =
    s_{i,j}.
  \end{equation*}
\end{proof}

\paragraph{Multinomial coefficients}

\begin{definition}\label{def:multinomial_coefficient}\mcite[65]{Knuth1997ArtVol1}
  As a generalization of \hyperref[def:binomial_coefficient]{binomial coefficients}, for nonnegative integers \( k_1, \ldots, k_m \) summing to \( n \), we define the \term[ru=мультиномный коэффициент (\cite[\S 5.3.7]{Новиков2013ДискретнаяМатематика})]{multinomial coefficient}
  \begin{equation}\label{eq:def:multinomial_coefficient}
    \binom n {k_1, \ldots, k_m} \coloneqq \frac {n!} {k_1! \cdots k_m!}.
  \end{equation}
\end{definition}

\begin{theorem}[Multinomial theorem]\label{thm:multinomial_theorem}
  \Fullref{thm:binomial_theorem} generalizes via \hyperref[def:multinomial_coefficient]{multinomial coefficients}:
  \begin{equation}\label{eq:thm:multinomial_theorem}
    (X_1 + \cdots + X_m)^n = \sum_{k_1 + \cdots + k_m = n} \binom n {k_1,\ldots,k_m} X_1^{k_1} \cdots X_m^{k_m}.
  \end{equation}
\end{theorem}

\begin{definition}\label{def:multiset_permutation}\mimprovised
  A \term{multiset permutation} of the finite \hyperref[def:multiset]{multiset} \( M \) is simply an \hyperref[def:enumeration]{enumeration} of \( M \) in which every element \( a \) of \( M \) occurs \( M(a) \) times.
\end{definition}
\begin{comments}
  \item Our definition is a formalization of \incite[\S 5.1.2]{Knuth1998ArtVol3}. \incite[28]{ДимитровЯнев2007Статистика} call them \enquote{permutation with repetition}, however the terminology doesn't seem to be established and may not fit well with \hyperref[def:combinatorial_variation]{variations} and \hyperref[def:combinatorial_combination]{combinations} with repetition.

  \item See \fullref{rem:combinatorial_permutation_terminology} for a more general discussion of the term \enquote{permutation}.
\end{comments}

\begin{proposition}\label{thm:multiset_permutation_count}
  Fix a \hyperref[def:multiset]{multiset} \( M \) with finite \hyperref[def:multiset/cardinality]{multiset cardinality} \( n \). Let \( a_1, \ldots, a_m \) be the distinct elements of \( M \), and denote by \( k_1, \ldots, k_m \) their cardinalities in \( M \).

  Then the number of \hyperref[def:multiset_permutation]{multiset permutations} of \( M \) is described by the \hyperref[def:multinomial_coefficient]{multinomial coefficient}
  \begin{equation}\label{eq:thm:multiset_permutation_count}
    \binom {n} {k_1! \cdots k_m!}
  \end{equation}
\end{proposition}
