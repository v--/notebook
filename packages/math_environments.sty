% Based on https://tex.stackexchange.com/a/162895
\NewDocumentEnvironment {balign*} {}
  {
    \begingroup
    \allowdisplaybreaks
    \start@align\@ne\st@rredtrue\m@ne
  }
  {
    \endalign
    \endgroup
  }

\NewDocumentEnvironment {balign} {}
  {
    \begingroup
    \allowdisplaybreaks
    \align
  }
  {
    \endalign
    \endgroup
  }


\NewDocumentCommand \MemoryLineArrow {O{}m}
  {
    \smash
      {
        \underset
          {
            {\substack{{} \\ \uparrow \\ {#1}}}
          }
          {#2}
      }
  }

\NewDocumentEnvironment {MemoryLine} {m}
  {
    \begin{equation*}
    \begin{array}{| *{#1} {c |}}
    \hline
  }
  {
    \\ \hline
    \end{array}
    \end{equation*}
  }
