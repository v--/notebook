% Define a custom enum that can be used for obtaining "theorem 13 b)" instead of "item 13 b)" via cleveref
% Inspired by https://tex.stackexchange.com/a/162905
\newcounter{counters@theorem}
\counterwithin{counters@theorem}{subsection}
\counterwithin{equation}{subsection}

\newlist{thmenum}{enumerate}{2}
\setlist[thmenum]
  {
    format=\small
  }

\setlist[thmenum, 1]
  {
    label=(\alph*),
    ref=\thecounters@theorem~(\alph*)
  }

\setlist[thmenum, 2]
  {
    label=(\roman*),
    ref=\thecounters@theorem~(\alph{thmenumi} \roman*)
  }

\declaretheorem[numberlike=counters@theorem, style=plain]
  {
    theorem,
    proposition,
    lemma,
    corollary
  }

% I needed to add this after updating to TeXLive 2023.
% Otherwise there was a conflict on how \MakeUppercase is used.
\declaretheorem
  [
    numberlike=counters@theorem,
    style=plain,
    refname={conjecture,conjectures},
    Refname={Conjecture,Conjectures}
  ]
  {conjecture}

\declaretheorem
  [
    numberlike=counters@theorem,
    style=definition,
    refname={concept,concepts},
    Refname={Concept,Concepts}
  ]
  {concept}

\declaretheorem[numberlike=counters@theorem, style=definition]
  {
    definition,
    example,
    algorithm
  }

\declaretheorem[numberlike=counters@theorem, style=remark]
  {
    remark
  }

\ExplSyntaxOn

\seq_new:N \l_crefalias_seq
\seq_set_from_clist:Nn \l_crefalias_seq
{
  theorem,
  proposition,
  lemma,
  corollary,
  conjecture,
  definition,
  concept,
  example,
  remark,
  algorithm
}

\seq_map_inline:Nn \l_crefalias_seq
{
  \addtotheorempostheadhook [#1]
  {
    \crefalias {thmenumi}  {#1}
    \crefalias {thmenumii} {#1}
  }
}

\ExplSyntaxOff

\NewDocumentEnvironment{defproof} {O{Proof of correctness.}}
  {
    \proof[#1]
  }
  {
    \endproof
  }

\NewDocumentEnvironment{comments} {O{Comments.}}
  {
    \proof[#1]
    \hfill
    \begin{itemize}
  }
  {
    \end{itemize}
  }
