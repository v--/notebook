\subsection{First-order models}\label{subsec:first_order_models}

\begin{theorem}[Semantic deduction theorem]\label{thm:semantic_deduction_theorem}\mcite[thm. 14.53]{OpenLogic20201202}
  The entailment \( \Gamma, \psi \vDash \varphi \) holds if and only if \( \Gamma \vDash \psi \to \varphi \) holds. Compare this result to \fullref{thm:deduction_theorem}.
\end{theorem}

\begin{theorem}[First-order compactness theorem]\label{thm:first_order_compactness_theorem}\mcite[thm. 21.21]{OpenLogic20201202}
  A set \( \Gamma \) of formulas is \hyperref[def:propositional_semantics/satisfiability]{satisfiable} if and only if every finite subset of \( \Gamma \) is satisfiable.
\end{theorem}

\begin{remark}\label{rem:first_order_formula_valuation_without_variable_assignment}
  If we know that \( \bop{Free}(\varphi) \subseteq \{ \xi_1, \ldots, \xi_n \} \), we know that the \hyperref[def:first_order_valuation/formula_valuation]{valuation} \( \varphi\eval{v} \) only depends on the values \( v(\xi_1), \ldots, v(\xi_n) \). This allows us to introduce the shorthand
  \begin{equation}\label{eq:rem:first_order_formula_valuation_without_variable_assignment/long}
    \varphi\eval{\xi_1 \mapsto x_1, \ldots, \xi_n \mapsto x_n}
  \end{equation}
  or even
  \begin{equation}\label{eq:rem:first_order_formula_valuation_without_variable_assignment/short}
    \varphi\eval{x_1, \ldots, x_n}
  \end{equation}
  for
  \begin{equation*}
    \varphi\eval{v_{\xi_1 \mapsto x_1, \ldots, \xi_n \mapsto x_n}}
  \end{equation*}
  because the variable assignment \( v \) plays no role here.

  When using either of these shorthand notations, we implicitly assume that \( \bop{Free}(\varphi) \subseteq \set{ \xi_1, \ldots, \xi_n } \).

  The shorter notation \eqref{eq:rem:first_order_formula_valuation_without_variable_assignment/short} is useful when \( \varphi \) is a predicate because this translates to
  \begin{equation*}
    p\eval{x_1, \ldots, x_n} = T \T{if and only if} (x_1, \ldots, x_n) \in I(p).
  \end{equation*}

  Of course, we avoid this notation for formulas like \( p(f(\xi)) \) because \( p\eval{x} \) would mean \( I(p)(I(f)(x)) \) rather than \( I(p)(x) \), which would be confusing.

  We also apply this notation for terms and, in particular, functions.
\end{remark}

\begin{definition}\label{def:first_order_definability}
  Fix a \hyperref[def:first_order_syntax]{first-order language} \( \mscrL \) and a \hyperref[def:first_order_structure]{structure} \( (\mscrX, I) \) on \( \mscrL \).

  We say that the set \( A \subseteq \mscrX^n \) is \term{definable} using the \hyperref[def:first_order_syntax]{formula} \( \varphi \) if, assuming \( {\bop{Free}(\varphi) \subseteq \set{ \xi_1, \ldots, \xi_n }} \), we have
  \begin{equation*}
    \varphi\eval{\xi_1 \mapsto x_1, \ldots, \xi_n \mapsto x_n} = T \quad\T{if and only if}\quad (x_1, \ldots, x_n) \in A.
  \end{equation*}
\end{definition}

\begin{definition}\label{def:first_order_equation}
  A \term{first-order equation} is a formula of the form
  \begin{equation}\label{eq:def:first_order_equation}
    f(\xi_1, \ldots, \xi_n) \doteq g(\xi_1, \ldots, \xi_n),
  \end{equation}
  where both \( f(\xi_1, \ldots, \xi_n) \) and \( g(\xi_1, \ldots, \xi_n) \) are functional symbols with the same free variables.

  Given a structure \( (\mscrX, I) \), we call the elements of the set defined by this formula \term{solutions}. That is, we say that the tuple \( (x_1, \ldots, x_n) \) is a solution to the equation \eqref{eq:def:first_order_equation} if
  \begin{equation*}
    f\eval{x_1, \ldots, x_n} = g\eval{x_1, \ldots, x_n}.
  \end{equation*}
\end{definition}

\begin{example}\label{ex:equations}
  A remarkable portion of mathematics concerns the study of different types of equations (even though they are not generally restricted to \hyperref[def:first_order_equation]{equations in first-order logic}). The reason for this is that equations provide a simple way to specify rich semantic structure using simple syntactic objects.

  \begin{itemize}
    \item Matrix theory can be regarded as the study of linear equations. See \fullref{subsec:matrices}.
    \item Differential equations is aptly named since it studies equations in functional spaces concerning functions and their derivatives. See \fullref{sec:diffeq}.
    \item Roots of generalized derivatives are studied in optimization. See \fullref{sec:nonsmooth_analysis}.
    \item Diophantine equations are studied in number theory. See \fullref{subsec:integers}.
    \item Fixed points of functions are studied in different branches of mathematics. See \fullref{thm:banach_fixed_point_theorem} or \fullref{thm:knaster_tarski_theorem}.
    \item Affine varieties are studied in algebraic geometry. See \fullref{subsec:affine_varieties}.
  \end{itemize}
\end{example}

\begin{definition}\label{def:first_order_substructure}
  Let \( (\mscrX, I) \) be a structure for the language \( \mscrL \) and let \( \mscrY \subseteq \mscrX \). We say that \( (\mscrY, I) \) is a \term{substructure} of \( (\mscrX, I) \) if it satisfies any of the following equivalent conditions:

  \begin{defenum}
    \ilabel{def:first_order_substructure/deductive} If \( \mscrY \) is closed under function application, that is, for any functional symbol \( f \) in \( \mscrL \) with arity \( n \), we have \( I(f)(\mscrY^n) \subseteq \mscrY \).

    \ilabel{def:first_order_substructure/inductive} \( \mscrY \) is a \hyperref[def:fixed_point]{fixed point} of the operator
    \begin{alignedeq}\label{eq:def:first_order_substructure/inductive/operator}
      &T: \pow(\mscrX) \to \pow(\mscrX) \\
      &T(A) \coloneqq A \cup \set{ x \in \mscrX \mid \qexists{f \in \bop{Fun}} \qexists{x_1, \ldots, x_{\#f} \in A} f\eval{x_1, \ldots, x_{\#f}} = x },
    \end{alignedeq}
    which enlarges \( A \) with the union of all image of \( A \) under functions of the language \( \mscrL \).

    Note that the formula inside \eqref{eq:def:first_order_substructure/inductive/operator} is in the metalanguage despite using syntax similar to first-order logic formulas.
  \end{defenum}
\end{definition}
\begin{proof}
  By definition of \( T \), \( \mscrY \) if a fixed point if and only if
  \begin{equation*}
    \set{ x \in \mscrX \mid \qexists{f \in \bop{Fun}} \qexists{x_1, \ldots, x_{\#f} \in A} f\eval{x_1, \ldots, x_{\#f}} = x } \subseteq \mscrY.
  \end{equation*}

  This condition is clearly satisfied if \( B \) satisfies \fullref{def:first_order_substructure/deductive}.

  If, instead \( \mscrY \) is a fixed point of \( T \), for the \( n \)-ary functional symbol \( f \in \bop{Fun} \) and for any tuple \( x_1, \ldots, x_n \), the value \( I(f)(x_1, \ldots, x_n) \) belongs to \( \mscrY \). Therefore \fullref{def:first_order_substructure/deductive} is satisfied.
\end{proof}

\begin{proposition}\label{thm:first_order_substructure_properties}
  \hyperref[def:first_order_substructure]{First order substructures} of \( (\mscrX, I) \) over \( \mscrL \) have the following basic properties:
  \begin{propenum}
    \ilabel{thm:first_order_substructure_properties/intersection} Let \( \{ \mscrY_k \}_{k \in \mscrK} \) be a family of substructures of \( \mscrX \). Then their \enquote{intersection} structure \( \p*{\bigcap_{k \in \mscrK} \mscrY_k, I} \) is again a substructure of \( \mscrX \).
  \end{propenum}
\end{proposition}
\begin{proof}
  \SubProofOf{thm:first_order_substructure_properties/intersection} For any \( f \) functional symbol in \( \mscrL \) with arity \( n \), we have
  \begin{equation*}
    I(f)\p*{\p*{\bigcap_{k \in \mscrK} \mscrY_k}^n}
    \overset {\ref{thm:function_image_properties/intersection}} \subseteq
    \bigcap_{k \in \mscrK} I(f)(\mscrY_k^n) \subseteq \bigcap_{k \in \mscrK} \mscrY_k.
  \end{equation*}

  Therefore \( \p*{\bigcap_{k \in \mscrK} \mscrY_k, I} \) is indeed a substructure of \( (\mscrX, I) \).
\end{proof}

\begin{definition}\label{def:first_order_generated_substructure}
  Let \( (\mscrX, I) \) be a structure over \( \mscrL \) and let \( A \subseteq \mscrX \) be any set. The set \( A \) is said to \term[bg=поражда,ru=порождает]{generate} the substructure \( \mscrY = (\mscrY, I) \) if it satisfies any of the equivalent statements:
  \begin{thmenum}
    \ilabel{def:first_order_generated_substructure/smallest} Out of all substructures of \( \mscrX \) whose universum contains \( A \), the universum \( \mscrY \) is the smallest with respect to \hyperref[def:subset]{set inclusion}.

    \ilabel{def:first_order_generated_substructure/intersection} \( \mscrY \) is the intersection of the universums of all substructures of \( \mscrX \) that contain \( A \).
  \end{thmenum}
\end{definition}
\begin{proof}
  Let \( \{ (\mscrY_k, I) \}_{k \in \mscrK} \) be the family of all substructures of \( (\mscrX, I) \) whose universums contain \( A \). Fix one of these substructures, say \( (\mscrY_{k_0}, I) \).

  We have the obvious inclusion
  \begin{equation*}
    \bigcap_{k \in \mscrK} \mscrY_k \subseteq \mscrY_{k_0}.
  \end{equation*}

  The reverse inclusion holds if and only if \( \mscrY_{k_0} \) is contained in each one of universums \( \mscrY_k, k \in \mscrK \). In other words, \( \mscrY_{k_0} \) is the smallest of the universums \( \mscrY_k, k \in \mscrK \) with respect to set inclusion if and only if \( \mscrY_{k_0} \) equals their intersection.
\end{proof}

\begin{definition}\label{def:first_order_homomorphism}\mcite[def. 23.8]{OpenLogic20201202}
  Let \( (\mscrX, I_{\mscrX}) \) and \( (\mscrY, I_{\mscrY}) \) be structures over a common language. We say that the \hyperref[def:function]{function} \( h: \mscrX \to \mscrY \) is a \term{strong homomorphism} or simply \term{homomorphism} between \( \mscrX \) and \( \mscrY \) if it preserves all functions and relations. Explicitly:
  \begin{defenum}
    \ilabel{def:first_order_homomorphism/functions} For any functional symbol \( f \in \bop{Fun} \) of arity \( n \) and any tuple \( x_1, \ldots, x_n \in \mscrX \) we have
    \begin{equation}\label{eq:def:first_order_homomorphism/functions}
      h(I_{\mscrX}(f)(x_1, \ldots, x_n)) = I_{\mscrY}(f)(h(x_1), \ldots, h(x_n))
    \end{equation}

    \ilabel{def:first_order_homomorphism/predicates} For any predicate symbol \( p \in \bop{Pred} \) of arity \( n \) and any \( x_1, \ldots, x_n \in \mscrX \),
    \begin{equation}\label{eq:def:first_order_homomorphism/predicates}
      (x_1, \ldots, x_n) \in I_{\mscrX}(p) \quad\T{if and only if}\quad (f(x_1), \ldots, f(x_n)) \in I_{\mscrY}(p).
    \end{equation}

    \ilabel{def:first_order_homomorphism/predicates_weak} We can weaken \ref{def:first_order_homomorphism/predicates} to
    \begin{equation}\label{eq:def:first_order_homomorphism/predicates_weak}
      (x_1, \ldots, x_n) \in I_{\mscrX}(p) \quad\T{implies}\quad (f(x_1), \ldots, f(x_n)) \in I_{\mscrY}(p),
    \end{equation}
    in which case we obtain the notion of a \term{weak homomorphism}. Weak homomorphisms are used in e.g. \fullref{def:graph_homomorphism}.
  \end{defenum}
\end{definition}

\begin{proposition}\label{thm:first_order_homomorphism_properties}
  \hyperref[def:first_order_homomorphism]{First-order structure homomorphisms} are the following basic properties:
  \begin{propenum}
    \ilabel{thm:first_order_homomorphism_properties/substructure} If \( (\mscrX, I) \) is a structure and \( \mscrY = (\mscrY, I) \) is a \hyperref[def:first_order_substructure]{substructure} of \( \mscrX \), then the \term{canonical embedding} function
    \begin{alignedeq}\label{thm:first_order_homomorphism_properties/substructure/canonical_embedding}
      &\iota: \mscrY \to \mscrX \\
      &\iota(y) \coloneqq y
    \end{alignedeq}
    is indeed a \hyperref[def:first_order_homomorphism_invertibility/projection]{homomorphism} (and thus an embedding in the sense of \fullref{def:first_order_homomorphism_invertibility}).

    \ilabel{thm:first_order_homomorphism_properties/preserves_substructures} If \( \mscrX = (\mscrX, I_{\mscrX}) \) and \( \mscrY = (\mscrY, I_{\mscrY}) \) are structures and \( h: \mscrX \to \mscrY \) is a (weak or strong) homomorphism, then the \hyperref[def:function/image]{image} \( (f(\mscrX), I_{\mscrY}) \) is a substructure of \( (\mscrY, I_{\mscrY}) \).

    \ilabel{thm:first_order_homomorphism_properties/composition} The \hyperref[def:function/composition]{composition} of two homomorphisms (resp. weak homomorphisms) is again a homomorphism (resp. weak homomorphism).
  \end{propenum}
\end{proposition}
\begin{proof}
  \SubProofOf{thm:first_order_homomorphism_properties/substructure} The interpretation in the substructure \( \mscrY \) is the \hyperref[def:function/extension]{restriction} \( I\rvert_{\mscrY} \) of \( I \) to \( \mscrY \) which simply restricts the domain of any predicate and function is indeed an interpretation in \( \mscrY \). Thus \( (\mscrY, I\rvert_{\mscrY} \) is a structure.

  Conditions \fullref{def:first_order_homomorphism/functions} and \fullref{def:first_order_homomorphism/predicates} are both satisfied since the interpretation of any function and predicate is restricted to \( \mscrY \). Thus \( \iota \) is a homomorphism.

  \SubProofOf{thm:first_order_homomorphism_properties/preserves_substructures} To see that \( (f(\mscrX), I_{\mscrY}) \) is a substructure of \( (\mscrY, I_{\mscrY}) \), we will show that \fullref{def:first_order_substructure/deductive} holds.

  Indeed, by \fullref{def:first_order_homomorphism/functions}, for any \( n \)-ary functional symbol and any tuple \( {x_1, \ldots, x_n \in \mscrX} \), we have that
  \begin{equation*}
    I_{\mscrY}(f)(h(x_1), \ldots, f(x_n))
    \overset {\eqref{eq:def:first_order_homomorphism/functions}} =
    h(I_{\mscrX}(f)(x_1, \ldots, x_n))
    \overset {\ref{def:first_order_substructure/deductive}} \in
    h(\mscrX).
  \end{equation*}

  Since no predicates are involved in the condition of \( (h(\mscrX), I_{\mscrY}) \) to be a substructure of \( (\mscrY, I_{\mscrY}) \), this proof holds for both weak and strong homomorphisms.

  \SubProofOf{thm:first_order_homomorphism_properties/composition} If \( h: \mscrX \mapsto \mscrY \) and \( l: \mscrY \mapsto \mscrZ \) are both homomorphisms, then
  \begin{RefList}
    \iref{def:first_order_homomorphism/functions} for any \( n \)-ary functional symbol \( f \) and any tuple \( x_1, \ldots, x_n \in \mscrX \),
    \begin{align*}
      &{}\phantom{=}{}
      (l \circ h)(I_{\mscrX}(f)(x_1, \ldots, x_n))
      \overset {\eqref{eq:def:first_order_homomorphism/functions}} = \\ &=
      l(I_{\mscrY}(f)(h(x_1), \ldots, h(x_n))
      \overset {\eqref{eq:def:first_order_homomorphism/functions}} = \\ &=
      I_{\mscrZ}(f)((l \circ h)(x_1), \ldots, (l \circ h)(x_n)).
    \end{align*}

    \iref{def:first_order_homomorphism/predicates} for any \( n \)-ary predicate symbol \( p \) and any tuple \( x_1, \ldots, x_n \in \mscrX \),
    \begin{align*}
      &{}\phantom{=}{}
      (x_1, \ldots, x_n) \in I_{\mscrX}(p)
      \overset {\eqref{eq:def:first_order_homomorphism/predicates}} \iff \\ &\iff
      (h(x_1)), \ldots, h(x_n)) \in I_{\mscrY}(p)
      \overset {\eqref{eq:def:first_order_homomorphism/predicates}} \iff \\ &\iff
      ((l \circ h)(x_1), \ldots, (l \circ h)(x_n)) \in I_{\mscrZ}(p).
    \end{align*}
  \end{RefList}
\end{proof}

\begin{definition}\label{def:first_order_homomorphism_invertibility}
  We introduce the following terminology (compare to \fullref{def:function_invertibility} and \fullref{def:morphism_invertibility}):
  \begin{defenum}
    \ilabel{def:first_order_homomorphism_invertibility/embedding} An \term{embedding}, also called a \term{monomorphism}, is an \hyperref[def:function_invertibility/injection]{injective} homomorphism.

    \ilabel{def:first_order_homomorphism_invertibility/projection} Dually, a \term{projection}, also called an \term{epimorphism}, is an \hyperref[def:function_invertibility/surjection]{surjective} homomorphism.

    \ilabel{def:first_order_homomorphism_invertibility/isomorphism} An \term{isomorphism} is a \hyperref[def:function_invertibility/bijection]{bijective} homomorphism.

    \ilabel{def:first_order_homomorphism_invertibility/endomorphism} An \term{endomorphism} is a homomorphism that is also an \hyperref[def:endofunction]{endofunction}.

    \ilabel{def:first_order_homomorphism_invertibility/automorphism} A homomorphism that is both an endomorphism and an isomorphism is called an \term{automorphism}.
  \end{defenum}
\end{definition}

\begin{proposition}\label{thm:first_order_homomorphism_preserves_models}\mcite[def. 23.8]{OpenLogic20201202}
  Let \( (\mscrX, I_{\mscrX}) \) and \( (\mscrY, I_{\mscrY}) \) be structures over a common language \( \mscrL \). Let \( h: \mscrX \to \mscrY \) be a homomorphism between them. Let \( \Gamma \) be a set of formulas.

  If \( (\mscrX, I_{\mscrX}) \models \Gamma \), then \( (h(\mscrX), I_{\mscrY}) \models \Gamma \).
\end{proposition}
\begin{proof}
  Let \( (\mscrX, I) \) be a model of \( \varphi \). Let \( \varphi \) be a formula in \( \mscrL \) such that
  \begin{equation*}
    \bop{Free}(\varphi) \subseteq \set{x_1, \ldots, x_n}.
  \end{equation*}

  Using induction\IND on the structure of \( \varphi \), it is straightforward to show that \( \varphi\eval{x_1, \ldots, x_n} = \varphi\eval{h(x_1), \ldots, h(x_n)} \).

  We conclude that, if \( (\mscrX, I_{\mscrX}) \models \varphi \), we have \( (h(\mscrX), I_{\mscrY}) \models \varphi \).

  Since the formula \( \varphi \) was an arbitrary member of \( \Gamma \), the statement of the proposition follows.
\end{proof}

\begin{corollary}\label{thm:substructure_is_model}
  Any \hyperref[def:first_order_substructure]{substructure} of a model of \( \Gamma \) is again a model of \( \Gamma \).
\end{corollary}
\begin{proof}
  Follows from \fullref{thm:first_order_homomorphism_properties/substructure} and \fullref{thm:first_order_homomorphism_preserves_models}.
\end{proof}

\begin{remark}\label{rem:induction}
  % TODO
\end{remark}

\begin{definition}\label{def:first_order_model_category}
  % TODO
\end{definition}
