\subsection{Relations}\label{subsec:relations}

\begin{definition}\label{def:relation}
  Let \( \{ X_k \}_{k \in \mscrK} \) be a family of sets and let
  \begin{equation*}
    R \subseteq \prod_{k \in \mscrK} X_k
  \end{equation*}
  be a subset of their Cartesian product.

  The \hyperref[def:cartesian_product]{tuple} \( (R,  \{ X_k \}_{k \in \mscrK}) \) is called a \term{relation}.

  \begin{thmenum}
    \thmitem{def:relation/graph} \( R \) is called the \term{graph} of the relation. In case the family \( \{ X_k \}_{k \in \mscrK} \) is clear from the context, we say that the graph \( R \) itself is a relation.

    \thmitem{def:relation/arity} When \( \mscrK \) is a finite set of \hyperref[rem:cardinals]{cardinality} \( n \), the relation is called \term{n-ary}. In particular,
    \begin{itemize}
      \item \( R \) is nullary if \( n = 0 \)
      \item \( R \) is unary if \( n = 1 \)
      \item \( R \) is binary if \( n = 2 \)
      \item \( R \) is ternary if \( n = 3 \)
    \end{itemize}

    This is not to be confused with \fullref{def:function/arity}.

    \thmitem{def:relation/single_set} If all \( X_k \) are equal to some set \( X \), \( X \) is clear from the context and we usually say that \( R \subseteq X^{\mscrK} \) is a \term{relation on} \( X \).
  \end{thmenum}
\end{definition}

\begin{example}\label{ex:relation}
  Relations are used in vastly different contexts:
  \begin{itemize}
    \item Functions (see \fullref{def:function}) are special binary relations.
    \item Orders (see \fullref{sec:order_theory}) are also special binary relations.
    \item Directed graphs (see \fullref{def:directed_graph}) are binary relations over finite sets.
    \item Entourages (see \fullref{def:entourage}) are binary relations in \hyperref[def:uniform_space]{uniform spaces}.
    \item Structures in first-order logic (see \fullref{def:first_order_structure}) use relations for giving semantics to predicates. Predicates are ubiquitous in mathematics, e.g.
          \begin{itemize}
            \item Questions of the form \enquote{does some property \( \varphi(x) \) hold for \( x_0 \)} are unary predicates. This is probably the most common type of questions in mathematics. Two examples are \enquote{is a real \hyperref[def:real_numbers]{number} positive} and \enquote{is a uniform space \hyperref[def:complete_uniform_space]{complete}}.
            \item Affine planes (see \fullref{def:affine_plane}) define several binary predicates.
            \item Production rules and derivations in formal grammars (see \fullref{def:grammar}) are binary predicates.
            \item Elementary questions in set theory like \enquote{is \( A \) a \hyperref[def:subset]{subset} of \( B \)} or \enquote{are \( A \) and \( B \) equinumerous} are modeled using predicates.
            \item Questions in general \hyperref[sec:general_topology]{topology} like \enquote{are two spaces homeomorphic} or questions in algebra like \enquote{are two groups homomorphic} are modeled using predicates. These questions, however, are more suitable for \hyperref[def:morphism_invertibility/isomorphism]{isomorphisms} in category theory.
          \end{itemize}
  \end{itemize}
\end{example}

\begin{definition}\label{def:binary_relation}
  Let \( R \subseteq X \times Y \) be a binary relation. We introduce the following terminology:
  \begin{thmenum}[series=def:binary_relation]
    \thmitem{def:binary_relation/domain} We define the \term{domain} of \( R \) as the set
    \begin{equation*}
      \dom(R) \coloneqq \{ x \in X \colon \exists y: (x, y) \in R \}
    \end{equation*}
    of all members of \( X \) that belong to at least one tuple.

    \thmitem{def:binary_relation/image} Similarly, we define the \term{image} of \( R \) as the set
    \begin{equation*}
      \img(R) \coloneqq \{ y \in Y \colon \exists x: (x, y) \in R \}
    \end{equation*}
    of all members of \( Y \) that belong to at least one tuple.

    \thmitem{def:binary_relation/range} The set \( Y \) is called the \term{range} of \( R \). There is no similar established terminology for \( X \).

    \thmitem{def:binary_relation/inverse} We define \term{inverse relation} of \( R \) as
    \begin{equation*}
      \neg R \coloneqq (X \times Y) \setminus R.
    \end{equation*}

    \thmitem{def:binary_relation/converse} We define \term{converse relation} of \( R \) as
    \begin{equation*}
      R^{-1} \coloneqq \{ (y, x) \colon (x, y) \in R \}.
    \end{equation*}

    \thmitem{def:binary_relation/diagonal} A very special relation is the \term{diagonal relation} on a set \( X \):
    \begin{equation*}
      \Delta_X \coloneqq \{ (x, x) \colon x \in X \}.
    \end{equation*}

    \thmitem{def:binary_relation/composition} Given two relations \( R \subseteq X \times Y \) and \( T \subseteq Y \times Z \), we define their composition as
    \begin{equation*}
      T \circ R \coloneqq \{ (x, z) \in X \times Z \colon \exists y \in Y: (x, y) \in R \T{and} (y, z) \in T \}.
    \end{equation*}
  \end{thmenum}

  Whenever \( X = Y \), the following are ubiquitous axioms a binary relation \( R \):
  \begin{thmenum}[resume=def:binary_relation]
    \thmitem{def:binary_relation/reflexive} \( R \) is \term{reflexive} if \( \Delta_X \subseteq R \).

    \thmitem{def:binary_relation/irreflexive} \( R \) is \term{irreflexive} if \( \Delta_X \cap R = \varnothing \).

    \thmitem{def:binary_relation/symmetric} \( R \) is \term{symmetric} if \( R = R^{-1} \).

    \thmitem{def:binary_relation/antisymmetric} \( R \) is \term{antisymmetric} if \( R \cap R^{-1} = \Delta_X \).

    \thmitem{def:binary_relation/transitive} \( R \) is \term{transitive} if
    \begin{equation*}
      (x, y) \in R \T{and} (y, z) \in R \T{implies} (x, z) \in R.
    \end{equation*}

    \thmitem{def:binary_relation/total} \( R \) is \term{total} if, for all \( x, y \in X \), either \( (x, y) \in R \) or \( (y, x) \in R \). This is not to be confused with \fullref{def:function/total}.

    \thmitem{def:binary_relation/trichotomic} \( R \) is \term{trichotomic} if, for all \( x, y \in X \), either \( x = y \), \( (x, y) \in R \) or \( (y, x) \in R \).
  \end{thmenum}
\end{definition}

\begin{definition}\label{def:derived_relations}
  Let \( R \) be a binary relation on \( X \).

  \begin{thmenum}
    \thmitem{def:derived_relations/reflexive} The \term{reflexive closure} of \( R \) is defined as
    \begin{equation*}
      \cl^R(R) \coloneqq R \cup \Delta_X.
    \end{equation*}

    \thmitem{def:derived_relations/symmetric} The \term{symmetric closure} of \( R \) is defined as
    \begin{equation*}
      \cl^S(R) \coloneqq R \cup R^{-1}.
    \end{equation*}

    \thmitem{def:derived_relations/transitive} The \term{transitive closure} of \( R \) is defined as
    \begin{equation*}
      \cl^T(R) \coloneqq \bigcup_{k=1}^\infty R^k,
    \end{equation*}
    where \( R^k \) is iterated \hyperref[def:binary_relation/composition]{composition}. In other words, it is the smallest relation such that \( (x, y) \in R \) and \( (y, z) \in R \) together imply then \( (x, z) \in \cl^T(R) \).

    The \term{transitive reduction} \( \red^T(R) \) of \( R \) is the smallest (with respect to set inclusion) relation such that \( \cl^T(\red^T(R)) = \cl^T(R) \).
  \end{thmenum}
\end{definition}

\begin{proposition}\label{thm:derived_relations_characterization}
  The is reflexive (resp. symmetric or transitive) closure of a relation \( R \) is the smallest reflexive (resp. symmetric or transitive) relation that contains \( R \).
\end{proposition}
\begin{proof}
  Every other reflexive (resp. symmetric or transitive) relation strictly contains the closure.
\end{proof}

\begin{definition}\label{def:equivalence_relation}
  A relation that is \hyperref[def:binary_relation/reflexive]{reflexive}, \hyperref[def:binary_relation/symmetric]{symmetric} and \hyperref[def:binary_relation/transitive]{transitive} is called an equivalence relation. In other words, an equivalence relation is a symmetric \hyperref[def:preordered_set]{preorder}.

  Using the infix notation convention (see \fullref{rem:first_order_formula_conventions/infix}), we usually denote equivalence relations by \( \cong \).

  \begin{thmenum}
    \thmitem{def:equivalence_relation/coset} We define \term{equivalence classes} or \term{cosets} to be sets of the form
    \begin{equation*}
      [x] \coloneqq \{ y \in X \colon x \cong y \}.
    \end{equation*}

    \thmitem{def:equivalence_relation/quotient} We define the \term{quotient set} of \( X \) by \( \cong \) as
    \begin{equation*}
      X / \cong \ \coloneqq \{ [x] \colon x \in X \}.
    \end{equation*}

    \thmitem{def:equivalence_relation/projection} We call the function
    \begin{balign*}
       & \pi: X \to X / \cong  \\
       & \pi(a) \coloneqq [a].
    \end{balign*}
    the \term{canonical projection}. See \fullref{thm:equivalence_partition}.

    The function \( \pi \) can be regarded as a \hyperref[def:function/multivalued]{multivalued function} from \( X \) to \( X \).
  \end{thmenum}
\end{definition}

\begin{proposition}\label{thm:equality_is_smallest_equivalence_relation}
  The equality \hyperref[def:relation]{relation} \( = \) is the intersection of all equivalence relations.
\end{proposition}
\begin{proof}
  It is equivalent to the \hyperref[def:binary_relation/diagonal]{diagonal relation} \( \Delta_X \). By \fullref{thm:derived_relations_characterization}, it is the smallest reflexive relation on \( X \), i.e. the intersection of all reflexive relations.
\end{proof}

\begin{definition}\label{def:set_partition}
  Let \( X \) be a set. A \term{cover of \( X \)} is a \hyperref[rem:family_of_sets]{family} \( \mscrP \subseteq \pow(X) \) of nonempty sets such that \( X = \bigcup \mscrP \).

  A \term{partition} of \( X \) is a pairwise disjoint cover. In other words, each element of \( X \) belong to exactly one set in a partition \( \mscrP \).
\end{definition}

\begin{lemma}\label{thm:equivalence_relation_inheriance}
  If \( f: X \to Y \) is a function, then the relation \( \cong \) defined by \( x \cong y \iff f(x) = f(y) \) is an equivalence relation on \( X \).
\end{lemma}
\begin{proof}
  Follows from the fact that \( = \) is an equivalence relation.
\end{proof}

\begin{proposition}\label{thm:equivalence_partition}
  Fix a set \( X \). Let \( \sim \) be a relation of \( X \). The following are equivalent:
  \begin{thmenum}
    \thmitem{thm:equivalence_partition/equivalence} \( \sim \) is an \hyperref[def:equivalence_relation]{equivalence relation}.

    \thmitem{thm:equivalence_partition/partition} There exists a \hyperref[def:set_partition]{partition} \( \mscrP \) of \( X \) such that
    \begin{equation}\label{thm:equivalence_partition/partition/property}
      x \sim y \iff \exists P \in P: \{ x, y \} \subseteq P.
    \end{equation}

    \thmitem{thm:equivalence_partition/function} There exists a set \( Y \) and a function \( f: X \to Y \) such that \( f(a) = f(b) \iff a \sim b \).
  \end{thmenum}
\end{proposition}
\begin{proof}
  \ImplicationSubProof{thm:equivalence_partition/equivalence}{thm:equivalence_partition/partition} Let \( \sim \) be an equivalence relation on \( X \). The quotient set \( X / \sim \) is a partition since
  \begin{itemize}
    \item Every element \( x \in X \) belongs exactly one equivalence class \( [x] \).
    \item The equivalence classes are disjoint. Indeed, let \( [x] \cap [y] \neq \varnothing \) and let \( z \in [x] \cap [y] \). Assume that \( x \not\sim x \). Then \( z \sim x \) and \( z \sim y \), thus \( x \sim z \sim y \) and \( x \sim y \), which is a contradiction. Thus either \( [x] = [x] \) or \( [y] \cap [z] = \varnothing \).
  \end{itemize}

  \ImplicationSubProof{thm:equivalence_partition/partition}{thm:equivalence_partition/function} Let \( \mscrP \) be a partition of \( X \) satisfying \fullref{thm:equivalence_partition/partition/property}. Denote by \( P_x \) the set in \( \mscrP \) which contains \( x \) and define the function
  \begin{balign*}
     & f: X \to \mscrP \\
     & f(x) = P_x.
  \end{balign*}

  This function is well defined since since \( \mscrP \) is a partition, which means that \( x \) belongs to exactly one set in \( \mscrP \).

  \ImplicationSubProof{thm:equivalence_partition/function}{thm:equivalence_partition/equivalence} Follows from \fullref{thm:equivalence_relation_inheriance}.
\end{proof}
